<!DOCTYPE html>
<meta charset="utf-8">

<style>
 .links path {
     opacity: 0.8;
 }

 .nodes text {
     font-family: sans-serif;
     font-size: 10pt !important;
 }

 .node-body {
   stroke: black;
   stroke-width: 0.5px;
 }

 .thin-sankey .node line {
   stroke: black;
 }

</style>


<svg width="500" height="200"></svg>

<script src="https://d3js.org/d3.v4.js"></script>
<script src="d3-sankey-diagram.js"></script>
<script>
  var color = d3.scaleOrdinal(d3.schemeCategory10);

 // Data
 var graph = {
   nodes: [
     {"id": "n", "title": "Second Source", "color": color("n")},
     {"id": "a", "title": "Source", "color": color("x")},
     {"id": "b", "title": "Stage 1","color": color("y")},
     {"id": "c", "title": "Stage 2", "color": color("z")},
     {"id": "d", "title": "Output\nflow", "color": color("1")},
     {"id": "e", "title": "Losses", "color": color("2")},
   ],
   links: [
    {"source": "n", "target": "b", "type": "x", "values": 2},
     {"source": "a", "target": "b", "type": "x", "values": 2},
     {"source": "b", "target": "c", "type": "x", "values": 1.5},
     {"source": "a", "target": "c", "type": "y", "values": 1},
     {"source": "a", "target": "c", "type": "z", "values": 2},
     {"source": "c", "target": "d", "type": "0", "values": 3},
     {"source": "b", "target": "e", "type": "1", "values": 0.5},
     {"source": "c", "target": "e", "type": "1", "values": 1.5},
     {"source": "a", "target": "e", "type": "1", "values": 0.5}
   ]
 };

 let order = [
  ["a", "n", "b"],
  ["c", "d", "e"]
 ]

 // Set up SVG
 var svg = d3.select('svg');
 var width = +svg.attr('width');
 var height = +svg.attr('height');
 var margin = { top: 10, left: 100, bottom: 10, right: 50 };

 var layout = d3.sankey()
                .linkValue(function (d) { return d.values; })
                .nodeWidth(30)
                .ordering(order)
                .extent([
                  [margin.left, margin.top],
                  [width - margin.left - margin.right, height - margin.top - margin.bottom]]);

 // Render
 var fmt = d3.format('.1f');
 var diagram = d3.sankeyDiagram()
                 .linkMinWidth(function(d) { return 0.1; })
                 .nodeValue(nodeValue)
                 .linkColor(function(d) { return color(d.type); })


 update();

 function update() {
   layout(graph);

   svg
     .datum(graph)
     .call(diagram);
 }

 

 function nodeValue(d) {
   return fmt(d.value);
 }
</script>