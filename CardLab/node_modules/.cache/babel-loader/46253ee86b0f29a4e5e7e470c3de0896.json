{"ast":null,"code":"class FancyMouse {\n  constuctor(p) {\n    this.busy = false;\n    this.xOffset = 0;\n    this.yOffset = 0;\n    this.effect = null;\n    this.p = p;\n  }\n\n  setOffset(buttonX, buttonY) {\n    this.xOffset = this.p.mouseX - buttonX;\n    this.yOffset = this.p.mouseY - buttonY;\n  }\n\n}\n\nclass Effect {\n  constructor(label_name, effect_short, methods, param_format, targets, filters, duration) {\n    this.x = 0;\n    this.y = 0;\n    this.effect_string = \"\";\n    this.effect_string_height = 0;\n    this.effect_string_width = blank_spell_img.width * 0.5;\n    this.label_name = label_name;\n    this.effect_short = effect_short;\n    this.settings = {\n      methods: [methods, \"\"],\n      params: [param_format, \"\"],\n      targets: [targets, \"\"],\n      filters: [filters, \"\"],\n      duration: [duration, \"\"]\n    };\n  }\n\n}\n\nexport default function sketch(p) {\n  let blank_spell_img, blank_creature_img, blank_weapon_img, full_blank_creature_img;\n  let bg;\n  let GAN_imgs = [];\n  let flavour_img, masked_flavour_ellipse, masked_flavour_rect;\n  const buttons = [];\n  let button_id = 0;\n  const effects = [];\n  let experiments = [\"mvw\", \"2mur\", \"longer_game\"];\n  let user = \"\";\n  const cards = [];\n  const card_num = 3;\n  const card_types = [\"spell\", \"minion\", \"weapon\"];\n  const method_names = [\"randomly\", \"targeted\", \"all\", \"aura\"];\n  const target_names = [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"];\n  const target_names_singular = [\"minion\", \"hero\", \"minion or hero\", \"murloc\", \"beast\", \"demon\", \"totem\", \"weapon\"];\n  const filter_names = [\"enemy\", \"friendly\", \"all\"];\n  const duration_names = [\"turn\", \"permanently\"];\n  const param_format_names = [\"x\", \"x/x\", \"k\", \"c\"];\n  const effect_names = [\"Deal damage\", \"Destroy\", \"Heal\", \"Gain armour\", \"Change stats\", \"Set stats\", \"Give keyword\", \"Return to hand\", \"Draw\", \"Gain mana\", \"Summon: \", \"Battlecry: \", \"Deathrattle: \"];\n  const keywords = [\"Taunt\", \"Charge\", \"Lifesteal\", \"Spell damage +1\", \"Divine shield\", \"Poisonous\", \"Windfury\", \"Frozen\"];\n  const all_creature_types = [\"murloc\", \"beast\", \"demon\", \"totem\", \"dragon\", \"pirate\", \"mech\", \"elemental\"];\n  const creature_types = [\"Murloc\", \"Beast\", \"Demon\", \"Totem\"];\n  const survey_topics = [\"none\", \"methods\", \"filters\", \"targets\", \"duration\", \"params\"];\n  let current_survey_topic = 0;\n  let survey_drop_target = null;\n  const font_pixels = 24;\n  const smaller_font_size = 20;\n  let hearthstone_font;\n  const mouse_padding = 1;\n  let w_padding, h_padding;\n  let grid_w_padding, grid_h_padding;\n  let theMouse;\n  let hoveredOption = -1;\n  let editing = \"none\";\n  let editing_card = null;\n  let effect_to_remove = null;\n  let editX = 0;\n  let editY = 0;\n  let simCount = 3;\n  let simulating = false;\n  let simDuration = 2000;\n  let simTime = -simDuration;\n  let mouse_over_queuer;\n  let simResults = null;\n  let simTurns = null;\n  let props;\n\n  p.myCustomRedrawAccordingToNewPropsHandler = _props => {\n    props = _props; // GAN_imgs.push(p.loadImage(\"../images/gan_samples/sample_\"+p.floor(p.random(1000))+\".jpg\"));\n    // flavour_img = p.random(GAN_imgs);\n  };\n\n  p.preload = () => {\n    bg = p.loadImage(props.bg_img);\n    blank_spell_img = p.loadImage(props.spell_img);\n    blank_weapon_img = p.loadImage(props.weapon_img);\n    blank_creature_img = p.loadImage(props.creature_img);\n    full_blank_creature_img = p.loadImage(props.full_blank_creature_img);\n    flavour_img = p.loadImage(props.gan_img); //bg = p.loadImage(bg_img);\n    // blank_spell_img = p.loadImage(\"../images/blank_cards/spell.png\");\n    // blank_weapon_img = p.loadImage(\"../images/blank_cards/weapon.png\")\n    // blank_creature_img = p.loadImage(\"../images/blank_cards/creature.png\")\n    // full_blank_creature_img = p.loadImage(\"../images/blank_cards/fullBlankCreature.png\");\n    // GAN_imgs.push(p.loadImage(\"../images/gan_samples/sample_\"+p.floor(p.random(1000))+\".jpg\"));\n    // flavour_img = p.random(GAN_imgs);\n    //hearthstone_font = p.loadFont(\"https://fonts.googleapis.com/css2?family=Roboto&display=swap\");\n  };\n\n  p.setup = () => {\n    p.createCanvas(p.windowWidth, p.windowHeight);\n    user = p.getURLParams().user;\n    h_padding = p.height * 0.1;\n    w_padding = p.width * 0.2;\n    grid_h_padding = p.height * 0.2;\n    grid_w_padding = p.width * 0.1;\n    p.imageMode(p.CENTER);\n    p.rectMode(p.CENTER); //`p.textFont(hearthstone_font);\n\n    p.textSize(font_pixels);\n    p.fill(255);\n    p.noStroke();\n    theMouse = new FancyMouse(p);\n    p.register_all();\n\n    for (let i = 0; i < card_num; i++) {\n      cards.push(new p.Card(i, \"mvw\"));\n    }\n\n    p.resize_all();\n    let ellipse_mask = p.createGraphics(p.width, p.height);\n    p.ellipse_mask.ellipse(p.width / 2, p.height / 2 + 50, 900, 840);\n    let rect_mask = p.createGraphics(p.width, p.height);\n    p.rect_mask.rect(p.width / 2 - 450, p.height / 2 - 300, 900, 800);\n    masked_flavour_ellipse = flavour_img.get();\n    masked_flavour_ellipse.mask(ellipse_mask);\n    masked_flavour_rect = flavour_img.get();\n    masked_flavour_rect.mask(rect_mask);\n  };\n\n  p.draw = () => {\n    p.background(255);\n    p.textAlign(p.LEFT, p.CENTER);\n    p.image(bg, p.width / 2, p.height / 2, p.width, p.height);\n\n    for (let c of cards) {\n      c.run();\n    }\n\n    for (let b of buttons) {\n      b.run();\n    }\n\n    if (theMouse.busy && current_survey_topic == 0) {\n      p.push();\n      p.translate(p.mouseX - theMouse.xOffset, p.mouseY - theMouse.yOffset);\n      p.textSize(28);\n      p.text(theMouse.effect.label_name, 0, 0);\n      p.pop();\n    }\n\n    p.draw_edit_overlay();\n    p.sim_overlay();\n\n    if (survey_topics[current_survey_topic] != \"none\") {\n      p.draw_survey();\n    }\n  };\n\n  p.draw_survey = () => {\n    p.push();\n    p.textAlign(p.CENTER, p.CENTER);\n    p.textSize(font_pixels);\n    p.rectMode(p.CENTER);\n    p.background(0, 100);\n    let setting = theMouse.effect.settings[survey_topics[current_survey_topic]];\n    let options = setting[0];\n\n    if (setting[0][0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n    } else if (setting[0][0] == \"k\") {\n      options = keywords;\n    } else if (setting[0][0] == \"c\") {\n      options = creature_types;\n    }\n\n    if (options[0] == \"x/x\") {\n      for (let attack = 1; attack < 11; attack++) {\n        for (let defense = 1; defense < 11; defense++) {\n          let xPos = p.map(attack, 1, 10, grid_w_padding, p.width - grid_w_padding);\n          let yPos = p.map(defense, 1, 10, grid_h_padding, p.height - grid_h_padding);\n          let boxWidth = (p.width - grid_w_padding * 2) / 10;\n          let boxHeight = (p.height - grid_h_padding * 2) / 10;\n\n          if (p.mouseX > xPos - boxWidth / 2 && p.mouseX < xPos + boxWidth / 2 && p.mouseY > yPos - boxHeight / 2 && p.mouseY < yPos + boxHeight / 2) {\n            p.fill(255, 100);\n          } else {\n            p.fill(255, 0);\n          }\n\n          p.rect(xPos, yPos, boxWidth, boxHeight);\n          p.fill(255);\n          p.text(attack + \"/\" + defense, xPos, yPos - 10);\n        }\n      }\n    } else {\n      p.textSize(40);\n      p.fill(255);\n      p.text(theMouse.effect.label_name + \"...\", p.width / 2, p.height * 0.1);\n      p.textSize(font_pixels);\n      p.rectMode(p.CENTER);\n      let optionButtonWidth = p.width / options.length * 0.5;\n      let optionButtonHeight = p.height * 0.10;\n      let optionButtonsPadding = p.width * 0.25;\n\n      for (let [index, option] of options.entries()) {\n        let xPos = p.map(index, 0, options.length - 1, optionButtonsPadding, p.width - optionButtonsPadding);\n\n        if (p.mouseX > xPos - optionButtonWidth / 2 && p.mouseX < xPos + optionButtonWidth / 2) {\n          p.fill(255, 100);\n          hoveredOption = index;\n        } else {\n          p.fill(255, 50);\n        }\n\n        p.rect(xPos, p.height * 0.5, optionButtonWidth, optionButtonHeight, 16);\n        p.fill(255);\n        let optionString = option.toString();\n        optionString = optionString[0].toUpperCase() + optionString.substring(1);\n        optionString = optionString.split(\" \").join(\"\\n\");\n        p.text(optionString, xPos, p.height / 2);\n      }\n    }\n\n    p.pop();\n  };\n\n  p.mousePressedWhileSurveying = () => {\n    if (p.progressSurveyThroughIssues()) {\n      return;\n    }\n\n    let setting = theMouse.effect.settings[survey_topics[current_survey_topic]];\n    let options = setting[0];\n\n    if (options[0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n    } else if (options[0] == \"k\") {\n      options = keywords;\n    } else if (options[0] == \"c\") {\n      options = creature_types;\n    }\n\n    if (options[0] == \"x/x\") {\n      setting[1] = {\n        x: p.floor(p.map(p.mouseX, 0, p.width, 1, 11)),\n        y: p.floor(p.map(p.mouseY, 0, p.height, 1, 11))\n      };\n    } else {\n      setting[1] = options[hoveredOption];\n    }\n\n    current_survey_topic++;\n\n    if (p.progressSurveyThroughIssues()) {\n      return;\n    }\n  };\n\n  p.mousePressedWhileNotSurveying = () => {\n    let clickedCard = null;\n\n    for (let c of cards) {\n      if (c.mouseInImg()) {\n        clickedCard = c;\n      }\n    }\n\n    if (clickedCard) {\n      if (theMouse.busy) {\n        //dropping effect onto a card\n        p.dropEffectOnCard(clickedCard);\n      } else {\n        //clicking on a card generally\n        p.clickToEditCard(clickedCard);\n      }\n    } else {\n      if (theMouse.busy) {\n        //clicked away to drop label\n        theMouse.busy = false;\n        theMouse.setOffset(0, 0);\n        theMouse.effect = null;\n      } else {\n        //other clicks\n        if (mouse_over_queuer) {\n          p.add_to_queue();\n        }\n\n        p.mouse_click_while_editing();\n\n        for (let b of buttons) {\n          //clicking on a button with an empty hand\n          if (b.mouseInRegion()) {\n            theMouse.busy = true;\n            theMouse.setOffset(b.text_x, b.text_y);\n            theMouse.effect = JSON.parse(JSON.stringify(effects[b.button_name]));\n            break;\n          }\n        }\n      }\n    }\n  }; //returns true if you need to return out of mouse\n\n\n  p.progressSurveyThroughIssues = () => {\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n    for (let i = 0; i < survey_topics.length; i++) {\n      if (theMouse.effect.settings[survey_topics[current_survey_topic]][0] == null || !param_format_names.includes(theMouse.effect.settings[survey_topics[current_survey_topic]][0][0]) && theMouse.effect.settings[survey_topics[current_survey_topic]][0].length == 1) {\n        current_survey_topic++;\n\n        if (current_survey_topic == survey_topics.length) {\n          p.finished_survey();\n          return true;\n        }\n      }\n    }\n\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n    return false;\n  };\n\n  p.dropEffectOnCard = c => {\n    current_survey_topic = 1;\n    survey_drop_target = c;\n\n    if (p.progressSurveyThroughIssues()) {\n      return;\n    }\n  };\n\n  p.clickToEditCard = c => {\n    if (c.mouse_over_mana) {\n      editing = \"mana\";\n      editing_card = c;\n    } else if (c.mouse_over_power) {\n      editing = \"power\";\n      editing_card = c;\n    } else if (c.mouse_over_toughness && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"toughness\";\n      editing_card = c;\n    } else if (c.mouse_over_card_effect && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"effect\";\n      editX = c.hovered_effect.x + blank_spell_img.width / 2;\n      editY = c.hovered_effect.y + c.hovered_effect.effect_string_height / 2;\n      editing_card = c;\n      effect_to_remove = c.hovered_effect;\n    } else if (editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10) {\n      editing_card.effects.splice(editing_card.effects.indexOf(effect_to_remove), 1);\n      editing = \"none\";\n    } else {\n      editing = \"none\";\n    }\n  };\n\n  p.mouse_click_while_editing = () => {\n    if (editing == \"mana\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY - 50) < 40) {\n        editing_card.mana--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY - 50) < 40) {\n        editing_card.mana++;\n      } else {\n        editing = \"none\";\n      }\n\n      editing_card.mana = p.constrain(editing_card.mana, 0, 10);\n    } else if (editing == \"power\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.power--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.power++;\n      } else {\n        editing = \"none\";\n      }\n\n      editing_card.power = p.constrain(editing_card.power, 0, 10);\n    } else if (editing == \"toughness\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.toughness--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.toughness++;\n      } else {\n        editing = \"none\";\n      }\n\n      editing_card.toughness = p.constrain(editing_card.toughness, 1, 10);\n    } else if (editing = \"effect\") {\n      editing = \"none\";\n    }\n  };\n\n  p.draw_edit_overlay = () => {\n    p.push();\n\n    if (editing != \"none\") {\n      p.translate(editX, editY);\n      p.noStroke();\n\n      if (editing == \"effect\") {\n        p.rotate(p.QUARTER_PI);\n        p.fill(0);\n        p.rect(0, 0, 22, 6);\n        p.rect(0, 0, 6, 22);\n        p.fill(255);\n        p.rect(0, 0, 20, 4);\n        p.rect(0, 0, 4, 20);\n      } else {\n        p.fill(0);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 8, 32);\n        p.fill(255);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 6, 30);\n      }\n    }\n\n    p.pop();\n  };\n\n  p.mousePressed = () => {\n    if (survey_topics[current_survey_topic] != \"none\") {\n      p.mousePressedWhileSurveying();\n    } else {\n      p.mousePressedWhileNotSurveying();\n    }\n  };\n\n  p.finished_survey = () => {\n    survey_drop_target.effects.push(JSON.parse(JSON.stringify(theMouse.effect)));\n    current_survey_topic = 0;\n    theMouse.effect = null;\n    theMouse.busy = false;\n  };\n\n  p.keyPressed = () => {\n    if (p.key == ' ' && !simulating) {\n      simResults = null;\n      simTurns = null;\n      simulating = true;\n      simTime = simCount;\n      p.submit();\n    }\n  };\n\n  p.windowResized = () => {\n    p.resizeCanvas(p.windowWidth, p.windowHeight);\n    p.resize_all();\n  };\n\n  p.add_to_queue = () => {\n    if (!simulating) {\n      simulating = true;\n      simTime = p.millis();\n      p.submit();\n    }\n  };\n\n  p.sim_overlay = () => {\n    p.push();\n    let queur_x = p.map(2, 0, 3, w_padding, p.width - w_padding);\n    let queur_y = p.height * 0.85;\n    mouse_over_queuer = p.mouseX > queur_x - 100 && p.mouseX < queur_x + 100 && p.mouseY > queur_y - 30 && p.mouseY < queur_y + 30;\n    p.translate(queur_x, queur_y);\n\n    if (mouse_over_queuer && !simulating) {\n      p.fill(255, 255);\n    } else {\n      p.fill(p.map(p.millis(), simTime, simTime + simDuration, 100, 255, true), 100);\n    }\n\n    p.rect(0, 0, 200, 60, 4);\n    p.fill(0, 255);\n    p.textAlign(p.CENTER, p.CENTER);\n    p.text(simulating ? \"Adding...\" : \"Add to queue\", 0, -4);\n    p.rectMode(p.CORNER); // if(simulating)\n    // p.fill(0)\n    // p.rect(-100, -30, map(millis(), simTime, simTime+simDuration, 0, 200, true), 60, 4)\n\n    p.pop();\n\n    if (simulating) {\n      if (p.millis() > simTime + simDuration) {\n        simulating = false;\n      }\n    } // if (simulating) {\n    //   simTime = constrain(simTime - random(0.001, 0.002), 0, simCount);\n    //   let lw = map(simTime, 0, simCount, 0, 200);\n    //   noStroke();\n    //   p.fill(200);\n    //   p.rect(width * 0.5 - 100, height * 0.85 - 16, 200, 40)\n    //   p.fill(0)\n    //   p.rect(width * 0.5 - 100, height * 0.85 - 16, lw, 40)\n    //   p.fill(255);\n    //   text(\"Simulating...\", width * 0.5, height * 0.85)\n    // } else {\n    //   text(\"Press Spacebar to simulate\", width / 2, height * 0.9);\n    // }\n    // if (simResults != null) {\n    //   text(\"The win rate with your card is: \" + simResults +\n    //     \"%\\n\" + \"The average game lasted \" + simTurns +\n    //     \" turns.\", width * 0.5, height * 0.10);\n    // }\n\n  };\n\n  p.submit = () => {\n    let submissions = [];\n\n    for (let c of cards) {\n      let card_submission = {\n        id: c.card_id,\n        exp: c.card_experiment,\n        user: user,\n        p: c.power,\n        t: c.toughness,\n        m: c.mana\n      };\n      let repeat_checker = {};\n\n      for (let e of c.effects) {\n        if (repeat_checker[e.effect_short] == undefined) {\n          repeat_checker[e.effect_short] = 0;\n        } else {\n          repeat_checker[e.effect_short]++;\n        }\n\n        if (e.settings.methods[0] != null) card_submission[e.effect_short + \"-method-\" + repeat_checker[e.effect_short]] = e.settings.methods[1];\n        if (e.settings.params[0] != null) card_submission[e.effect_short + \"-param-\" + repeat_checker[e.effect_short]] = e.settings.params[1];\n        if (e.settings.targets[0] != null) card_submission[e.effect_short + \"-target-\" + repeat_checker[e.effect_short]] = e.settings.targets[1];\n        if (e.settings.filters[0] != null) card_submission[e.effect_short + \"-filter-\" + repeat_checker[e.effect_short]] = e.settings.filters[1];\n        if (e.settings.duration[0] != null) card_submission[e.effect_short + \"-duration-\" + repeat_checker[e.effect_short]] = e.settings.duration[1];\n      }\n\n      submissions[c.card_experiment + \"-\" + c.card_id] = card_submission;\n    }\n\n    p.send_to_google_sheets(submissions);\n  };\n\n  p.send_to_google_sheets = submissions => {\n    for (let submission of submissions) {} // gapi.load('client', ()=>{\n    //   gapi.client.init({ 'apiKey':  config.sheets_api_key}).then(()=>{\n    //     gapi.client.sheets.spreadsheets.values.get({\n    //       spreadsheetId: config.sheet_id,\n    //       range: \"queue!A1:D5\"\n    //     }).then((response) => {\n    //       var result = response.result;\n    //       var numRows = result.values ? result.values.length : 0;\n    //       console.log(`${numRows} rows retrieved.`);\n    //     });\n    //   }); \n    // });\n    // httpPost('https://hearth-mici-backend.loca.lt/get_winrates', submission, (response) => {\n    //   simulating = false;\n    //   simResults = round(JSON.parse(response).win_rate, 2);\n    //   simTurns = round(JSON.parse(response).num_turns, 2);\n    //   console.log(simResults, simTurns)\n    // });\n    // httpPost('https://sheets.googleapis.com/v4/spreadsheets/1TlgFYV4zwkyfwGq1DNU39Sq1kOsOaL3jfppokpmgX0w/values/queue!A1:E1:append?key='+config.sheets_api_key, {\n    //   range: \"queue!A1:E1\",\n    //   key: config.sheets_api_key,\n    //   majorDimension: \"ROWS\",\n    //   values: [\n    //     [\"Door\", \"$15\", \"2\", \"3/15/2016\"],\n    //     [\"Engine\", \"$100\", \"1\", \"3/20/2016\"],\n    //   ],\n    // }, (response) => {\n    //   console.log(response)\n    // });\n\n  };\n\n  p.resize_all = () => {\n    for (let b of buttons) {\n      b.resized();\n    }\n\n    for (let c of cards) {\n      c.resized();\n    }\n  };\n\n  p.register_effect = (effect_text, effect_short, method, param, targets, filters, duration) => {\n    effects[effect_text] = new Effect(effect_text, effect_short, method, param, targets, filters, duration);\n    buttons.push(new Button(effect_text, button_id++));\n  };\n\n  p.register_all = () => {\n    p.register_effect(\"Deal damage\", \"dam\", [\"randomly\", \"targeted\", \"all\"], [\"x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Destroy\", \"des\", [\"randomly\", \"targeted\", \"all\"], null, [\"minions\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Heal\", \"hea\", [\"randomly\", \"targeted\", \"all\"], [\"x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Gain armour\", \"arm\", null, [\"x\"], null, null, null);\n    p.register_effect(\"Change stats\", \"cha\", [\"randomly\", \"targeted\", \"all\", \"aura\"], [\"x/x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], [\"turn\", \"permanently\"]);\n    p.register_effect(\"Set stats\", \"set\", [\"randomly\", \"targeted\", \"all\", \"aura\"], [\"x/x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], [\"turn\", \"permanently\"]);\n    p.register_effect(\"Give keyword\", \"giv\", [\"randomly\", \"targeted\", \"all\", \"aura\"], [\"k\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], [\"turn\", \"permanently\"]);\n    p.register_effect(\"Return to hand\", \"ret\", [\"randomly\", \"targeted\", \"all\"], null, [\"minions\", \"murlocs\", \"beasts\", \"demons\", \"totems\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Draw\", \"dra\", null, [\"x\"], null, [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Gain mana\", \"gai\", null, [\"x\"], null, [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Summon\", \"sum\", null, [\"x/x\"], null, null, null);\n    p.register_effect(\"Keyword\", \"key\", null, [\"k\"], null, null, null);\n    p.register_effect(\"Creature type\", \"cre\", null, [\"c\"], null, null, null);\n  }; // p.FancyMouse = (fm) => {\n  //     this.busy = false;\n  //     this.xOffset = 0;\n  //     this.yOffset = 0;\n  //     this.effect = null;\n  //   fm.setOffset = (buttonX, buttonY) => {\n  //     this.xOffset = p.mouseX - buttonX;\n  //     this.yOffset = p.mouseY - buttonY;\n  //   }\n  // }\n\n\n  p.Effect = ef => {\n    ef.constructor = (label_name, effect_short, methods, param_format, targets, filters, duration) => {\n      this.x = 0;\n      this.y = 0;\n      this.effect_string = \"\";\n      this.effect_string_height = 0;\n      this.effect_string_width = blank_spell_img.width * 0.5;\n      this.label_name = label_name;\n      this.effect_short = effect_short;\n      this.settings = {\n        methods: [methods, \"\"],\n        params: [param_format, \"\"],\n        targets: [targets, \"\"],\n        filters: [filters, \"\"],\n        duration: [duration, \"\"]\n      };\n    };\n  };\n\n  p.Card = cd => {\n    cd.constructor = (card_id, card_experiment) => {\n      this.y = 0;\n      this.x = 0;\n      this.w = blank_spell_img.width * 0.75;\n      this.h = blank_spell_img.height * 0.75;\n      this.oversized = false;\n      this.class = \"mage\";\n      this.type_id = 1;\n      this.card_id = card_id;\n      this.card_experiment = card_experiment;\n      this.creature_type = \"\";\n      this.mana = 5;\n      this.power = 5;\n      this.toughness = 5;\n      this.keywords = [];\n      this.effects = [];\n      this.hovered_effect = null;\n      this.mouse_over_card_effect = false;\n      this.mouse_over_mana = false;\n      this.mouse_over_power = false;\n      this.mouse_over_toughness = false;\n    };\n\n    cd.resized = () => {\n      this.x = p.map(this.card_id + 1, 0, cards.length, w_padding, p.width - w_padding);\n      this.y = p.height / 2;\n    };\n\n    cd.run = () => {\n      this.generate_effect_text();\n      this.check_mouse_hovers();\n      this.display();\n    };\n\n    cd.generate_effect_text = () => {\n      for (let e of this.effects) {\n        e.effect_string = \"\";\n\n        if (e.label_name == \"Keyword\" || e.label_name == \"Creature type\") {\n          e.effect_string = e.settings.params[1];\n        } else if (e.label_name == \"Deal damage\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Randomly deal \" + e.settings.params[1] + \" damage to a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Deal \" + e.settings.params[1] + \" damage to target \";\n          } else {\n            e.effect_string = \"Deal \" + e.settings.params[1] + \" damage to all \";\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \"; //remove \"all all\"\n\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1];\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])];\n          }\n        } else if (e.label_name == \"Destroy\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Randomly destroy a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Destroy a target \";\n          } else {\n            e.effect_string = \"Destroy all \";\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \"; //remove \"all all\"\n\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1];\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])];\n          }\n        } else if (e.label_name == \"Heal\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a random \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a target \";\n          } else {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to all \";\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \"; //remove \"all all\"\n\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1];\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])];\n          }\n        } else {\n          e.effect_string = e.label_name;\n        }\n\n        let estimatedCharactersPerLine = 20;\n        let estimatedLines = e.effect_string.length / estimatedCharactersPerLine;\n        e.effect_string_height = smaller_font_size * estimatedLines + 30;\n      }\n    };\n\n    cd.display = () => {\n      p.push();\n      p.fill(0);\n      p.textAlign(p.CENTER, p.CENTER);\n\n      if (this.effects.length > 2) {\n        this.oversized = true;\n      } else {\n        this.oversized = false;\n      }\n\n      let flav;\n      let forg;\n\n      if (card_types[this.type_id] == \"spell\") {\n        flav = masked_flavour_rect;\n        forg = blank_spell_img;\n      } else if (card_types[this.type_id] == \"minion\") {\n        flav = masked_flavour_ellipse;\n        forg = this.oversized ? full_blank_creature_img : blank_creature_img;\n      } else {\n        flav = masked_flavour_rect;\n        forg = blank_weapon_img;\n      }\n\n      if (!this.oversized) {\n        p.image(flav, this.x + 5, this.y - 50, 300, 300);\n      }\n\n      p.image(forg, this.x, this.y, this.w, this.h);\n      p.push();\n      p.textSize(60);\n      p.fill(255);\n      p.strokeWeight(3);\n      p.stroke(0);\n\n      if (card_types[this.type_id] == \"minion\") {\n        p.text(this.power, this.x - this.w / 2.99, this.y + this.h / 2.8);\n        p.text(this.toughness, this.x + this.w / 2.6, this.y + this.h / 2.8);\n      }\n\n      p.text(this.mana, this.x - this.w / 2.99, this.y - this.h / 2.3);\n      p.pop();\n      p.push();\n      p.fill(0);\n      p.textSize(smaller_font_size);\n      let translation_offset_y;\n\n      if (this.oversized) {\n        translation_offset_y = this.y - this.h / 2 + 80;\n        p.translate(this.x, this.y - this.h / 2 + 80);\n      } else {\n        translation_offset_y = this.y + 50;\n        p.translate(this.x, this.y + 50);\n      }\n\n      this.mouse_over_card_effect = false;\n      this.hovered_effect = null;\n\n      for (let e of this.effects) {\n        translation_offset_y += e.effect_string_height / 2;\n        p.translate(0, e.effect_string_height / 2);\n\n        if (p.mouseY > translation_offset_y - e.effect_string_height / 2 && p.mouseY < translation_offset_y + e.effect_string_height / 2 && p.mouseX > this.x - e.effect_string_width / 2 && p.mouseX < this.x + e.effect_string_width / 2) {\n          this.mouse_over_card_effect = true;\n          this.hovered_effect = e;\n          this.hovered_effect.x = this.x - e.effect_string_width / 2;\n          this.hovered_effect.y = translation_offset_y - e.effect_string_height;\n          p.fill(0, 100);\n        } else {\n          p.fill(0, 50);\n        }\n\n        p.rect(0, 0, e.effect_string_width, e.effect_string_height, 4, 4);\n        p.fill(255, 255);\n        p.text(e.effect_string, 0, 0, blank_spell_img.width / 2, blank_spell_img.height / 2);\n        translation_offset_y += e.effect_string_height / 2 + 5;\n        p.translate(0, e.effect_string_height / 2 + 5);\n      }\n\n      p.pop();\n      p.push();\n\n      if (editing_card == this) {\n        if (editing == \"mana\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y - this.h / 2.3;\n        } else if (editing == \"power\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y + this.h / 2.8;\n        } else if (editing == \"toughness\") {\n          editX = this.x + this.w / 2.6;\n          editY = this.y + this.h / 2.8;\n        }\n      }\n\n      p.pop();\n    };\n\n    cd.mouseInImg = () => {\n      return p.mouseX > this.x - this.w / 2 - mouse_padding && p.mouseX < this.x + this.w / 2 + mouse_padding && p.mouseY > this.y - this.h / 2 - mouse_padding && p.mouseY < this.y + this.h / 2 + mouse_padding;\n    };\n\n    cd.check_mouse_hovers = () => {\n      if (card_types[this.type_id] == \"minion\") {\n        this.mouse_over_power = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y + this.h / 2.8) < 50;\n        this.mouse_over_toughness = p.dist(p.mouseX, p.mouseY, this.x + this.w / 2.6, this.y + this.h / 2.8) < 50;\n      }\n\n      this.mouse_over_mana = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y - this.h / 2.3) < 50;\n    };\n  };\n\n  p.Button = btn => {\n    btn.constructor = (button_name, button_id) => {\n      this.button_name = button_name;\n      this.button_id = button_id;\n      this.x = 0;\n      this.y = 0;\n      this.w = p.textWidth(button_name) + 14;\n      this.h = font_pixels + 10;\n      this.fillAlpha = 100;\n      this.text_x = 0;\n      this.text_y = 0;\n    };\n\n    btn.mouseInRegion = () => {\n      return p.mouseX > this.x - this.w / 2 - mouse_padding && p.mouseX < this.x + this.w / 2 + mouse_padding && p.mouseY > this.y - this.h / 2 - mouse_padding && p.mouseY < this.y + this.h / 2 + mouse_padding;\n    };\n\n    btn.resized = () => {\n      this.x = w_padding - 150 + this.w / 2 - 7;\n      this.y = p.map(this.button_id, 0, buttons.length, h_padding, p.height - h_padding);\n      this.text_x = this.x - this.w / 2 + 7;\n      this.text_y = this.y - 6;\n    };\n\n    btn.run = () => {\n      this.update();\n      this.display();\n    };\n\n    btn.update = () => {\n      if (this.mouseInRegion() && current_survey_topic == 0) {\n        this.fillAlpha = 255;\n      } else {\n        this.fillAlpha = 100;\n      }\n    };\n\n    btn.display = () => {\n      p.textSize(font_pixels);\n      p.textAlign(p.LEFT, p.CENTER);\n      p.fill(255, this.fillAlpha);\n      p.rect(this.x, this.y, this.w, this.h, 4, 4);\n      p.fill(0, 255);\n      p.text(this.button_name, this.text_x, this.text_y);\n    };\n  };\n\n  document.oncontextmenu = function () {\n    return false;\n  };\n}","map":{"version":3,"sources":["/Users/aep/phd/hearth-mici/src/sketch_stuff/sketch.js"],"names":["FancyMouse","constuctor","p","busy","xOffset","yOffset","effect","setOffset","buttonX","buttonY","mouseX","mouseY","Effect","constructor","label_name","effect_short","methods","param_format","targets","filters","duration","x","y","effect_string","effect_string_height","effect_string_width","blank_spell_img","width","settings","params","sketch","blank_creature_img","blank_weapon_img","full_blank_creature_img","bg","GAN_imgs","flavour_img","masked_flavour_ellipse","masked_flavour_rect","buttons","button_id","effects","experiments","user","cards","card_num","card_types","method_names","target_names","target_names_singular","filter_names","duration_names","param_format_names","effect_names","keywords","all_creature_types","creature_types","survey_topics","current_survey_topic","survey_drop_target","font_pixels","smaller_font_size","hearthstone_font","mouse_padding","w_padding","h_padding","grid_w_padding","grid_h_padding","theMouse","hoveredOption","editing","editing_card","effect_to_remove","editX","editY","simCount","simulating","simDuration","simTime","mouse_over_queuer","simResults","simTurns","props","myCustomRedrawAccordingToNewPropsHandler","_props","preload","loadImage","bg_img","spell_img","weapon_img","creature_img","gan_img","setup","createCanvas","windowWidth","windowHeight","getURLParams","height","imageMode","CENTER","rectMode","textSize","fill","noStroke","register_all","i","push","Card","resize_all","ellipse_mask","createGraphics","ellipse","rect_mask","rect","get","mask","draw","background","textAlign","LEFT","image","c","run","b","translate","text","pop","draw_edit_overlay","sim_overlay","draw_survey","setting","options","attack","defense","xPos","map","yPos","boxWidth","boxHeight","optionButtonWidth","length","optionButtonHeight","optionButtonsPadding","index","option","entries","optionString","toString","toUpperCase","substring","split","join","mousePressedWhileSurveying","progressSurveyThroughIssues","floor","mousePressedWhileNotSurveying","clickedCard","mouseInImg","dropEffectOnCard","clickToEditCard","add_to_queue","mouse_click_while_editing","mouseInRegion","text_x","text_y","JSON","parse","stringify","button_name","finished_survey","includes","mouse_over_mana","mouse_over_power","mouse_over_toughness","dist","mouse_over_card_effect","hovered_effect","splice","indexOf","mana","constrain","power","toughness","rotate","QUARTER_PI","mousePressed","keyPressed","key","submit","windowResized","resizeCanvas","millis","queur_x","queur_y","CORNER","submissions","card_submission","id","card_id","exp","card_experiment","t","m","repeat_checker","e","undefined","send_to_google_sheets","submission","resized","register_effect","effect_text","method","param","Button","ef","cd","w","h","oversized","class","type_id","creature_type","generate_effect_text","check_mouse_hovers","display","estimatedCharactersPerLine","estimatedLines","flav","forg","strokeWeight","stroke","translation_offset_y","btn","textWidth","fillAlpha","update","document","oncontextmenu"],"mappings":"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","sourcesContent":["class FancyMouse{\n  constuctor(p){\n    this.busy = false;\n    this.xOffset = 0;\n    this.yOffset = 0;\n    this.effect = null;\n    this.p = p;\n  }\n  setOffset(buttonX, buttonY) {\n    this.xOffset = this.p.mouseX - buttonX;\n    this.yOffset = this.p.mouseY - buttonY;\n  }\n}\n\n\n\nclass Effect {\n  constructor(label_name,effect_short,methods, param_format, targets, filters, duration) {\n    this.x = 0;\n    this.y = 0;\n\n    this.effect_string = \"\";\n    this.effect_string_height = 0;\n    this.effect_string_width = blank_spell_img.width * 0.5;\n    this.label_name = label_name;\n    this.effect_short = effect_short;\n\n    this.settings = {\n      methods: [methods, \"\"],\n      params: [param_format, \"\"],\n      targets: [targets, \"\"],\n      filters: [filters, \"\"],\n      duration: [duration, \"\"]\n    };\n}\n}\n\n\nexport default function sketch(p){\n\nlet blank_spell_img, blank_creature_img, blank_weapon_img, full_blank_creature_img;\nlet bg;\nlet GAN_imgs = [];\nlet flavour_img, masked_flavour_ellipse, masked_flavour_rect;\n\n\nconst buttons = [];\nlet button_id = 0;\n\nconst effects = [];\n\nlet experiments = [\"mvw\", \"2mur\", \"longer_game\"];\nlet user = \"\"\n\nconst cards = [];\nconst card_num = 3;\nconst card_types = [\"spell\", \"minion\", \"weapon\"]\n\nconst method_names = [\"randomly\", \"targeted\", \"all\", \"aura\"];\nconst target_names = [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"];\nconst target_names_singular = [\"minion\", \"hero\", \"minion or hero\", \"murloc\", \"beast\", \"demon\", \"totem\", \"weapon\"]\nconst filter_names = [\"enemy\", \"friendly\", \"all\"];\nconst duration_names = [\"turn\", \"permanently\"];\nconst param_format_names = [\"x\", \"x/x\", \"k\", \"c\"];\nconst effect_names = [\"Deal damage\", \"Destroy\", \"Heal\", \"Gain armour\", \"Change stats\", \"Set stats\", \"Give keyword\", \"Return to hand\", \"Draw\", \"Gain mana\", \"Summon: \", \"Battlecry: \", \"Deathrattle: \"]\nconst keywords = [\"Taunt\", \"Charge\", \"Lifesteal\", \"Spell damage +1\", \"Divine shield\", \"Poisonous\", \"Windfury\", \"Frozen\"]\nconst all_creature_types = [\"murloc\", \"beast\", \"demon\", \"totem\", \"dragon\", \"pirate\", \"mech\", \"elemental\"]\nconst creature_types = [\"Murloc\", \"Beast\", \"Demon\", \"Totem\"]\n\nconst survey_topics = [\"none\", \"methods\", \"filters\", \"targets\", \"duration\", \"params\"];\nlet current_survey_topic = 0;\n\nlet survey_drop_target = null;\n\n\nconst font_pixels = 24;\nconst smaller_font_size = 20;\nlet hearthstone_font;\nconst mouse_padding = 1;\nlet w_padding, h_padding;\nlet grid_w_padding, grid_h_padding;\n\nlet theMouse;\nlet hoveredOption = -1;\n\nlet editing = \"none\";\nlet editing_card = null;\nlet effect_to_remove = null;\nlet editX = 0;\nlet editY = 0;\n\nlet simCount = 3;\nlet simulating = false;\nlet simDuration = 2000;\nlet simTime = -simDuration;\n\nlet mouse_over_queuer;\n\nlet simResults = null;\nlet simTurns = null;\n\nlet props;\n\n\np.myCustomRedrawAccordingToNewPropsHandler = (_props) => {\n  props = _props;\n \n\n\n  // GAN_imgs.push(p.loadImage(\"../images/gan_samples/sample_\"+p.floor(p.random(1000))+\".jpg\"));\n  // flavour_img = p.random(GAN_imgs);\n\n}\n\np.preload = () => {\n\n  bg = p.loadImage(props.bg_img)\n  blank_spell_img = p.loadImage(props.spell_img);\n  blank_weapon_img = p.loadImage(props.weapon_img)\n  blank_creature_img = p.loadImage(props.creature_img)\n  full_blank_creature_img = p.loadImage(props.full_blank_creature_img);\n  flavour_img = p.loadImage(props.gan_img)\n  //bg = p.loadImage(bg_img);\n\n  // blank_spell_img = p.loadImage(\"../images/blank_cards/spell.png\");\n  // blank_weapon_img = p.loadImage(\"../images/blank_cards/weapon.png\")\n  // blank_creature_img = p.loadImage(\"../images/blank_cards/creature.png\")\n  // full_blank_creature_img = p.loadImage(\"../images/blank_cards/fullBlankCreature.png\");\n  \n  // GAN_imgs.push(p.loadImage(\"../images/gan_samples/sample_\"+p.floor(p.random(1000))+\".jpg\"));\n  // flavour_img = p.random(GAN_imgs);\n\n  //hearthstone_font = p.loadFont(\"https://fonts.googleapis.com/css2?family=Roboto&display=swap\");\n}\n\n\np.setup = () => {\n  p.createCanvas(p.windowWidth, p.windowHeight);\n  user = p.getURLParams().user;\n\n  h_padding = p.height * 0.1;\n  w_padding = p.width * 0.2;\n  grid_h_padding = p.height * 0.2;\n  grid_w_padding = p.width * 0.1;\n  p.imageMode(p.CENTER)\n  p.rectMode(p.CENTER);\n  //`p.textFont(hearthstone_font);\n  p.textSize(font_pixels);\n  p.fill(255);\n  p.noStroke();\n\n\n\n\n  theMouse = new FancyMouse(p);\n\n\n  p.register_all();\n\n\n  for (let i = 0; i < card_num; i++) {\n    cards.push(new p.Card(i, \"mvw\"));\n  }\n\n  p.resize_all();\n\n\n  let ellipse_mask = p.createGraphics(p.width, p.height);\n  p.ellipse_mask.ellipse(p.width / 2, p.height / 2+50, 900, 840)\n\n  let rect_mask = p.createGraphics(p.width, p.height);\n  p.rect_mask.rect(p.width / 2-450, p.height / 2 - 300, 900, 800)\n\n  masked_flavour_ellipse = flavour_img.get();\n  masked_flavour_ellipse.mask(ellipse_mask)\n  masked_flavour_rect = flavour_img.get();\n  masked_flavour_rect.mask(rect_mask)\n\n\n\n}\n\n\np.draw = () => {\n  p.background(255)\n  p.textAlign(p.LEFT, p.CENTER);\n  p.image(bg, p.width / 2, p.height / 2, p.width, p.height);\n\n  for (let c of cards) {\n    c.run();\n  }\n\n  for (let b of buttons) {\n    b.run();\n  }\n\n  if(theMouse.busy && current_survey_topic == 0){\n    p.push();\n    p.translate(p.mouseX-theMouse.xOffset, p.mouseY-theMouse.yOffset)\n    p.textSize(28)\n    p.text(theMouse.effect.label_name, 0, 0)\n    p.pop();\n  }\n\n  p.draw_edit_overlay();\n\n  p.sim_overlay();\n\n\n  if(survey_topics[current_survey_topic] != \"none\"){\n    p.draw_survey(); \n  }\n    \n}\n\n\n\np.draw_survey = () => {\n  p.push();\n  p.textAlign(p.CENTER, p.CENTER)\n  p.textSize(font_pixels)\n\n  p.rectMode(p.CENTER)\n  p.background(0, 100)\n\n  let setting = theMouse.effect.settings[survey_topics[current_survey_topic]]\n  let options = setting[0]\n\n    \n  if(setting[0][0] == \"x\"){\n    options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n  } else if(setting[0][0] == \"k\"){\n    options = keywords\n  } else if(setting[0][0] == \"c\"){\n    options = creature_types;\n  }\n  \n\n  if(options[0] == \"x/x\"){\n    for(let attack = 1; attack < 11; attack++){\n      for(let defense = 1; defense < 11; defense++){\n        let xPos = p.map(attack, 1, 10, grid_w_padding, p.width-grid_w_padding);\n        let yPos = p.map(defense, 1, 10, grid_h_padding, p.height-grid_h_padding);\n        let boxWidth = (p.width-grid_w_padding*2)/10;\n        let boxHeight = (p.height-grid_h_padding*2)/10;\n\n        if(p.mouseX > xPos - boxWidth/2 && p.mouseX < xPos + boxWidth/2 &&\n          p.mouseY > yPos - boxHeight/2 && p.mouseY < yPos+boxHeight/2){\n              p.fill(255, 100);\n          } else {\n            p.fill(255, 0);\n          }\n          p.rect(xPos, yPos, boxWidth, boxHeight);\n          p.fill(255);\n          p.text(attack + \"/\" + defense, xPos, yPos-10)\n      }\n    }\n  } else {\n\n\n  p.textSize(40);\n  p.fill(255)\n  p.text(theMouse.effect.label_name + \"...\", p.width/2, p.height*0.1);\n\n  p.textSize(font_pixels)\n  p.rectMode(p.CENTER)\n\n  let optionButtonWidth = (p.width/options.length)*0.5;\n  let optionButtonHeight = p.height*0.10;\n  let optionButtonsPadding = p.width*0.25;\n\n  for(let [index, option] of options.entries()){\n    let xPos = p.map(index, 0, options.length-1, optionButtonsPadding, p.width-optionButtonsPadding);\n    if(p.mouseX > xPos-optionButtonWidth/2 && p.mouseX < xPos + optionButtonWidth/2){\n      p.fill(255, 100)\n      hoveredOption = index;\n    } else {\n      p.fill(255, 50)\n    }\n    p.rect(xPos, p.height*0.5, optionButtonWidth, optionButtonHeight, 16);\n    p.fill(255);\n\n    let optionString = option.toString();\n    optionString = optionString[0].toUpperCase() + optionString.substring(1)\n    optionString = optionString.split(\" \").join(\"\\n\");\n\n    p.text(optionString, xPos, p.height/2)\n  }\n}\n  \np.pop();\n}\n\n\np.mousePressedWhileSurveying = () => {\n  if(p.progressSurveyThroughIssues()){\n    return\n  }\n\n\n  let setting = theMouse.effect.settings[survey_topics[current_survey_topic]];\n  let options = setting[0]\n  if(options[0] == \"x\"){\n    options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n  } else if (options[0] == \"k\"){\n    options = keywords;\n  } else if (options[0] == \"c\"){\n    options = creature_types;\n  }\n  \n  if(options[0] == \"x/x\"){\n    setting[1] = {x: p.floor(p.map(p.mouseX, 0, p.width, 1, 11)),\n                  y: p.floor(p.map(p.mouseY, 0, p.height, 1, 11))}\n  } else {\n    setting[1] = options[hoveredOption];\n  }\n  \n  current_survey_topic++;\n\n  if(p.progressSurveyThroughIssues()){\n    return\n  }\n\n}\n\n\np.mousePressedWhileNotSurveying = () => {\n  let clickedCard = null;\n\n  for (let c of cards) {\n    if (c.mouseInImg()) {\n      clickedCard = c;\n    }\n  }\n\n\n  if(clickedCard){\n    if(theMouse.busy){ //dropping effect onto a card\n      p.dropEffectOnCard(clickedCard)\n    } else { //clicking on a card generally\n      p.clickToEditCard(clickedCard)\n    }\n  } else {\n    if(theMouse.busy){ //clicked away to drop label\n      theMouse.busy = false;\n      theMouse.setOffset(0, 0);\n      theMouse.effect = null;\n    } else { //other clicks\n\n      if(mouse_over_queuer){\n        p.add_to_queue();\n      }\n\n      p.mouse_click_while_editing();\n      \n\n      for (let b of buttons) { //clicking on a button with an empty hand\n        if (b.mouseInRegion()) {\n          theMouse.busy = true;\n          theMouse.setOffset(b.text_x, b.text_y);\n          theMouse.effect = JSON.parse(JSON.stringify(effects[b.button_name]));\n\n          break;\n        }\n      }\n    }\n  }\n\n}\n\n\n\n//returns true if you need to return out of mouse\np.progressSurveyThroughIssues = () => {\n  if(current_survey_topic == survey_topics.length){\n    p.finished_survey();\n    return true;\n  }\n\n  for(let i = 0; i < survey_topics.length; i++){\n    if(theMouse.effect.settings[survey_topics[current_survey_topic]][0] == null ||\n      (!param_format_names.includes(theMouse.effect.settings[survey_topics[current_survey_topic]][0][0]) &&\n       theMouse.effect.settings[survey_topics[current_survey_topic]][0].length == 1)){\n      current_survey_topic++;\n      if(current_survey_topic == survey_topics.length){\n        p.finished_survey();\n        return true;\n      }\n    }\n  }\n\n\n  if(current_survey_topic == survey_topics.length){\n    p.finished_survey();\n    return true;\n  }\n\n\n  return false;\n}\n\np.dropEffectOnCard = (c) => {\n    current_survey_topic = 1;\n    survey_drop_target = c;\n\n    if(p.progressSurveyThroughIssues()){\n\n      return\n    }\n}\n\n\np.clickToEditCard = (c) => {\n\n  if(c.mouse_over_mana){\n    editing = \"mana\";\n    editing_card = c;\n  } else if(c.mouse_over_power){\n    editing = \"power\";\n    editing_card = c;\n  } else if(c.mouse_over_toughness && !(editing ==\"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)){\n    editing = \"toughness\";\n    editing_card = c;\n  } else if(c.mouse_over_card_effect && !(editing ==\"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10 )){\n    editing = \"effect\";\n    editX = c.hovered_effect.x + blank_spell_img.width/2;\n    editY = c.hovered_effect.y + c.hovered_effect.effect_string_height/2;\n    editing_card = c;\n    effect_to_remove = c.hovered_effect;\n   } else if(editing==\"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10){\n      editing_card.effects.splice(editing_card.effects.indexOf(effect_to_remove), 1);\n      editing = \"none\";\n    } else {\n    editing = \"none\";\n  }\n}\n\n\np.mouse_click_while_editing = () => {\n  if(editing == \"mana\"){\n    if(p.dist(p.mouseX, p.mouseY, editX-60, editY-50)<40){\n      editing_card.mana--;\n    } else if(p.dist(p.mouseX, p.mouseY, editX+60, editY-50)<40){\n      editing_card.mana++;\n    } else {\n      editing = \"none\"\n    }\n    editing_card.mana = p.constrain(editing_card.mana, 0, 10)\n  } else if(editing == \"power\"){\n\n    if(p.dist(p.mouseX, p.mouseY, editX-60, editY+50)<40){\n      editing_card.power--;\n    } else if(p.dist(p.mouseX, p.mouseY, editX+60, editY+50)<40){\n      editing_card.power++;\n    } else {\n      editing = \"none\"\n    }\n    editing_card.power = p.constrain(editing_card.power, 0, 10)\n  } else if(editing == \"toughness\"){\n\n    if(p.dist(p.mouseX, p.mouseY, editX-60, editY+50)<40){\n      editing_card.toughness--;\n    } else if(p.dist(p.mouseX, p.mouseY, editX+60, editY+50)<40){\n      editing_card.toughness++;\n    } else {\n      editing = \"none\"\n    }\n    editing_card.toughness = p.constrain(editing_card.toughness, 1, 10)\n  } else if(editing = \"effect\"){\n    editing = \"none\";\n  }\n} \n\n\np.draw_edit_overlay = () => {\n  p.push();\n  if(editing != \"none\"){\n    p.translate(editX, editY)\n    p.noStroke();\n    if(editing==\"effect\"){\n      p.rotate(p.QUARTER_PI);\n      p.fill(0);\n      p.rect(0, 0, 22, 6);\n      p.rect(0, 0, 6, 22);\n      p.fill(255);\n      p.rect(0, 0, 20, 4);\n      p.rect(0, 0, 4, 20);\n \n    } else {\n      p.fill(0);\n      p.rect(-60, editing==\"mana\"?-50:75, 32, 8);\n      p.rect(60, editing==\"mana\"?-50:75, 32, 8);\n      p.rect(60, editing==\"mana\"?-50:75, 8, 32);\n      p.fill(255);\n      p.rect(-60, editing==\"mana\"?-50:75, 30, 6);\n      p.rect(60, editing==\"mana\"?-50:75, 30, 6);\n      p.rect(60, editing==\"mana\"?-50:75, 6, 30);\n    }\n  }\n  p.pop();\n}\n\np.mousePressed = () => {\n\n  if(survey_topics[current_survey_topic] != \"none\"){\n    p.mousePressedWhileSurveying();\n  } else {\n    p.mousePressedWhileNotSurveying();\n  }\n}\n\np.finished_survey = () => {\n\n  survey_drop_target.effects.push(JSON.parse(JSON.stringify(theMouse.effect)))\n  current_survey_topic = 0;\n  theMouse.effect = null;\n  theMouse.busy = false;\n}\n\np.keyPressed = () => {\n  if (p.key == ' ' && !simulating) {\n    simResults = null;\n    simTurns = null;\n    simulating = true;\n    simTime = simCount;\n    p.submit();\n  }\n\n}\n\np.windowResized = () => {\n  p.resizeCanvas(p.windowWidth, p.windowHeight);\n  p.resize_all();\n}\n\np.add_to_queue = () => {\n  if(!simulating){\n    simulating = true;\n    simTime = p.millis();\n    p.submit();\n  }\n}\n\np.sim_overlay = () => {\n  p.push();\n  let queur_x = p.map(2, 0, 3, w_padding, p.width-w_padding);\n  let queur_y = p.height*0.85\n  mouse_over_queuer = (p.mouseX > queur_x - 100 && p.mouseX < queur_x + 100 && p.mouseY > queur_y-30 && p.mouseY < queur_y+30)\n\n  p.translate(queur_x, queur_y);\n\n  if(mouse_over_queuer && !simulating){\n    p.fill(255, 255);\n  } else {\n    p.fill(p.map(p.millis(), simTime, simTime+simDuration, 100, 255, true), 100)\n  } \n  p.rect(0, 0, 200, 60, 4)\n\n\n  p.fill(0, 255);\n  p.textAlign(p.CENTER, p.CENTER)\n  p.text(simulating?\"Adding...\":\"Add to queue\", 0, -4)\n\n  p.rectMode(p.CORNER)\n\n  // if(simulating)\n  // p.fill(0)\n  // p.rect(-100, -30, map(millis(), simTime, simTime+simDuration, 0, 200, true), 60, 4)\n\n\n  p.pop();\n\n  if(simulating){\n    if(p.millis() > simTime+simDuration){\n      simulating = false;\n    }\n  }\n  // if (simulating) {\n  //   simTime = constrain(simTime - random(0.001, 0.002), 0, simCount);\n\n  //   let lw = map(simTime, 0, simCount, 0, 200);\n  //   noStroke();\n  //   p.fill(200);\n  //   p.rect(width * 0.5 - 100, height * 0.85 - 16, 200, 40)\n  //   p.fill(0)\n  //   p.rect(width * 0.5 - 100, height * 0.85 - 16, lw, 40)\n  //   p.fill(255);\n  //   text(\"Simulating...\", width * 0.5, height * 0.85)\n  // } else {\n  //   text(\"Press Spacebar to simulate\", width / 2, height * 0.9);\n  // }\n\n  // if (simResults != null) {\n\n  //   text(\"The win rate with your card is: \" + simResults +\n  //     \"%\\n\" + \"The average game lasted \" + simTurns +\n  //     \" turns.\", width * 0.5, height * 0.10);\n  // }\n}\n\np.submit = () => {\n  let submissions = [];\n  for(let c of cards){\n\n    let card_submission = {\n      id: c.card_id,\n      exp: c.card_experiment,\n      user: user,\n      p: c.power,\n      t: c.toughness,\n      m: c.mana,\n\n    }\n\n    \n    let repeat_checker = {};\n\n    for (let e of c.effects) {\n      if(repeat_checker[e.effect_short] == undefined){\n        repeat_checker[e.effect_short] = 0;\n      } else {\n        repeat_checker[e.effect_short]++;\n      }\n\n      if(e.settings.methods[0] != null) card_submission[e.effect_short+\"-method-\"+repeat_checker[e.effect_short]] = e.settings.methods[1];\n      if(e.settings.params[0] != null) card_submission[e.effect_short+\"-param-\"+repeat_checker[e.effect_short]] = e.settings.params[1];\n      if(e.settings.targets[0] != null) card_submission[e.effect_short+\"-target-\"+repeat_checker[e.effect_short]] = e.settings.targets[1];\n      if(e.settings.filters[0] != null) card_submission[e.effect_short+\"-filter-\"+repeat_checker[e.effect_short]] = e.settings.filters[1];\n      if(e.settings.duration[0] != null) card_submission[e.effect_short+\"-duration-\"+repeat_checker[e.effect_short]] = e.settings.duration[1];\n\n    }\n    submissions[c.card_experiment+\"-\"+c.card_id] = card_submission;\n }\n\n\n p.send_to_google_sheets(submissions);\n\n}\n\n\np.send_to_google_sheets = (submissions) => {\n\n  for(let submission of submissions){\n\n    \n  }\n\n  // gapi.load('client', ()=>{\n  //   gapi.client.init({ 'apiKey':  config.sheets_api_key}).then(()=>{\n  //     gapi.client.sheets.spreadsheets.values.get({\n  //       spreadsheetId: config.sheet_id,\n  //       range: \"queue!A1:D5\"\n  //     }).then((response) => {\n  //       var result = response.result;\n  //       var numRows = result.values ? result.values.length : 0;\n  //       console.log(`${numRows} rows retrieved.`);\n  //     });\n  //   }); \n  // });\n\n\n\n\n\n\n\n  // httpPost('https://hearth-mici-backend.loca.lt/get_winrates', submission, (response) => {\n  //   simulating = false;\n  //   simResults = round(JSON.parse(response).win_rate, 2);\n  //   simTurns = round(JSON.parse(response).num_turns, 2);\n  //   console.log(simResults, simTurns)\n  // });\n\n\n  // httpPost('https://sheets.googleapis.com/v4/spreadsheets/1TlgFYV4zwkyfwGq1DNU39Sq1kOsOaL3jfppokpmgX0w/values/queue!A1:E1:append?key='+config.sheets_api_key, {\n  //   range: \"queue!A1:E1\",\n  //   key: config.sheets_api_key,\n  //   majorDimension: \"ROWS\",\n  //   values: [\n  //     [\"Door\", \"$15\", \"2\", \"3/15/2016\"],\n  //     [\"Engine\", \"$100\", \"1\", \"3/20/2016\"],\n  //   ],\n  // }, (response) => {\n  //   console.log(response)\n  // });\n\n}\n\np.resize_all = () => {\n  for (let b of buttons) {\n    b.resized();\n  }\n\n  for (let c of cards) {\n    c.resized();\n  }\n\n}\n\np.register_effect = (effect_text, effect_short, method, param, targets, filters, duration) => {\n\n  effects[effect_text] = new Effect(effect_text, effect_short, method, param, targets, filters, duration);\n  buttons.push(new Button(effect_text, button_id++));\n}\n\np.register_all = () => {\n\n  p.register_effect(\"Deal damage\", \"dam\",\n    [\"randomly\", \"targeted\", \"all\"],\n    [\"x\"],\n    [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\"],\n    [\"enemy\", \"friendly\", \"all\"],\n    null);\n\n  p.register_effect(\"Destroy\", \"des\",\n    [\"randomly\", \"targeted\", \"all\"],\n    null,\n    [\"minions\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"],\n    [\"enemy\", \"friendly\", \"all\"],\n    null);\n\n  p.register_effect(\"Heal\", \"hea\",\n    [\"randomly\", \"targeted\", \"all\"],\n    [\"x\"],\n    [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\"],\n    [\"enemy\", \"friendly\", \"all\"],\n    null);\n\n  p.register_effect(\"Gain armour\", \"arm\",\n    null,\n    [\"x\"],\n    null,\n    null,\n    null);\n\n  p.register_effect(\"Change stats\", \"cha\",\n    [\"randomly\", \"targeted\", \"all\", \"aura\"],\n    [\"x/x\"],\n    [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"],\n    [\"enemy\", \"friendly\", \"all\"],\n    [\"turn\", \"permanently\"]);\n\n  p.register_effect(\"Set stats\", \"set\",\n    [\"randomly\", \"targeted\", \"all\", \"aura\"],\n    [\"x/x\"],\n    [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"],\n    [\"enemy\", \"friendly\", \"all\"],\n    [\"turn\", \"permanently\"]);\n\n\n  p.register_effect(\"Give keyword\", \"giv\",\n    [\"randomly\", \"targeted\", \"all\", \"aura\"],\n    [\"k\"],\n    [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"],\n    [\"enemy\", \"friendly\", \"all\"],\n    [\"turn\", \"permanently\"]);\n\n  p.register_effect(\"Return to hand\", \"ret\",\n    [\"randomly\", \"targeted\", \"all\"],\n    null,\n    [\"minions\", \"murlocs\", \"beasts\", \"demons\", \"totems\"],\n    [\"enemy\", \"friendly\", \"all\"],\n    null);\n\n\n  p.register_effect(\"Draw\", \"dra\",\n    null,\n    [\"x\"],\n    null,\n    [\"enemy\", \"friendly\", \"all\"],\n    null);\n\n\n  p.register_effect(\"Gain mana\", \"gai\",\n    null,\n    [\"x\"],\n    null,\n    [\"enemy\", \"friendly\", \"all\"],\n    null);\n\n  p.register_effect(\"Summon\", \"sum\",\n    null,\n    [\"x/x\"],\n    null,\n    null,\n    null);\n\n    p.register_effect(\"Keyword\", \"key\",\n    null,\n    [\"k\"],\n    null,\n    null,\n    null);\n\n    p.register_effect(\"Creature type\", \"cre\",\n    null,\n    [\"c\"],\n    null,\n    null,\n    null);\n\n\n\n}\n\n\n// p.FancyMouse = (fm) => {\n \n//     this.busy = false;\n//     this.xOffset = 0;\n//     this.yOffset = 0;\n//     this.effect = null;\n  \n//   fm.setOffset = (buttonX, buttonY) => {\n//     this.xOffset = p.mouseX - buttonX;\n//     this.yOffset = p.mouseY - buttonY;\n//   }\n// }\n\n\n\n\n\np.Effect = (ef) => {\n  ef.constructor = (label_name,effect_short,methods, param_format, targets, filters, duration) => {\n    this.x = 0;\n    this.y = 0;\n\n    this.effect_string = \"\";\n    this.effect_string_height = 0;\n    this.effect_string_width = blank_spell_img.width * 0.5;\n    this.label_name = label_name;\n    this.effect_short = effect_short;\n\n    this.settings = {\n      methods: [methods, \"\"],\n      params: [param_format, \"\"],\n      targets: [targets, \"\"],\n      filters: [filters, \"\"],\n      duration: [duration, \"\"]\n    };\n  }\n}\n\n\np.Card = (cd) => {\n  cd.constructor = (card_id, card_experiment) => {\n      this.y = 0;\n      this.x = 0;\n      this.w = blank_spell_img.width * 0.75;\n      this.h = blank_spell_img.height * 0.75;\n      this.oversized = false;\n\n\n      this.class = \"mage\";\n      this.type_id = 1;\n      this.card_id = card_id;\n      this.card_experiment = card_experiment;\n\n      this.creature_type = \"\";\n      this.mana = 5;\n      this.power = 5;\n      this.toughness = 5;\n      this.keywords = [];\n      this.effects = [];\n\n      this.hovered_effect = null;\n      this.mouse_over_card_effect = false;\n      this.mouse_over_mana = false;\n      this.mouse_over_power = false;\n      this.mouse_over_toughness = false;\n\n\n  }\n\n  cd.resized = () => {\n      this.x = p.map(this.card_id + 1, 0, cards.length, w_padding, p.width - w_padding)\n      this.y = p.height / 2;\n  }\n\n  cd.run = () => {\n      this.generate_effect_text();\n      this.check_mouse_hovers();\n      this.display();\n  }\n\n  cd.generate_effect_text = () => {\n      for (let e of this.effects) {\n          e.effect_string = \"\";\n          if(e.label_name == \"Keyword\" || e.label_name == \"Creature type\"){\n              e.effect_string = e.settings.params[1];\n          } else if(e.label_name == \"Deal damage\"){\n              if(e.settings.methods[1] == \"randomly\"){\n                  e.effect_string = \"Randomly deal \" + e.settings.params[1] + \" damage to a \";\n              } else if(e.settings.methods[1] == \"targeted\"){\n                  e.effect_string = \"Deal \" + e.settings.params[1] + \" damage to target \";\n              } else {\n                  e.effect_string = \"Deal \" + e.settings.params[1] + \" damage to all \"\n              }\n\n              e.effect_string += e.settings.filters[1]==\"all\"?\"\":e.settings.filters[1] + \" \" //remove \"all all\"\n              if(e.settings.methods[1] == \"all\"){\n                  e.effect_string += e.settings.targets[1]\n              } else {\n                  e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])]\n              }\n          } else if(e.label_name ==\"Destroy\"){\n              if(e.settings.methods[1] == \"randomly\"){\n                  e.effect_string = \"Randomly destroy a \";\n              } else if(e.settings.methods[1] == \"targeted\"){\n                  e.effect_string = \"Destroy a target \";\n              } else {\n                  e.effect_string = \"Destroy all \"\n              }\n              e.effect_string += e.settings.filters[1]==\"all\"?\"\":e.settings.filters[1] + \" \" //remove \"all all\"\n              if(e.settings.methods[1] == \"all\"){\n                  e.effect_string += e.settings.targets[1]\n              } else {\n                  e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])]\n              }\n          } else if(e.label_name ==\"Heal\"){\n              if(e.settings.methods[1] == \"randomly\"){\n                  e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a random \";\n              } else if(e.settings.methods[1] == \"targeted\"){\n                  e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a target \";\n              } else {\n                  e.effect_string = \"Restore \" + e.settings.params[1] + \" health to all \";\n              }\n              e.effect_string += e.settings.filters[1]==\"all\"?\"\":e.settings.filters[1] + \" \" //remove \"all all\"\n              if(e.settings.methods[1] == \"all\"){\n                  e.effect_string += e.settings.targets[1]\n              } else {\n                  e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])]\n              }                \n          } else {\n              e.effect_string = e.label_name\n          }\n\n          \n\n          let estimatedCharactersPerLine = 20;\n          let estimatedLines =  e.effect_string.length/estimatedCharactersPerLine;\n          e.effect_string_height = smaller_font_size * estimatedLines + 30;\n          \n      }\n\n  }\n\n  cd.display = () => {\n    p.push();\n    p.fill(0);\n    p.textAlign(p.CENTER, p.CENTER)\n      if(this.effects.length > 2){\n          this.oversized = true;\n      } else {\n          this.oversized = false;\n      }\n      let flav;\n      let forg;\n\n      if (card_types[this.type_id] == \"spell\") {\n          flav = masked_flavour_rect;\n          forg = blank_spell_img;\n      } else if (card_types[this.type_id] == \"minion\") {\n          flav = masked_flavour_ellipse;\n          forg = this.oversized ? full_blank_creature_img:blank_creature_img;\n      } else {\n          flav = masked_flavour_rect;\n          forg = blank_weapon_img;\n      }\n\n      if(!this.oversized){\n        p.image(flav, this.x + 5, this.y - 50, 300, 300)\n      }\n      p.image(forg, this.x, this.y, this.w, this.h);\n\n      p.push();\n      p.textSize(60);\n      p.fill(255);\n      p.strokeWeight(3);\n      p.stroke(0);\n\n      if (card_types[this.type_id] == \"minion\") {\n        p.text(this.power, this.x-this.w/2.99, this.y+this.h/2.8)\n        p.text(this.toughness, this.x+this.w/2.6, this.y+this.h/2.8)\n      }\n\n    \n      p.text(this.mana, this.x-this.w/2.99, this.y-this.h/2.3)\n     \n      p.pop();\n\n     \n      p.push();\n      p.fill(0);\n      p.textSize(smaller_font_size);\n      let translation_offset_y;\n      if(this.oversized){\n          translation_offset_y = this.y - this.h/2 + 80;\n          p.translate(this.x, this.y - this.h/2 + 80);\n      } else {\n          translation_offset_y = this.y  + 50;\n          p.translate(this.x, this.y + 50);\n      }\n      \n      this.mouse_over_card_effect = false;\n      this.hovered_effect = null;\n      for(let e of this.effects){\n          \n          translation_offset_y += e.effect_string_height/2;\n          p.translate(0, e.effect_string_height/2)\n\n          if(p.mouseY > translation_offset_y - e.effect_string_height/2 &&\n            p.mouseY < translation_offset_y + e.effect_string_height/2 &&\n            p.mouseX > this.x - e.effect_string_width/2 &&\n            p.mouseX < this.x + e.effect_string_width/2){\n\n              this.mouse_over_card_effect = true;\n\n              this.hovered_effect = e;\n              this.hovered_effect.x = this.x - e.effect_string_width/2;\n              this.hovered_effect.y = translation_offset_y - e.effect_string_height;\n              p.fill(0, 100);\n          } else {\n              p.fill(0, 50)\n          }\n\n          p.rect(0, 0, e.effect_string_width, e.effect_string_height, 4, 4)\n          p.fill(255, 255)\n          p.text(e.effect_string, 0, 0, blank_spell_img.width/2, blank_spell_img.height/2)\n          translation_offset_y += e.effect_string_height/2+5;\n          p.translate(0, e.effect_string_height/2+5)\n\n      }\n      p.pop();\n\n\n      p.push();\n\n      if(editing_card == this){\n          if(editing == \"mana\"){\n              editX = this.x-this.w/2.99;\n              editY = this.y-this.h/2.3;\n          } else if(editing == \"power\"){\n              editX = this.x-this.w/2.99;\n              editY = this.y+this.h/2.8;\n          } else if(editing == \"toughness\"){\n              editX = this.x+this.w/2.6;\n              editY = this.y+this.h/2.8;\n          } \n      }\n\n      p.pop();\n  }\n\n\n  cd.mouseInImg = () => {\n      return (p.mouseX > this.x - this.w / 2 - mouse_padding &&\n        p.mouseX < this.x + this.w / 2 + mouse_padding &&\n        p.mouseY > this.y - this.h / 2 - mouse_padding &&\n        p.mouseY < this.y + this.h / 2 + mouse_padding);\n\n  }\n  cd.check_mouse_hovers = () => {\n      if (card_types[this.type_id] == \"minion\") {\n          this.mouse_over_power = p.dist(p.mouseX, p.mouseY, this.x-this.w/2.99, this.y+this.h/2.8) < 50\n          this.mouse_over_toughness = p.dist(p.mouseX, p.mouseY, this.x+this.w/2.6, this.y+this.h/2.8) < 50\n      }\n      this.mouse_over_mana = p.dist(p.mouseX, p.mouseY, this.x-this.w/2.99, this.y-this.h/2.3) < 50\n  }\n}\n\n\n\n\n\np.Button = (btn) =>{\n\n  btn.constructor = (button_name, button_id) => {\n    this.button_name = button_name;\n    this.button_id = button_id;\n\n    this.x = 0;\n    this.y = 0;\n    this.w = p.textWidth(button_name) + 14;\n    this.h = font_pixels + 10;\n    this.fillAlpha = 100;\n\n    this.text_x = 0;\n    this.text_y = 0;\n  }\n  btn.mouseInRegion = () => {\n    return (p.mouseX > this.x - this.w / 2 - mouse_padding &&\n      p.mouseX < this.x + this.w / 2 + mouse_padding &&\n      p.mouseY > this.y - this.h / 2 - mouse_padding &&\n      p.mouseY < this.y + this.h / 2 + mouse_padding);\n  }\n\n  btn.resized = () => {\n    this.x = w_padding - 150 + this.w / 2 - 7;\n    this.y = p.map(this.button_id, 0, buttons.length, h_padding, p.height - h_padding);\n    this.text_x = this.x - this.w / 2 + 7;\n    this.text_y = this.y - 6;\n  }\n\n  btn.run = () => {\n    this.update();\n    this.display();\n  }\n\n  btn.update = () => {\n\n    if (this.mouseInRegion() && current_survey_topic == 0) {\n      this.fillAlpha = 255;\n    } else {\n      this.fillAlpha = 100;\n    }\n\n  }\n\n  btn.display = () => {\n\n\n    p.textSize(font_pixels)\n    p.textAlign(p.LEFT, p.CENTER)\n    p.fill(255, this.fillAlpha);\n    p.rect(this.x, this.y, this.w, this.h, 4, 4);\n    p.fill(0, 255);\n    p.text(this.button_name, this.text_x, this.text_y);\n  }\n\n  \n}\n\n\ndocument.oncontextmenu = function() {\n  return false;\n}\n\n\n}"]},"metadata":{},"sourceType":"module"}