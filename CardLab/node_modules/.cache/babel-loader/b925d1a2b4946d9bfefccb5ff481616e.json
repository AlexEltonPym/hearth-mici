{"ast":null,"code":"/* eslint eqeqeq: \"off\", no-unused-vars: \"off\" */\n//to fix totalHeight bug, change p5 by changing o-totalHeight to just o\n//todo: fix this on a generic p5 import somehow\nexport default function sketch(p) {\n  let blank_spell_img, blank_creature_img, blank_weapon_img, full_blank_creature_img;\n  let bg;\n  let GAN_imgs = [];\n  let flavour_img, masked_flavour_ellipse, masked_flavour_rect;\n  const buttons = [];\n  let button_id = 0;\n  const effects = [];\n  const tasks = [{\n    title: \"Mage vs Warrior\",\n    instruction: \"Create 2 mage cards that helps against warriors.\",\n    num_cards: 3\n  }, {\n    title: \"Murlocs\",\n    instruction: \"Create 3 murlocs\",\n    num_cards: 3\n  }, {\n    title: \"The ultimate defense\",\n    instruction: \"Create the ultimate defensive card.\",\n    num_cards: 1\n  }];\n  let current_task_index = 0;\n  let user = \"\";\n  const cards = [];\n  const card_types = [\"spell\", \"minion\", \"weapon\"];\n  const method_names = [\"randomly\", \"targeted\", \"all\", \"aura\"];\n  const target_names = [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"];\n  const target_names_singular = [\"minion\", \"hero\", \"minion or hero\", \"murloc\", \"beast\", \"demon\", \"totem\", \"weapon\"];\n  const filter_names = [\"enemy\", \"friendly\", \"all\"];\n  const duration_names = [\"turn\", \"permanently\"];\n  const param_format_names = [\"x\", \"x/x\", \"k\", \"c\"];\n  const effect_names = [\"Deal damage\", \"Destroy\", \"Heal\", \"Gain armour\", \"Change stats\", \"Set stats\", \"Give keyword\", \"Return to hand\", \"Draw\", \"Gain mana\", \"Summon: \", \"Battlecry: \", \"Deathrattle: \"];\n  const keywords = [\"Taunt\", \"Charge\", \"Lifesteal\", \"Spell damage +1\", \"Divine shield\", \"Poisonous\", \"Windfury\", \"Frozen\"];\n  const all_creature_types = [\"murloc\", \"beast\", \"demon\", \"totem\", \"dragon\", \"pirate\", \"mech\", \"elemental\"];\n  const creature_types = [\"Murloc\", \"Beast\", \"Demon\", \"Totem\"];\n  const survey_topics = [\"none\", \"methods\", \"filters\", \"targets\", \"duration\", \"params\"];\n  let current_survey_topic = 0;\n  let survey_drop_target = null;\n  const font_pixels_large = 32;\n  ;\n  const font_pixels = 24;\n  const font_pixels_small = 20;\n  let hearthstone_font;\n  const mouse_padding = 1;\n  let w_padding, h_padding;\n  let grid_w_padding, grid_h_padding;\n  let theMouse;\n  let setupDone = false;\n  let hoveredOption = -1;\n  let editing = \"none\";\n  let editing_card = null;\n  let effect_to_remove = null;\n  let editX = 0;\n  let editY = 0;\n  let simCount = 3;\n  let simulating = false;\n  let simDuration = 2000;\n  let simTime = -simDuration;\n  let mouse_over_queuer;\n  let simResults = null;\n  let simTurns = null;\n  let props;\n\n  p.myCustomRedrawAccordingToNewPropsHandler = _props => {\n    props = _props;\n  };\n\n  p.preload = () => {\n    bg = p.loadImage(props.bg_img);\n    blank_spell_img = p.loadImage(props.spell_img);\n    blank_weapon_img = p.loadImage(props.weapon_img);\n    blank_creature_img = p.loadImage(props.creature_img);\n    full_blank_creature_img = p.loadImage(props.full_blank_creature_img);\n    flavour_img = p.loadImage(props.gan_img);\n    hearthstone_font = p.loadFont(props.hs_font);\n  };\n\n  p.setup = () => {\n    p.createCanvas(p.windowWidth, p.windowHeight);\n    user = p.getURLParams().user;\n    theMouse = new p.FancyMouse();\n    h_padding = p.height * 0.1;\n    w_padding = p.width * 0.2;\n    grid_h_padding = p.height * 0.2;\n    grid_w_padding = p.width * 0.1;\n    p.imageMode(p.CENTER);\n    p.rectMode(p.CENTER);\n    p.textFont(hearthstone_font);\n    p.textSize(font_pixels);\n    p.fill(255);\n    p.noStroke();\n    p.register_all();\n\n    for (let card_id = 0; card_id < tasks[current_task_index].num_cards; card_id++) {\n      cards.push(new p.Card(card_id, current_task_index));\n    }\n\n    p.resize_all();\n    setupDone = true;\n  };\n\n  p.draw = () => {\n    p.background(255);\n    p.textAlign(p.LEFT, p.CENTER);\n    p.image(bg, p.width / 2, p.height / 2, p.width, p.height);\n\n    for (let c of cards) {\n      c.run();\n    }\n\n    for (let b of buttons) {\n      b.run();\n    }\n\n    if (theMouse.busy && current_survey_topic == 0) {\n      p.push();\n      p.translate(p.mouseX - theMouse.xOffset, p.mouseY - theMouse.yOffset);\n      p.textSize(28);\n      p.text(theMouse.effect.label_name, 0, 0);\n      p.pop();\n    }\n\n    p.draw_task_overlay();\n    p.draw_edit_overlay();\n    p.sim_overlay();\n\n    if (survey_topics[current_survey_topic] != \"none\") {\n      p.draw_survey();\n    }\n  };\n\n  p.draw_task_overlay = () => {\n    p.textAlign(p.RIGHT, p.CENTER);\n    p.textSize(font_pixels_large);\n    p.text(tasks[current_task_index].title, p.width - w_padding / 2, h_padding);\n    p.textSize(font_pixels);\n    p.text(tasks[current_task_index].instruction, p.width - w_padding / 2, h_padding + font_pixels_large);\n  };\n\n  p.draw_survey = () => {\n    p.push();\n    p.textAlign(p.CENTER, p.CENTER);\n    p.textSize(font_pixels);\n    p.rectMode(p.CENTER);\n    p.background(0, 100);\n    let setting = theMouse.effect.settings[survey_topics[current_survey_topic]];\n    let options = setting[0];\n\n    if (setting[0][0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n    } else if (setting[0][0] == \"k\") {\n      options = keywords;\n    } else if (setting[0][0] == \"c\") {\n      options = creature_types;\n    }\n\n    if (options[0] == \"x/x\") {\n      for (let attack = 1; attack < 11; attack++) {\n        for (let defense = 1; defense < 11; defense++) {\n          let xPos = p.map(attack, 1, 10, grid_w_padding, p.width - grid_w_padding);\n          let yPos = p.map(defense, 1, 10, grid_h_padding, p.height - grid_h_padding);\n          let boxWidth = (p.width - grid_w_padding * 2) / 10;\n          let boxHeight = (p.height - grid_h_padding * 2) / 10;\n\n          if (p.mouseX > xPos - boxWidth / 2 && p.mouseX < xPos + boxWidth / 2 && p.mouseY > yPos - boxHeight / 2 && p.mouseY < yPos + boxHeight / 2) {\n            p.fill(255, 100);\n          } else {\n            p.fill(255, 0);\n          }\n\n          p.rect(xPos, yPos, boxWidth, boxHeight);\n          p.fill(255);\n          p.text(attack + \"/\" + defense, xPos, yPos - 10);\n        }\n      }\n    } else {\n      p.textSize(40);\n      p.fill(255);\n      p.text(theMouse.effect.label_name + \"...\", p.width / 2, p.height * 0.1);\n      p.textSize(font_pixels);\n      p.rectMode(p.CENTER);\n      let optionButtonWidth = p.width / options.length * 0.5;\n      let optionButtonHeight = p.height * 0.10;\n      let optionButtonsPadding = p.width * 0.25;\n\n      for (let [index, option] of options.entries()) {\n        let xPos = p.map(index, 0, options.length - 1, optionButtonsPadding, p.width - optionButtonsPadding);\n\n        if (p.mouseX > xPos - optionButtonWidth / 2 && p.mouseX < xPos + optionButtonWidth / 2) {\n          p.fill(255, 100);\n          hoveredOption = index;\n        } else {\n          p.fill(255, 50);\n        }\n\n        p.rect(xPos, p.height * 0.5, optionButtonWidth, optionButtonHeight, 16);\n        p.fill(255);\n        let optionString = option.toString();\n        optionString = optionString[0].toUpperCase() + optionString.substring(1);\n        optionString = optionString.split(\" \").join(\"\\n\");\n        p.text(optionString, xPos, p.height / 2);\n      }\n    }\n\n    p.pop();\n  };\n\n  p.mousePressedWhileSurveying = () => {\n    if (p.progressSurveyThroughIssues()) {\n      return;\n    }\n\n    let setting = theMouse.effect.settings[survey_topics[current_survey_topic]];\n    let options = setting[0];\n\n    if (options[0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n    } else if (options[0] == \"k\") {\n      options = keywords;\n    } else if (options[0] == \"c\") {\n      options = creature_types;\n    }\n\n    if (options[0] == \"x/x\") {\n      setting[1] = {\n        x: p.floor(p.map(p.mouseX, 0, p.width, 1, 11)),\n        y: p.floor(p.map(p.mouseY, 0, p.height, 1, 11))\n      };\n    } else {\n      setting[1] = options[hoveredOption];\n    }\n\n    current_survey_topic++;\n\n    if (p.progressSurveyThroughIssues()) {\n      return;\n    }\n  };\n\n  p.mousePressedWhileNotSurveying = () => {\n    let clickedCard = null;\n\n    for (let c of cards) {\n      if (c.mouseInImg()) {\n        clickedCard = c;\n      }\n    }\n\n    if (clickedCard) {\n      if (theMouse.busy) {\n        //dropping effect onto a card\n        p.dropEffectOnCard(clickedCard);\n      } else {\n        //clicking on a card generally\n        p.clickToEditCard(clickedCard);\n      }\n    } else {\n      if (theMouse.busy) {\n        //clicked away to drop label\n        theMouse.busy = false;\n        theMouse.setOffset(0, 0);\n        theMouse.effect = null;\n      } else {\n        //other clicks\n        if (mouse_over_queuer) {\n          p.add_to_queue();\n        }\n\n        p.mouse_click_while_editing();\n\n        for (let b of buttons) {\n          //clicking on a button with an empty hand\n          if (b.mouseInRegion()) {\n            theMouse.busy = true;\n            theMouse.setOffset(b.text_x, b.text_y);\n            theMouse.effect = JSON.parse(JSON.stringify(effects[b.button_name]));\n            break;\n          }\n        }\n      }\n    }\n  }; //returns true if you need to return out of mouse\n\n\n  p.progressSurveyThroughIssues = () => {\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n    for (let i = 0; i < survey_topics.length; i++) {\n      if (theMouse.effect.settings[survey_topics[current_survey_topic]][0] == null || !param_format_names.includes(theMouse.effect.settings[survey_topics[current_survey_topic]][0][0]) && theMouse.effect.settings[survey_topics[current_survey_topic]][0].length == 1) {\n        current_survey_topic++;\n\n        if (current_survey_topic == survey_topics.length) {\n          p.finished_survey();\n          return true;\n        }\n      }\n    }\n\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n    return false;\n  };\n\n  p.dropEffectOnCard = c => {\n    current_survey_topic = 1;\n    survey_drop_target = c;\n\n    if (p.progressSurveyThroughIssues()) {\n      return;\n    }\n  };\n\n  p.clickToEditCard = c => {\n    if (c.mouse_over_mana) {\n      editing = \"mana\";\n      editing_card = c;\n    } else if (c.mouse_over_power) {\n      editing = \"power\";\n      editing_card = c;\n    } else if (c.mouse_over_toughness && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"toughness\";\n      editing_card = c;\n    } else if (c.mouse_over_card_effect && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"effect\";\n      editX = c.hovered_effect.x + blank_spell_img.width / 2;\n      editY = c.hovered_effect.y + c.hovered_effect.effect_string_height / 2;\n      editing_card = c;\n      effect_to_remove = c.hovered_effect;\n    } else if (editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10) {\n      editing_card.effects.splice(editing_card.effects.indexOf(effect_to_remove), 1);\n      editing = \"none\";\n    } else {\n      editing = \"none\";\n    }\n  };\n\n  p.mouse_click_while_editing = () => {\n    if (editing == \"mana\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY - 50) < 40) {\n        editing_card.mana--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY - 50) < 40) {\n        editing_card.mana++;\n      } else {\n        editing = \"none\";\n      }\n\n      editing_card.mana = p.constrain(editing_card.mana, 0, 10);\n    } else if (editing == \"power\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.power--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.power++;\n      } else {\n        editing = \"none\";\n      }\n\n      editing_card.power = p.constrain(editing_card.power, 0, 10);\n    } else if (editing == \"toughness\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.toughness--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.toughness++;\n      } else {\n        editing = \"none\";\n      }\n\n      editing_card.toughness = p.constrain(editing_card.toughness, 1, 10);\n    } else if (editing == \"effect\") {\n      editing = \"none\";\n    }\n  };\n\n  p.draw_edit_overlay = () => {\n    p.push();\n\n    if (editing != \"none\") {\n      p.translate(editX, editY);\n      p.noStroke();\n\n      if (editing == \"effect\") {\n        p.rotate(p.QUARTER_PI);\n        p.fill(0);\n        p.rect(0, 0, 22, 6);\n        p.rect(0, 0, 6, 22);\n        p.fill(255);\n        p.rect(0, 0, 20, 4);\n        p.rect(0, 0, 4, 20);\n      } else {\n        p.fill(0);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 8, 32);\n        p.fill(255);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 6, 30);\n      }\n    }\n\n    p.pop();\n  };\n\n  p.mousePressed = () => {\n    if (setupDone) {\n      if (survey_topics[current_survey_topic] != \"none\") {\n        p.mousePressedWhileSurveying();\n      } else {\n        p.mousePressedWhileNotSurveying();\n      }\n    }\n  };\n\n  p.finished_survey = () => {\n    survey_drop_target.effects.push(JSON.parse(JSON.stringify(theMouse.effect)));\n    current_survey_topic = 0;\n    theMouse.effect = null;\n    theMouse.busy = false;\n  };\n\n  p.keyPressed = () => {\n    if (p.key == ' ' && !simulating) {\n      simResults = null;\n      simTurns = null;\n      simulating = true;\n      simTime = simCount;\n      p.submit();\n    }\n  };\n\n  p.windowResized = () => {\n    p.resizeCanvas(p.windowWidth, p.windowHeight);\n    p.resize_all();\n  };\n\n  p.add_to_queue = () => {\n    if (!simulating) {\n      simulating = true;\n      simTime = p.millis();\n      p.submit();\n    }\n  };\n\n  p.sim_overlay = () => {\n    p.push();\n    let queur_x = p.map(2, 0, 3, w_padding, p.width - w_padding);\n    let queur_y = p.height * 0.85;\n    mouse_over_queuer = p.mouseX > queur_x - 100 && p.mouseX < queur_x + 100 && p.mouseY > queur_y - 30 && p.mouseY < queur_y + 30;\n    p.translate(queur_x, queur_y);\n\n    if (mouse_over_queuer && !simulating) {\n      p.fill(255, 255);\n    } else {\n      p.fill(p.map(p.millis(), simTime, simTime + simDuration, 100, 255, true), 100);\n    }\n\n    p.rect(0, 0, 200, 60, 4);\n    p.fill(0, 255);\n    p.textAlign(p.CENTER, p.CENTER);\n    p.text(simulating ? \"Adding...\" : \"Add to queue\", 0, -4);\n    p.rectMode(p.CORNER); // if(simulating)\n    // p.fill(0)\n    // p.rect(-100, -30, map(millis(), simTime, simTime+simDuration, 0, 200, true), 60, 4)\n\n    p.pop();\n\n    if (simulating) {\n      if (p.millis() > simTime + simDuration) {\n        simulating = false;\n      }\n    } // if (simulating) {\n    //   simTime = constrain(simTime - random(0.001, 0.002), 0, simCount);\n    //   let lw = map(simTime, 0, simCount, 0, 200);\n    //   noStroke();\n    //   p.fill(200);\n    //   p.rect(width * 0.5 - 100, height * 0.85 - 16, 200, 40)\n    //   p.fill(0)\n    //   p.rect(width * 0.5 - 100, height * 0.85 - 16, lw, 40)\n    //   p.fill(255);\n    //   text(\"Simulating...\", width * 0.5, height * 0.85)\n    // } else {\n    //   text(\"Press Spacebar to simulate\", width / 2, height * 0.9);\n    // }\n    // if (simResults != null) {\n    //   text(\"The win rate with your card is: \" + simResults +\n    //     \"%\\n\" + \"The average game lasted \" + simTurns +\n    //     \" turns.\", width * 0.5, height * 0.10);\n    // }\n\n  };\n\n  p.submit = () => {\n    let submissions = [];\n\n    for (let c of cards) {\n      let card_submission = {\n        id: c.card_id,\n        task: c.card_task,\n        user: user,\n        p: c.power,\n        t: c.toughness,\n        m: c.mana\n      };\n      let repeat_checker = {};\n\n      for (let e of c.effects) {\n        if (repeat_checker[e.effect_short] == undefined) {\n          repeat_checker[e.effect_short] = 0;\n        } else {\n          repeat_checker[e.effect_short]++;\n        }\n\n        if (e.settings.methods[0] != null) card_submission[e.effect_short + \"-method-\" + repeat_checker[e.effect_short]] = e.settings.methods[1];\n        if (e.settings.params[0] != null) card_submission[e.effect_short + \"-param-\" + repeat_checker[e.effect_short]] = e.settings.params[1];\n        if (e.settings.targets[0] != null) card_submission[e.effect_short + \"-target-\" + repeat_checker[e.effect_short]] = e.settings.targets[1];\n        if (e.settings.filters[0] != null) card_submission[e.effect_short + \"-filter-\" + repeat_checker[e.effect_short]] = e.settings.filters[1];\n        if (e.settings.duration[0] != null) card_submission[e.effect_short + \"-duration-\" + repeat_checker[e.effect_short]] = e.settings.duration[1];\n      }\n\n      submissions[c.card_task + \"-\" + c.card_id] = card_submission;\n    }\n\n    props.send_to_google_sheets(submissions);\n  }; // gapi.load('client', ()=>{\n  //   gapi.client.init({ 'apiKey':  config.sheets_api_key}).then(()=>{\n  //     gapi.client.sheets.spreadsheets.values.get({\n  //       spreadsheetId: config.sheet_id,\n  //       range: \"queue!A1:D5\"\n  //     }).then((response) => {\n  //       var result = response.result;\n  //       var numRows = result.values ? result.values.length : 0;\n  //       console.log(`${numRows} rows retrieved.`);\n  //     });\n  //   }); \n  // });\n  // httpPost('https://hearth-mici-backend.loca.lt/get_winrates', submission, (response) => {\n  //   simulating = false;\n  //   simResults = round(JSON.parse(response).win_rate, 2);\n  //   simTurns = round(JSON.parse(response).num_turns, 2);\n  //   console.log(simResults, simTurns)\n  // });\n  // httpPost('https://sheets.googleapis.com/v4/spreadsheets/1TlgFYV4zwkyfwGq1DNU39Sq1kOsOaL3jfppokpmgX0w/values/queue!A1:E1:append?key='+config.sheets_api_key, {\n  //   range: \"queue!A1:E1\",\n  //   key: config.sheets_api_key,\n  //   majorDimension: \"ROWS\",\n  //   values: [\n  //     [\"Door\", \"$15\", \"2\", \"3/15/2016\"],\n  //     [\"Engine\", \"$100\", \"1\", \"3/20/2016\"],\n  //   ],\n  // }, (response) => {\n  //   console.log(response)\n  // });\n\n\n  p.resize_all = () => {\n    for (let b of buttons) {\n      b.resized();\n    }\n\n    for (let c of cards) {\n      c.resized();\n    }\n\n    p.mask_images();\n  };\n\n  p.mask_images = () => {\n    let ellipse_mask = p.createGraphics(p.width, p.height);\n    ellipse_mask.ellipse(p.width / 2, p.height / 2, 500, 500);\n    let rect_mask = p.createGraphics(p.width, p.height);\n    rect_mask.rectMode(p.CENTER);\n    rect_mask.rect(p.width / 2, p.height / 2, 700, 700);\n    masked_flavour_ellipse = flavour_img.get(); // masked_flavour_ellipse.mask(ellipse_mask)\n\n    masked_flavour_rect = flavour_img.get(); //masked_flavour_rect.mask(rect_mask)\n  };\n\n  p.register_effect = (effect_text, effect_short, method, param, targets, filters, duration) => {\n    effects[effect_text] = new p.Effect(effect_text, effect_short, method, param, targets, filters, duration);\n    buttons.push(new p.Button(effect_text, button_id++));\n  };\n\n  p.register_all = () => {\n    p.register_effect(\"Deal damage\", \"dam\", [\"randomly\", \"targeted\", \"all\"], [\"x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Destroy\", \"des\", [\"randomly\", \"targeted\", \"all\"], null, [\"minions\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Heal\", \"hea\", [\"randomly\", \"targeted\", \"all\"], [\"x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Gain armour\", \"arm\", null, [\"x\"], null, null, null);\n    p.register_effect(\"Change stats\", \"cha\", [\"randomly\", \"targeted\", \"all\", \"aura\"], [\"x/x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], [\"turn\", \"permanently\"]);\n    p.register_effect(\"Set stats\", \"set\", [\"randomly\", \"targeted\", \"all\", \"aura\"], [\"x/x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], [\"turn\", \"permanently\"]);\n    p.register_effect(\"Give keyword\", \"giv\", [\"randomly\", \"targeted\", \"all\", \"aura\"], [\"k\"], [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], [\"turn\", \"permanently\"]);\n    p.register_effect(\"Return to hand\", \"ret\", [\"randomly\", \"targeted\", \"all\"], null, [\"minions\", \"murlocs\", \"beasts\", \"demons\", \"totems\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Draw\", \"dra\", null, [\"x\"], null, [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Gain mana\", \"gai\", null, [\"x\"], null, [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Summon\", \"sum\", null, [\"x/x\"], null, null, null);\n    p.register_effect(\"Keyword\", \"key\", null, [\"k\"], null, null, null);\n    p.register_effect(\"Creature type\", \"cre\", null, [\"c\"], null, null, null);\n  };\n\n  p.FancyMouse = class {\n    constuctor() {\n      this.busy = false;\n      this.xOffset = 0;\n      this.yOffset = 0;\n      this.effect = null;\n    }\n\n    setOffset(buttonX, buttonY) {\n      this.xOffset = p.mouseX - buttonX;\n      this.yOffset = p.mouseY - buttonY;\n    }\n\n  };\n  p.Effect = class {\n    constructor(label_name, effect_short, methods, param_format, targets, filters, duration) {\n      this.x = 0;\n      this.y = 0;\n      this.effect_string = \"\";\n      this.effect_string_height = 0;\n      this.effect_string_width = blank_spell_img.width * 0.5;\n      this.label_name = label_name;\n      this.effect_short = effect_short;\n      this.settings = {\n        methods: [methods, \"\"],\n        params: [param_format, \"\"],\n        targets: [targets, \"\"],\n        filters: [filters, \"\"],\n        duration: [duration, \"\"]\n      };\n    }\n\n  };\n  p.Card = class {\n    constructor(card_id, card_task_index) {\n      this.y = 0;\n      this.x = 0;\n      this.w = blank_spell_img.width * 0.75;\n      this.h = blank_spell_img.height * 0.75;\n      this.oversized = false;\n      this.class = \"mage\";\n      this.type_id = card_id;\n      this.card_id = card_id;\n      this.card_index = card_task_index;\n      this.creature_type = \"\";\n      this.mana = 5;\n      this.power = 5;\n      this.toughness = 5;\n      this.keywords = [];\n      this.effects = [];\n      this.hovered_effect = null;\n      this.mouse_over_card_effect = false;\n      this.mouse_over_mana = false;\n      this.mouse_over_power = false;\n      this.mouse_over_toughness = false;\n    }\n\n    resized() {\n      this.x = p.map(this.card_id + 1, 0, cards.length, w_padding, p.width - w_padding);\n      this.y = p.height / 2;\n    }\n\n    run() {\n      this.generate_effect_text();\n      this.check_mouse_hovers();\n      this.display();\n    }\n\n    generate_effect_text() {\n      for (let e of this.effects) {\n        e.effect_string = \"\";\n\n        if (e.label_name == \"Keyword\" || e.label_name == \"Creature type\") {\n          e.effect_string = e.settings.params[1];\n        } else if (e.label_name == \"Deal damage\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Randomly deal \" + e.settings.params[1] + \" damage to a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Deal \" + e.settings.params[1] + \" damage to target \";\n          } else {\n            e.effect_string = \"Deal \" + e.settings.params[1] + \" damage to all \";\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \"; //remove \"all all\"\n\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1];\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])];\n          }\n        } else if (e.label_name == \"Destroy\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Randomly destroy a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Destroy a target \";\n          } else {\n            e.effect_string = \"Destroy all \";\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \"; //remove \"all all\"\n\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1];\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])];\n          }\n        } else if (e.label_name == \"Heal\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a random \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a target \";\n          } else {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to all \";\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \"; //remove \"all all\"\n\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1];\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])];\n          }\n        } else {\n          e.effect_string = e.label_name;\n        }\n\n        let estimatedCharactersPerLine = 20;\n        let estimatedLines = e.effect_string.length / estimatedCharactersPerLine;\n        e.effect_string_height = font_pixels_small * estimatedLines + 30;\n      }\n    }\n\n    display() {\n      p.push();\n      p.fill(0);\n      p.textAlign(p.CENTER, p.CENTER);\n\n      if (this.effects.length > 2) {\n        this.oversized = true;\n      } else {\n        this.oversized = false;\n      }\n\n      let flav;\n      let forg;\n\n      if (card_types[this.type_id] == \"spell\") {\n        flav = masked_flavour_rect;\n        forg = blank_spell_img;\n      } else if (card_types[this.type_id] == \"minion\") {\n        flav = masked_flavour_ellipse;\n        forg = this.oversized ? full_blank_creature_img : blank_creature_img;\n      } else {\n        flav = masked_flavour_rect;\n        forg = blank_weapon_img;\n      }\n\n      if (!this.oversized) {\n        p.image(flav, this.x, this.y, 300, 300);\n      }\n\n      p.image(forg, this.x, this.y, this.w, this.h);\n      p.push();\n      p.textSize(60);\n      p.fill(255);\n      p.strokeWeight(3);\n      p.stroke(0);\n\n      if (card_types[this.type_id] == \"minion\") {\n        p.text(this.power, this.x - this.w / 2.99, this.y + this.h / 2.8);\n        p.text(this.toughness, this.x + this.w / 2.6, this.y + this.h / 2.8);\n      }\n\n      p.text(this.mana, this.x - this.w / 2.99, this.y - this.h / 2.3);\n      p.pop();\n      p.push();\n      p.fill(0);\n      p.textSize(font_pixels_small);\n      let translation_offset_y;\n\n      if (this.oversized) {\n        translation_offset_y = this.y - this.h / 2 + 80;\n        p.translate(this.x, this.y - this.h / 2 + 80);\n      } else {\n        translation_offset_y = this.y + 50;\n        p.translate(this.x, this.y + 50);\n      }\n\n      this.mouse_over_card_effect = false;\n      this.hovered_effect = null;\n\n      for (let e of this.effects) {\n        translation_offset_y += e.effect_string_height / 2;\n        p.translate(0, e.effect_string_height / 2);\n\n        if (p.mouseY > translation_offset_y - e.effect_string_height / 2 && p.mouseY < translation_offset_y + e.effect_string_height / 2 && p.mouseX > this.x - e.effect_string_width / 2 && p.mouseX < this.x + e.effect_string_width / 2) {\n          this.mouse_over_card_effect = true;\n          this.hovered_effect = e;\n          this.hovered_effect.x = this.x - e.effect_string_width / 2;\n          this.hovered_effect.y = translation_offset_y - e.effect_string_height;\n          p.fill(0, 100);\n        } else {\n          p.fill(0, 50);\n        }\n\n        p.rect(0, 0, e.effect_string_width, e.effect_string_height, 4, 4);\n        p.fill(255, 255);\n        p.text(e.effect_string, 0, 0, blank_spell_img.width / 2, blank_spell_img.height / 2);\n        translation_offset_y += e.effect_string_height / 2 + 5;\n        p.translate(0, e.effect_string_height / 2 + 5);\n      }\n\n      p.pop();\n      p.push();\n\n      if (editing_card == this) {\n        if (editing == \"mana\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y - this.h / 2.3;\n        } else if (editing == \"power\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y + this.h / 2.8;\n        } else if (editing == \"toughness\") {\n          editX = this.x + this.w / 2.6;\n          editY = this.y + this.h / 2.8;\n        }\n      }\n\n      p.pop();\n    }\n\n    mouseInImg() {\n      return p.mouseX > this.x - this.w / 2 - mouse_padding && p.mouseX < this.x + this.w / 2 + mouse_padding && p.mouseY > this.y - this.h / 2 - mouse_padding && p.mouseY < this.y + this.h / 2 + mouse_padding;\n    }\n\n    check_mouse_hovers() {\n      if (card_types[this.type_id] == \"minion\") {\n        this.mouse_over_power = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y + this.h / 2.8) < 50;\n        this.mouse_over_toughness = p.dist(p.mouseX, p.mouseY, this.x + this.w / 2.6, this.y + this.h / 2.8) < 50;\n      }\n\n      this.mouse_over_mana = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y - this.h / 2.3) < 50;\n    }\n\n  };\n  p.Button = class {\n    constructor(button_name, button_id) {\n      this.button_name = button_name;\n      this.button_id = button_id;\n      this.x = 0;\n      this.y = 0;\n      this.w = p.textWidth(button_name) + 14;\n      this.h = font_pixels + 10;\n      this.fillAlpha = 100;\n      this.text_x = 0;\n      this.text_y = 0;\n    }\n\n    mouseInRegion() {\n      return p.mouseX > this.x - this.w / 2 - mouse_padding && p.mouseX < this.x + this.w / 2 + mouse_padding && p.mouseY > this.y - this.h / 2 - mouse_padding && p.mouseY < this.y + this.h / 2 + mouse_padding;\n    }\n\n    resized() {\n      this.x = w_padding - 150 + this.w / 2 - 7;\n      this.y = p.map(this.button_id, 0, buttons.length, h_padding, p.height - h_padding);\n      this.text_x = this.x - this.w / 2 + 7;\n      this.text_y = this.y - 6;\n    }\n\n    run() {\n      this.update();\n      this.display();\n    }\n\n    update() {\n      if (this.mouseInRegion() && current_survey_topic == 0) {\n        this.fillAlpha = 255;\n      } else {\n        this.fillAlpha = 100;\n      }\n    }\n\n    display() {\n      p.textSize(font_pixels);\n      p.textAlign(p.LEFT, p.CENTER);\n      p.fill(255, this.fillAlpha);\n      p.rect(this.x, this.y, this.w, this.h, 4, 4);\n      p.fill(0, 255);\n      p.text(this.button_name, this.text_x, this.text_y);\n    }\n\n  };\n\n  document.oncontextmenu = function () {\n    return false;\n  };\n}","map":{"version":3,"sources":["/Users/aep/phd/hearth-mici/src/code/sketch.js"],"names":["sketch","p","blank_spell_img","blank_creature_img","blank_weapon_img","full_blank_creature_img","bg","GAN_imgs","flavour_img","masked_flavour_ellipse","masked_flavour_rect","buttons","button_id","effects","tasks","title","instruction","num_cards","current_task_index","user","cards","card_types","method_names","target_names","target_names_singular","filter_names","duration_names","param_format_names","effect_names","keywords","all_creature_types","creature_types","survey_topics","current_survey_topic","survey_drop_target","font_pixels_large","font_pixels","font_pixels_small","hearthstone_font","mouse_padding","w_padding","h_padding","grid_w_padding","grid_h_padding","theMouse","setupDone","hoveredOption","editing","editing_card","effect_to_remove","editX","editY","simCount","simulating","simDuration","simTime","mouse_over_queuer","simResults","simTurns","props","myCustomRedrawAccordingToNewPropsHandler","_props","preload","loadImage","bg_img","spell_img","weapon_img","creature_img","gan_img","loadFont","hs_font","setup","createCanvas","windowWidth","windowHeight","getURLParams","FancyMouse","height","width","imageMode","CENTER","rectMode","textFont","textSize","fill","noStroke","register_all","card_id","push","Card","resize_all","draw","background","textAlign","LEFT","image","c","run","b","busy","translate","mouseX","xOffset","mouseY","yOffset","text","effect","label_name","pop","draw_task_overlay","draw_edit_overlay","sim_overlay","draw_survey","RIGHT","setting","settings","options","attack","defense","xPos","map","yPos","boxWidth","boxHeight","rect","optionButtonWidth","length","optionButtonHeight","optionButtonsPadding","index","option","entries","optionString","toString","toUpperCase","substring","split","join","mousePressedWhileSurveying","progressSurveyThroughIssues","x","floor","y","mousePressedWhileNotSurveying","clickedCard","mouseInImg","dropEffectOnCard","clickToEditCard","setOffset","add_to_queue","mouse_click_while_editing","mouseInRegion","text_x","text_y","JSON","parse","stringify","button_name","finished_survey","i","includes","mouse_over_mana","mouse_over_power","mouse_over_toughness","dist","mouse_over_card_effect","hovered_effect","effect_string_height","splice","indexOf","mana","constrain","power","toughness","rotate","QUARTER_PI","mousePressed","keyPressed","key","submit","windowResized","resizeCanvas","millis","queur_x","queur_y","CORNER","submissions","card_submission","id","task","card_task","t","m","repeat_checker","e","effect_short","undefined","methods","params","targets","filters","duration","send_to_google_sheets","resized","mask_images","ellipse_mask","createGraphics","ellipse","rect_mask","get","register_effect","effect_text","method","param","Effect","Button","constuctor","buttonX","buttonY","constructor","param_format","effect_string","effect_string_width","card_task_index","w","h","oversized","class","type_id","card_index","creature_type","generate_effect_text","check_mouse_hovers","display","estimatedCharactersPerLine","estimatedLines","flav","forg","strokeWeight","stroke","translation_offset_y","textWidth","fillAlpha","update","document","oncontextmenu"],"mappings":"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","sourcesContent":["/* eslint eqeqeq: \"off\", no-unused-vars: \"off\" */\n\n\n//to fix totalHeight bug, change p5 by changing o-totalHeight to just o\n//todo: fix this on a generic p5 import somehow\nexport default function sketch(p) {\n\n  let blank_spell_img, blank_creature_img, blank_weapon_img, full_blank_creature_img;\n  let bg;\n  let GAN_imgs = [];\n  let flavour_img, masked_flavour_ellipse, masked_flavour_rect;\n\n\n  const buttons = [];\n  let button_id = 0;\n\n  const effects = [];\n\n  const tasks = [{\n    title: \"Mage vs Warrior\",\n    instruction: \"Create 2 mage cards that helps against warriors.\",\n    num_cards: 3,\n  },\n  {\n    title: \"Murlocs\",\n    instruction: \"Create 3 murlocs\",\n    num_cards: 3,\n  },\n  {\n    title: \"The ultimate defense\",\n    instruction: \"Create the ultimate defensive card.\",\n    num_cards: 1,\n  }\n  ]\n  let current_task_index = 0;\n\n\n\n  let user = \"\"\n\n  const cards = [];\n  const card_types = [\"spell\", \"minion\", \"weapon\"]\n\n  const method_names = [\"randomly\", \"targeted\", \"all\", \"aura\"];\n  const target_names = [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"];\n  const target_names_singular = [\"minion\", \"hero\", \"minion or hero\", \"murloc\", \"beast\", \"demon\", \"totem\", \"weapon\"]\n  const filter_names = [\"enemy\", \"friendly\", \"all\"];\n  const duration_names = [\"turn\", \"permanently\"];\n  const param_format_names = [\"x\", \"x/x\", \"k\", \"c\"];\n  const effect_names = [\"Deal damage\", \"Destroy\", \"Heal\", \"Gain armour\", \"Change stats\", \"Set stats\", \"Give keyword\", \"Return to hand\", \"Draw\", \"Gain mana\", \"Summon: \", \"Battlecry: \", \"Deathrattle: \"]\n  const keywords = [\"Taunt\", \"Charge\", \"Lifesteal\", \"Spell damage +1\", \"Divine shield\", \"Poisonous\", \"Windfury\", \"Frozen\"]\n  const all_creature_types = [\"murloc\", \"beast\", \"demon\", \"totem\", \"dragon\", \"pirate\", \"mech\", \"elemental\"]\n  const creature_types = [\"Murloc\", \"Beast\", \"Demon\", \"Totem\"]\n\n  const survey_topics = [\"none\", \"methods\", \"filters\", \"targets\", \"duration\", \"params\"];\n  let current_survey_topic = 0;\n\n  let survey_drop_target = null;\n\n  const font_pixels_large = 32;;\n  const font_pixels = 24;\n  const font_pixels_small = 20;\n\n  let hearthstone_font;\n  const mouse_padding = 1;\n  let w_padding, h_padding;\n  let grid_w_padding, grid_h_padding;\n\n  let theMouse;\n  let setupDone = false;\n  let hoveredOption = -1;\n\n  let editing = \"none\";\n  let editing_card = null;\n  let effect_to_remove = null;\n  let editX = 0;\n  let editY = 0;\n\n  let simCount = 3;\n  let simulating = false;\n  let simDuration = 2000;\n  let simTime = -simDuration;\n\n  let mouse_over_queuer;\n\n  let simResults = null;\n  let simTurns = null;\n\n  let props;\n\n\n  p.myCustomRedrawAccordingToNewPropsHandler = (_props) => {\n    props = _props;\n  }\n\n  p.preload = () => {\n    bg = p.loadImage(props.bg_img)\n    blank_spell_img = p.loadImage(props.spell_img);\n    blank_weapon_img = p.loadImage(props.weapon_img)\n    blank_creature_img = p.loadImage(props.creature_img)\n    full_blank_creature_img = p.loadImage(props.full_blank_creature_img);\n    flavour_img = p.loadImage(props.gan_img)\n    hearthstone_font = p.loadFont(props.hs_font);\n  }\n\n\n  p.setup = () => {\n    p.createCanvas(p.windowWidth, p.windowHeight);\n    user = p.getURLParams().user;\n\n    theMouse = new p.FancyMouse();\n\n\n    h_padding = p.height * 0.1;\n    w_padding = p.width * 0.2;\n    grid_h_padding = p.height * 0.2;\n    grid_w_padding = p.width * 0.1;\n    p.imageMode(p.CENTER)\n    p.rectMode(p.CENTER);\n    p.textFont(hearthstone_font);\n    p.textSize(font_pixels);\n    p.fill(255);\n    p.noStroke();\n\n    p.register_all();\n\n\n    for (let card_id = 0; card_id < tasks[current_task_index].num_cards; card_id++) {\n      cards.push(new p.Card(card_id, current_task_index));\n    }\n\n    p.resize_all();\n\n\n\n\n    setupDone = true;\n\n  }\n\n\n  p.draw = () => {\n    p.background(255)\n    p.textAlign(p.LEFT, p.CENTER);\n    p.image(bg, p.width / 2, p.height / 2, p.width, p.height);\n\n    for (let c of cards) {\n      c.run();\n    }\n\n    for (let b of buttons) {\n      b.run();\n    }\n\n    if (theMouse.busy && current_survey_topic == 0) {\n      p.push();\n      p.translate(p.mouseX - theMouse.xOffset, p.mouseY - theMouse.yOffset)\n      p.textSize(28)\n      p.text(theMouse.effect.label_name, 0, 0)\n      p.pop();\n    }\n\n    p.draw_task_overlay();\n    p.draw_edit_overlay();\n    p.sim_overlay();\n\n\n    if (survey_topics[current_survey_topic] != \"none\") {\n      p.draw_survey();\n    }\n\n  }\n\n  p.draw_task_overlay = () => {\n    p.textAlign(p.RIGHT, p.CENTER)\n    p.textSize(font_pixels_large);\n    p.text(tasks[current_task_index].title,  p.width-w_padding/2, h_padding)\n\n    p.textSize(font_pixels);\n    p.text(tasks[current_task_index].instruction, p.width-w_padding/2, h_padding+font_pixels_large)\n\n  }\n\n\n\n  p.draw_survey = () => {\n    p.push();\n    p.textAlign(p.CENTER, p.CENTER)\n    p.textSize(font_pixels)\n\n    p.rectMode(p.CENTER)\n    p.background(0, 100)\n\n    let setting = theMouse.effect.settings[survey_topics[current_survey_topic]]\n    let options = setting[0]\n\n\n    if (setting[0][0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n    } else if (setting[0][0] == \"k\") {\n      options = keywords\n    } else if (setting[0][0] == \"c\") {\n      options = creature_types;\n    }\n\n\n    if (options[0] == \"x/x\") {\n      for (let attack = 1; attack < 11; attack++) {\n        for (let defense = 1; defense < 11; defense++) {\n          let xPos = p.map(attack, 1, 10, grid_w_padding, p.width - grid_w_padding);\n          let yPos = p.map(defense, 1, 10, grid_h_padding, p.height - grid_h_padding);\n          let boxWidth = (p.width - grid_w_padding * 2) / 10;\n          let boxHeight = (p.height - grid_h_padding * 2) / 10;\n\n          if (p.mouseX > xPos - boxWidth / 2 && p.mouseX < xPos + boxWidth / 2 &&\n            p.mouseY > yPos - boxHeight / 2 && p.mouseY < yPos + boxHeight / 2) {\n            p.fill(255, 100);\n          } else {\n            p.fill(255, 0);\n          }\n          p.rect(xPos, yPos, boxWidth, boxHeight);\n          p.fill(255);\n          p.text(attack + \"/\" + defense, xPos, yPos - 10)\n        }\n      }\n    } else {\n\n\n      p.textSize(40);\n      p.fill(255)\n      p.text(theMouse.effect.label_name + \"...\", p.width / 2, p.height * 0.1);\n\n      p.textSize(font_pixels)\n      p.rectMode(p.CENTER)\n\n      let optionButtonWidth = (p.width / options.length) * 0.5;\n      let optionButtonHeight = p.height * 0.10;\n      let optionButtonsPadding = p.width * 0.25;\n\n      for (let [index, option] of options.entries()) {\n        let xPos = p.map(index, 0, options.length - 1, optionButtonsPadding, p.width - optionButtonsPadding);\n        if (p.mouseX > xPos - optionButtonWidth / 2 && p.mouseX < xPos + optionButtonWidth / 2) {\n          p.fill(255, 100)\n          hoveredOption = index;\n        } else {\n          p.fill(255, 50)\n        }\n        p.rect(xPos, p.height * 0.5, optionButtonWidth, optionButtonHeight, 16);\n        p.fill(255);\n\n        let optionString = option.toString();\n        optionString = optionString[0].toUpperCase() + optionString.substring(1)\n        optionString = optionString.split(\" \").join(\"\\n\");\n\n        p.text(optionString, xPos, p.height / 2)\n      }\n    }\n\n    p.pop();\n  }\n\n\n  p.mousePressedWhileSurveying = () => {\n    if (p.progressSurveyThroughIssues()) {\n      return\n    }\n\n\n    let setting = theMouse.effect.settings[survey_topics[current_survey_topic]];\n    let options = setting[0]\n    if (options[0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n    } else if (options[0] == \"k\") {\n      options = keywords;\n    } else if (options[0] == \"c\") {\n      options = creature_types;\n    }\n\n    if (options[0] == \"x/x\") {\n      setting[1] = {\n        x: p.floor(p.map(p.mouseX, 0, p.width, 1, 11)),\n        y: p.floor(p.map(p.mouseY, 0, p.height, 1, 11))\n      }\n    } else {\n      setting[1] = options[hoveredOption];\n    }\n\n    current_survey_topic++;\n\n    if (p.progressSurveyThroughIssues()) {\n      return\n    }\n\n  }\n\n\n  p.mousePressedWhileNotSurveying = () => {\n    let clickedCard = null;\n\n    for (let c of cards) {\n      if (c.mouseInImg()) {\n        clickedCard = c;\n      }\n    }\n\n\n    if (clickedCard) {\n      if (theMouse.busy) { //dropping effect onto a card\n        p.dropEffectOnCard(clickedCard)\n      } else { //clicking on a card generally\n        p.clickToEditCard(clickedCard)\n      }\n    } else {\n      if (theMouse.busy) { //clicked away to drop label\n        theMouse.busy = false;\n        theMouse.setOffset(0, 0);\n        theMouse.effect = null;\n      } else { //other clicks\n\n        if (mouse_over_queuer) {\n          p.add_to_queue();\n        }\n\n        p.mouse_click_while_editing();\n\n\n        for (let b of buttons) { //clicking on a button with an empty hand\n          if (b.mouseInRegion()) {\n            theMouse.busy = true;\n            theMouse.setOffset(b.text_x, b.text_y);\n            theMouse.effect = JSON.parse(JSON.stringify(effects[b.button_name]));\n\n            break;\n          }\n        }\n      }\n    }\n\n  }\n\n\n\n  //returns true if you need to return out of mouse\n  p.progressSurveyThroughIssues = () => {\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n    for (let i = 0; i < survey_topics.length; i++) {\n      if (theMouse.effect.settings[survey_topics[current_survey_topic]][0] == null ||\n        (!param_format_names.includes(theMouse.effect.settings[survey_topics[current_survey_topic]][0][0]) &&\n          theMouse.effect.settings[survey_topics[current_survey_topic]][0].length == 1)) {\n        current_survey_topic++;\n        if (current_survey_topic == survey_topics.length) {\n          p.finished_survey();\n          return true;\n        }\n      }\n    }\n\n\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n\n    return false;\n  }\n\n  p.dropEffectOnCard = (c) => {\n    current_survey_topic = 1;\n    survey_drop_target = c;\n\n    if (p.progressSurveyThroughIssues()) {\n\n      return\n    }\n  }\n\n\n  p.clickToEditCard = (c) => {\n\n    if (c.mouse_over_mana) {\n      editing = \"mana\";\n      editing_card = c;\n    } else if (c.mouse_over_power) {\n      editing = \"power\";\n      editing_card = c;\n    } else if (c.mouse_over_toughness && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"toughness\";\n      editing_card = c;\n    } else if (c.mouse_over_card_effect && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"effect\";\n      editX = c.hovered_effect.x + blank_spell_img.width / 2;\n      editY = c.hovered_effect.y + c.hovered_effect.effect_string_height / 2;\n      editing_card = c;\n      effect_to_remove = c.hovered_effect;\n    } else if (editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10) {\n      editing_card.effects.splice(editing_card.effects.indexOf(effect_to_remove), 1);\n      editing = \"none\";\n    } else {\n      editing = \"none\";\n    }\n  }\n\n\n  p.mouse_click_while_editing = () => {\n    if (editing == \"mana\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY - 50) < 40) {\n        editing_card.mana--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY - 50) < 40) {\n        editing_card.mana++;\n      } else {\n        editing = \"none\"\n      }\n      editing_card.mana = p.constrain(editing_card.mana, 0, 10)\n    } else if (editing == \"power\") {\n\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.power--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.power++;\n      } else {\n        editing = \"none\"\n      }\n      editing_card.power = p.constrain(editing_card.power, 0, 10)\n    } else if (editing == \"toughness\") {\n\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.toughness--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.toughness++;\n      } else {\n        editing = \"none\"\n      }\n      editing_card.toughness = p.constrain(editing_card.toughness, 1, 10)\n    } else if (editing == \"effect\") {\n      editing = \"none\";\n    }\n  }\n\n\n  p.draw_edit_overlay = () => {\n    p.push();\n    if (editing != \"none\") {\n      p.translate(editX, editY)\n      p.noStroke();\n      if (editing == \"effect\") {\n        p.rotate(p.QUARTER_PI);\n        p.fill(0);\n        p.rect(0, 0, 22, 6);\n        p.rect(0, 0, 6, 22);\n        p.fill(255);\n        p.rect(0, 0, 20, 4);\n        p.rect(0, 0, 4, 20);\n\n      } else {\n        p.fill(0);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 8, 32);\n        p.fill(255);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 6, 30);\n      }\n    }\n    p.pop();\n  }\n\n  p.mousePressed = () => {\n    if (setupDone) {\n      if (survey_topics[current_survey_topic] != \"none\") {\n        p.mousePressedWhileSurveying();\n      } else {\n        p.mousePressedWhileNotSurveying();\n      }\n    }\n  }\n\n  p.finished_survey = () => {\n\n    survey_drop_target.effects.push(JSON.parse(JSON.stringify(theMouse.effect)))\n    current_survey_topic = 0;\n    theMouse.effect = null;\n    theMouse.busy = false;\n  }\n\n  p.keyPressed = () => {\n    if (p.key == ' ' && !simulating) {\n      simResults = null;\n      simTurns = null;\n      simulating = true;\n      simTime = simCount;\n      p.submit();\n    }\n\n  }\n\n  p.windowResized = () => {\n    p.resizeCanvas(p.windowWidth, p.windowHeight);\n    p.resize_all();\n  }\n\n  p.add_to_queue = () => {\n    if (!simulating) {\n      simulating = true;\n      simTime = p.millis();\n      p.submit();\n    }\n  }\n\n  p.sim_overlay = () => {\n    p.push();\n    let queur_x = p.map(2, 0, 3, w_padding, p.width - w_padding);\n    let queur_y = p.height * 0.85\n    mouse_over_queuer = (p.mouseX > queur_x - 100 && p.mouseX < queur_x + 100 && p.mouseY > queur_y - 30 && p.mouseY < queur_y + 30)\n\n    p.translate(queur_x, queur_y);\n\n    if (mouse_over_queuer && !simulating) {\n      p.fill(255, 255);\n    } else {\n      p.fill(p.map(p.millis(), simTime, simTime + simDuration, 100, 255, true), 100)\n    }\n    p.rect(0, 0, 200, 60, 4)\n\n\n    p.fill(0, 255);\n    p.textAlign(p.CENTER, p.CENTER)\n    p.text(simulating ? \"Adding...\" : \"Add to queue\", 0, -4)\n\n    p.rectMode(p.CORNER)\n\n    // if(simulating)\n    // p.fill(0)\n    // p.rect(-100, -30, map(millis(), simTime, simTime+simDuration, 0, 200, true), 60, 4)\n\n\n    p.pop();\n\n    if (simulating) {\n      if (p.millis() > simTime + simDuration) {\n        simulating = false;\n      }\n    }\n    // if (simulating) {\n    //   simTime = constrain(simTime - random(0.001, 0.002), 0, simCount);\n\n    //   let lw = map(simTime, 0, simCount, 0, 200);\n    //   noStroke();\n    //   p.fill(200);\n    //   p.rect(width * 0.5 - 100, height * 0.85 - 16, 200, 40)\n    //   p.fill(0)\n    //   p.rect(width * 0.5 - 100, height * 0.85 - 16, lw, 40)\n    //   p.fill(255);\n    //   text(\"Simulating...\", width * 0.5, height * 0.85)\n    // } else {\n    //   text(\"Press Spacebar to simulate\", width / 2, height * 0.9);\n    // }\n\n    // if (simResults != null) {\n\n    //   text(\"The win rate with your card is: \" + simResults +\n    //     \"%\\n\" + \"The average game lasted \" + simTurns +\n    //     \" turns.\", width * 0.5, height * 0.10);\n    // }\n  }\n\n  p.submit = () => {\n    let submissions = [];\n    for (let c of cards) {\n\n      let card_submission = {\n        id: c.card_id,\n        task: c.card_task,\n        user: user,\n        p: c.power,\n        t: c.toughness,\n        m: c.mana,\n      }\n\n\n      let repeat_checker = {};\n\n      for (let e of c.effects) {\n        if (repeat_checker[e.effect_short] == undefined) {\n          repeat_checker[e.effect_short] = 0;\n        } else {\n          repeat_checker[e.effect_short]++;\n        }\n\n        if (e.settings.methods[0] != null) card_submission[e.effect_short + \"-method-\" + repeat_checker[e.effect_short]] = e.settings.methods[1];\n        if (e.settings.params[0] != null) card_submission[e.effect_short + \"-param-\" + repeat_checker[e.effect_short]] = e.settings.params[1];\n        if (e.settings.targets[0] != null) card_submission[e.effect_short + \"-target-\" + repeat_checker[e.effect_short]] = e.settings.targets[1];\n        if (e.settings.filters[0] != null) card_submission[e.effect_short + \"-filter-\" + repeat_checker[e.effect_short]] = e.settings.filters[1];\n        if (e.settings.duration[0] != null) card_submission[e.effect_short + \"-duration-\" + repeat_checker[e.effect_short]] = e.settings.duration[1];\n\n      }\n      submissions[c.card_task + \"-\" + c.card_id] = card_submission;\n    }\n\n\n    props.send_to_google_sheets(submissions)\n\n  }\n\n\n  // gapi.load('client', ()=>{\n  //   gapi.client.init({ 'apiKey':  config.sheets_api_key}).then(()=>{\n  //     gapi.client.sheets.spreadsheets.values.get({\n  //       spreadsheetId: config.sheet_id,\n  //       range: \"queue!A1:D5\"\n  //     }).then((response) => {\n  //       var result = response.result;\n  //       var numRows = result.values ? result.values.length : 0;\n  //       console.log(`${numRows} rows retrieved.`);\n  //     });\n  //   }); \n  // });\n\n\n\n\n\n\n\n  // httpPost('https://hearth-mici-backend.loca.lt/get_winrates', submission, (response) => {\n  //   simulating = false;\n  //   simResults = round(JSON.parse(response).win_rate, 2);\n  //   simTurns = round(JSON.parse(response).num_turns, 2);\n  //   console.log(simResults, simTurns)\n  // });\n\n\n  // httpPost('https://sheets.googleapis.com/v4/spreadsheets/1TlgFYV4zwkyfwGq1DNU39Sq1kOsOaL3jfppokpmgX0w/values/queue!A1:E1:append?key='+config.sheets_api_key, {\n  //   range: \"queue!A1:E1\",\n  //   key: config.sheets_api_key,\n  //   majorDimension: \"ROWS\",\n  //   values: [\n  //     [\"Door\", \"$15\", \"2\", \"3/15/2016\"],\n  //     [\"Engine\", \"$100\", \"1\", \"3/20/2016\"],\n  //   ],\n  // }, (response) => {\n  //   console.log(response)\n  // });\n\n\n\n  p.resize_all = () => {\n    for (let b of buttons) {\n      b.resized();\n    }\n\n    for (let c of cards) {\n      c.resized();\n    }\n\n    p.mask_images();\n   \n  }\n\n  p.mask_images = () => {\n    let ellipse_mask = p.createGraphics(p.width, p.height);\n    ellipse_mask.ellipse(p.width / 2, p.height / 2, 500,  500)\n\n    let rect_mask = p.createGraphics(p.width, p.height);\n    rect_mask.rectMode(p.CENTER);\n    rect_mask.rect(p.width / 2, p.height / 2,  700,  700)\n\n    masked_flavour_ellipse = flavour_img.get();\n   // masked_flavour_ellipse.mask(ellipse_mask)\n    masked_flavour_rect = flavour_img.get();\n    //masked_flavour_rect.mask(rect_mask)\n\n  }\n\n  p.register_effect = (effect_text, effect_short, method, param, targets, filters, duration) => {\n\n    effects[effect_text] = new p.Effect(effect_text, effect_short, method, param, targets, filters, duration);\n    buttons.push(new p.Button(effect_text, button_id++));\n  }\n\n  p.register_all = () => {\n\n    p.register_effect(\"Deal damage\", \"dam\",\n      [\"randomly\", \"targeted\", \"all\"],\n      [\"x\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n    p.register_effect(\"Destroy\", \"des\",\n      [\"randomly\", \"targeted\", \"all\"],\n      null,\n      [\"minions\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n    p.register_effect(\"Heal\", \"hea\",\n      [\"randomly\", \"targeted\", \"all\"],\n      [\"x\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n    p.register_effect(\"Gain armour\", \"arm\",\n      null,\n      [\"x\"],\n      null,\n      null,\n      null);\n\n    p.register_effect(\"Change stats\", \"cha\",\n      [\"randomly\", \"targeted\", \"all\", \"aura\"],\n      [\"x/x\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      [\"turn\", \"permanently\"]);\n\n    p.register_effect(\"Set stats\", \"set\",\n      [\"randomly\", \"targeted\", \"all\", \"aura\"],\n      [\"x/x\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      [\"turn\", \"permanently\"]);\n\n\n    p.register_effect(\"Give keyword\", \"giv\",\n      [\"randomly\", \"targeted\", \"all\", \"aura\"],\n      [\"k\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"murlocs\", \"beasts\", \"demons\", \"totems\", \"weapons\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      [\"turn\", \"permanently\"]);\n\n    p.register_effect(\"Return to hand\", \"ret\",\n      [\"randomly\", \"targeted\", \"all\"],\n      null,\n      [\"minions\", \"murlocs\", \"beasts\", \"demons\", \"totems\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n\n    p.register_effect(\"Draw\", \"dra\",\n      null,\n      [\"x\"],\n      null,\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n\n    p.register_effect(\"Gain mana\", \"gai\",\n      null,\n      [\"x\"],\n      null,\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n    p.register_effect(\"Summon\", \"sum\",\n      null,\n      [\"x/x\"],\n      null,\n      null,\n      null);\n\n    p.register_effect(\"Keyword\", \"key\",\n      null,\n      [\"k\"],\n      null,\n      null,\n      null);\n\n    p.register_effect(\"Creature type\", \"cre\",\n      null,\n      [\"c\"],\n      null,\n      null,\n      null);\n\n\n\n  }\n\n\n  p.FancyMouse = class {\n    constuctor() {\n      this.busy = false;\n      this.xOffset = 0;\n      this.yOffset = 0;\n      this.effect = null;\n    }\n    setOffset(buttonX, buttonY) {\n      this.xOffset = p.mouseX - buttonX;\n      this.yOffset = p.mouseY - buttonY;\n    }\n  }\n\n\n\n\n\n  p.Effect = class {\n    constructor(label_name, effect_short, methods, param_format, targets, filters, duration) {\n      this.x = 0;\n      this.y = 0;\n\n      this.effect_string = \"\";\n      this.effect_string_height = 0;\n      this.effect_string_width = blank_spell_img.width * 0.5;\n      this.label_name = label_name;\n      this.effect_short = effect_short;\n\n      this.settings = {\n        methods: [methods, \"\"],\n        params: [param_format, \"\"],\n        targets: [targets, \"\"],\n        filters: [filters, \"\"],\n        duration: [duration, \"\"]\n      };\n    }\n  }\n\n\n  p.Card = class {\n    constructor(card_id, card_task_index) {\n      this.y = 0;\n      this.x = 0;\n      this.w = blank_spell_img.width * 0.75;\n      this.h = blank_spell_img.height * 0.75;\n      this.oversized = false;\n\n\n      this.class = \"mage\";\n      this.type_id = card_id;\n      this.card_id = card_id;\n      this.card_index = card_task_index;\n\n      this.creature_type = \"\";\n      this.mana = 5;\n      this.power = 5;\n      this.toughness = 5;\n      this.keywords = [];\n      this.effects = [];\n\n      this.hovered_effect = null;\n      this.mouse_over_card_effect = false;\n      this.mouse_over_mana = false;\n      this.mouse_over_power = false;\n      this.mouse_over_toughness = false;\n\n\n    }\n\n    resized() {\n      this.x = p.map(this.card_id + 1, 0, cards.length, w_padding, p.width - w_padding)\n      this.y = p.height / 2;\n    }\n\n    run() {\n      this.generate_effect_text();\n      this.check_mouse_hovers();\n      this.display();\n    }\n\n    generate_effect_text() {\n      for (let e of this.effects) {\n        e.effect_string = \"\";\n        if (e.label_name == \"Keyword\" || e.label_name == \"Creature type\") {\n          e.effect_string = e.settings.params[1];\n        } else if (e.label_name == \"Deal damage\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Randomly deal \" + e.settings.params[1] + \" damage to a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Deal \" + e.settings.params[1] + \" damage to target \";\n          } else {\n            e.effect_string = \"Deal \" + e.settings.params[1] + \" damage to all \"\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \" //remove \"all all\"\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1]\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])]\n          }\n        } else if (e.label_name == \"Destroy\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Randomly destroy a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Destroy a target \";\n          } else {\n            e.effect_string = \"Destroy all \"\n          }\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \" //remove \"all all\"\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1]\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])]\n          }\n        } else if (e.label_name == \"Heal\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a random \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a target \";\n          } else {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to all \";\n          }\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \" //remove \"all all\"\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1]\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])]\n          }\n        } else {\n          e.effect_string = e.label_name\n        }\n\n\n\n        let estimatedCharactersPerLine = 20;\n        let estimatedLines = e.effect_string.length / estimatedCharactersPerLine;\n        e.effect_string_height = font_pixels_small * estimatedLines + 30;\n\n      }\n\n    }\n\n    display() {\n      p.push();\n      p.fill(0);\n      p.textAlign(p.CENTER, p.CENTER)\n      if (this.effects.length > 2) {\n        this.oversized = true;\n      } else {\n        this.oversized = false;\n      }\n      let flav;\n      let forg;\n\n      if (card_types[this.type_id] == \"spell\") {\n        flav = masked_flavour_rect;\n        forg = blank_spell_img;\n      } else if (card_types[this.type_id] == \"minion\") {\n        flav = masked_flavour_ellipse;\n        forg = this.oversized ? full_blank_creature_img : blank_creature_img;\n      } else {\n        flav = masked_flavour_rect;\n        forg = blank_weapon_img;\n      }\n\n      if (!this.oversized) {\n        p.image(flav, this.x, this.y, 300, 300)\n      }\n      p.image(forg, this.x, this.y, this.w, this.h);\n\n      p.push();\n      p.textSize(60);\n      p.fill(255);\n      p.strokeWeight(3);\n      p.stroke(0);\n\n      if (card_types[this.type_id] == \"minion\") {\n        p.text(this.power, this.x - this.w / 2.99, this.y + this.h / 2.8)\n        p.text(this.toughness, this.x + this.w / 2.6, this.y + this.h / 2.8)\n      }\n\n\n      p.text(this.mana, this.x - this.w / 2.99, this.y - this.h / 2.3)\n\n      p.pop();\n\n\n      p.push();\n      p.fill(0);\n      p.textSize(font_pixels_small);\n      let translation_offset_y;\n      if (this.oversized) {\n        translation_offset_y = this.y - this.h / 2 + 80;\n        p.translate(this.x, this.y - this.h / 2 + 80);\n      } else {\n        translation_offset_y = this.y + 50;\n        p.translate(this.x, this.y + 50);\n      }\n\n      this.mouse_over_card_effect = false;\n      this.hovered_effect = null;\n      for (let e of this.effects) {\n\n        translation_offset_y += e.effect_string_height / 2;\n        p.translate(0, e.effect_string_height / 2)\n\n        if (p.mouseY > translation_offset_y - e.effect_string_height / 2 &&\n          p.mouseY < translation_offset_y + e.effect_string_height / 2 &&\n          p.mouseX > this.x - e.effect_string_width / 2 &&\n          p.mouseX < this.x + e.effect_string_width / 2) {\n\n          this.mouse_over_card_effect = true;\n\n          this.hovered_effect = e;\n          this.hovered_effect.x = this.x - e.effect_string_width / 2;\n          this.hovered_effect.y = translation_offset_y - e.effect_string_height;\n          p.fill(0, 100);\n        } else {\n          p.fill(0, 50)\n        }\n\n        p.rect(0, 0, e.effect_string_width, e.effect_string_height, 4, 4)\n        p.fill(255, 255)\n        p.text(e.effect_string, 0, 0, blank_spell_img.width / 2, blank_spell_img.height / 2)\n        translation_offset_y += e.effect_string_height / 2 + 5;\n        p.translate(0, e.effect_string_height / 2 + 5)\n\n      }\n      p.pop();\n\n\n      p.push();\n\n      if (editing_card == this) {\n        if (editing == \"mana\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y - this.h / 2.3;\n        } else if (editing == \"power\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y + this.h / 2.8;\n        } else if (editing == \"toughness\") {\n          editX = this.x + this.w / 2.6;\n          editY = this.y + this.h / 2.8;\n        }\n      }\n\n      p.pop();\n    }\n\n\n    mouseInImg() {\n      return (p.mouseX > this.x - this.w / 2 - mouse_padding &&\n        p.mouseX < this.x + this.w / 2 + mouse_padding &&\n        p.mouseY > this.y - this.h / 2 - mouse_padding &&\n        p.mouseY < this.y + this.h / 2 + mouse_padding);\n\n    }\n    check_mouse_hovers() {\n      if (card_types[this.type_id] == \"minion\") {\n        this.mouse_over_power = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y + this.h / 2.8) < 50\n        this.mouse_over_toughness = p.dist(p.mouseX, p.mouseY, this.x + this.w / 2.6, this.y + this.h / 2.8) < 50\n      }\n      this.mouse_over_mana = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y - this.h / 2.3) < 50\n    }\n  }\n\n\n\n\n\n  p.Button = class {\n\n    constructor(button_name, button_id) {\n      this.button_name = button_name;\n      this.button_id = button_id;\n\n      this.x = 0;\n      this.y = 0;\n      this.w = p.textWidth(button_name) + 14;\n      this.h = font_pixels + 10;\n      this.fillAlpha = 100;\n\n      this.text_x = 0;\n      this.text_y = 0;\n    }\n    mouseInRegion() {\n      return (p.mouseX > this.x - this.w / 2 - mouse_padding &&\n        p.mouseX < this.x + this.w / 2 + mouse_padding &&\n        p.mouseY > this.y - this.h / 2 - mouse_padding &&\n        p.mouseY < this.y + this.h / 2 + mouse_padding);\n    }\n\n    resized() {\n      this.x = w_padding - 150 + this.w / 2 - 7;\n      this.y = p.map(this.button_id, 0, buttons.length, h_padding, p.height - h_padding);\n      this.text_x = this.x - this.w / 2 + 7;\n      this.text_y = this.y - 6;\n    }\n\n    run() {\n      this.update();\n      this.display();\n    }\n\n    update() {\n\n      if (this.mouseInRegion() && current_survey_topic == 0) {\n        this.fillAlpha = 255;\n      } else {\n        this.fillAlpha = 100;\n      }\n\n    }\n\n    display() {\n\n\n      p.textSize(font_pixels)\n      p.textAlign(p.LEFT, p.CENTER)\n      p.fill(255, this.fillAlpha);\n      p.rect(this.x, this.y, this.w, this.h, 4, 4);\n      p.fill(0, 255);\n      p.text(this.button_name, this.text_x, this.text_y);\n    }\n\n\n  }\n\n\n  document.oncontextmenu = function () {\n    return false;\n  }\n\n\n}"]},"metadata":{},"sourceType":"module"}