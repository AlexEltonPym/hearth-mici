{"ast":null,"code":"/* eslint eqeqeq: \"off\", no-unused-vars: \"off\" */\n//to fix totalHeight bug, change p5 by changing o-totalHeight to just o\n//todo: fix this on a generic p5 import somehow\n//todo: language stuff\n//todo: buttons\n//todo: creature types\n//todo: card types\n//todo: effect limit\n//ABC test reports, articulate logic for report design\n//make rampiness, variety, controllynes and see when they would be useful\nexport default function sketch(p) {\n  const buttons = [];\n  let button_id = 0;\n  const effects = [];\n  let current_task_index = 0;\n  const task_details = [{\n    id: 0,\n    title: \"3 Hunter Cards\",\n    instruction: \"Design three cards for hunter\",\n    num_cards: 3,\n    class: \"hunter\"\n  }, {\n    id: 1,\n    title: \"3 Warrior Cards\",\n    instruction: \"Design three cards for warrior\",\n    num_cards: 3,\n    class: \"warrior\"\n  }, {\n    id: 2,\n    title: \"3 Mage Cards\",\n    instruction: \"Design three cards for mage\",\n    num_cards: 3,\n    class: \"mage\"\n  }, {\n    id: 3,\n    title: \"3 Neutral Cards\",\n    instruction: \"Design three neutral cards\",\n    num_cards: 3,\n    class: \"all\"\n  }];\n  let user = \"\";\n  let tasks = [];\n  const card_types = [\"spell\", \"minion\", \"weapon\"];\n  const method_names = [\"randomly\", \"targeted\", \"all\", \"aura\"];\n  const target_names = [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"];\n  const target_names_singular = [\"minion\", \"hero\", \"minion or hero\", \"pirate\", \"beast\", \"elemental\", \"totem\", \"weapon\"];\n  const filter_names = [\"enemy\", \"friendly\", \"all\"];\n  const duration_names = [\"turn\", \"permanently\"];\n  const param_format_names = [\"x\", \"x/x\", \"k\", \"c\"];\n  const effect_names = [\"Deal damage\", \"Destroy\", \"Heal\", \"Gain armour\", \"Change stats\", \"Set stats\", \"Give keyword\", \"Return to hand\", \"Draw\", \"Gain mana\", \"Summon: \", \"Battlecry: \", \"Deathrattle: \"];\n  const keywords = [\"Taunt\", \"Charge\", \"Lifesteal\", \"Spell damage +1\", \"Divine shield\", \"Poisonous\", \"Windfury\", \"Frozen\"];\n  const all_creature_types = [\"pirate\", \"beast\", \"elemental\", \"totem\", \"dragon\", \"pirate\", \"mech\", \"elemental\"];\n  const creature_types = [\"Pirate\", \"Beast\", \"Elemental\", \"Totem\"];\n  const survey_topics = [\"none\", \"methods\", \"filters\", \"targets\", \"duration\", \"params\"];\n  let current_survey_topic = 0;\n  let survey_drop_target = null;\n  let font_pixels_large = 32;\n  let font_pixels = 24;\n  let font_pixels_small = 20;\n  let hearthstone_font;\n  const mouse_padding = 1;\n  let w_padding, h_padding;\n  let grid_w_padding, grid_h_padding;\n  let rect_mask, ellipse_mask;\n  let blank_spell_img, blank_creature_img, blank_weapon_img, full_blank_creature_img;\n  let bg;\n  let gan_imgs = [];\n  let the_mouse;\n  let setup_done = false;\n  let hovered_option = -1;\n  let editing = \"none\";\n  let editing_card = null;\n  let effect_to_remove = null;\n  let editX = 0;\n  let editY = 0;\n  let sending = false;\n  let send_start_time = -10000;\n  const estimated_send_duration = 3000; //over-estimate\n\n  let sent = false;\n  let mouse_over_queuer;\n  let mouse_over_next;\n  let mouse_over_prev;\n  let props;\n\n  p.myCustomRedrawAccordingToNewPropsHandler = _props => {\n    props = _props;\n  };\n\n  p.preload = () => {\n    bg = p.loadImage(props.bg_img);\n    blank_spell_img = p.loadImage(props.spell_img);\n    blank_weapon_img = p.loadImage(props.weapon_img);\n    blank_creature_img = p.loadImage(props.creature_img);\n    full_blank_creature_img = p.loadImage(props.full_blank_creature_img);\n    hearthstone_font = p.loadFont(props.hs_font);\n\n    for (let im of props.gan_imgs) {\n      gan_imgs.push(p.loadImage(im));\n    }\n  };\n\n  p.setup = () => {\n    var _p$getURLParams$user;\n\n    p.createCanvas(p.windowWidth, p.windowHeight);\n    user = (_p$getURLParams$user = p.getURLParams().user) !== null && _p$getURLParams$user !== void 0 ? _p$getURLParams$user : 2;\n    the_mouse = new p.FancyMouse();\n    h_padding = p.height * 0.1;\n    w_padding = p.width * 0.2;\n    grid_h_padding = p.height * 0.2;\n    grid_w_padding = p.width * 0.1;\n    p.imageMode(p.CENTER);\n    p.rectMode(p.CENTER);\n    p.textFont(hearthstone_font);\n    p.textSize(font_pixels);\n    p.fill(255);\n    p.noStroke();\n    p.register_all();\n\n    for (let task of task_details) {\n      tasks[task.id] = [];\n\n      for (let card_id = 0; card_id < task.num_cards; card_id++) {\n        tasks[task.id].push(new p.Card(card_id, task.id, task.class));\n      }\n    }\n\n    p.load_save(); //loads save file from google sheets if it exists\n\n    p.resize_all();\n    setup_done = true;\n  };\n\n  p.draw = () => {\n    p.resize_all();\n    p.background(255);\n    p.textAlign(p.LEFT, p.CENTER);\n    p.image(bg, p.width / 2, p.height / 2, p.width, p.height);\n\n    if (current_task_index < task_details.length) {\n      for (let c of tasks[current_task_index]) {\n        c.run();\n      }\n    }\n\n    for (let b of buttons) {\n      b.run();\n    }\n\n    if (the_mouse.busy && current_survey_topic == 0) {\n      p.push();\n      p.translate(p.mouseX - the_mouse.xOffset, p.mouseY - the_mouse.yOffset);\n      p.textSize(28);\n      p.text(the_mouse.effect.label_name, 0, 0);\n      p.pop();\n    }\n\n    p.draw_edit_overlay();\n    p.draw_task_controls();\n\n    if (current_task_index == task_details.length) {\n      p.send_overlay();\n    } else {\n      p.draw_task_overlay();\n    }\n\n    if (survey_topics[current_survey_topic] != \"none\") {\n      p.draw_survey();\n    }\n  };\n\n  p.draw_task_controls = () => {\n    let next_x = p.width - w_padding;\n    let next_y = p.height - h_padding;\n    mouse_over_next = p.dist(p.mouseX, p.mouseY, next_x, next_y) < 75;\n    p.push();\n    p.translate(next_x, next_y);\n    p.fill(255, current_task_index == task_details.length ? 0 : mouse_over_next ? 255 : 100);\n    p.triangle(0, -25, 0, 25, 75, 0);\n    p.pop();\n    let prev_x = p.map(1, 0, 3, w_padding, p.width - w_padding);\n    mouse_over_prev = p.dist(p.mouseX, p.mouseY, prev_x, next_y) < 75;\n    p.push();\n    p.translate(prev_x, next_y);\n    p.fill(255, current_task_index == 0 ? 50 : mouse_over_prev ? 255 : 100);\n    p.triangle(0, -25, 0, 25, -75, 0);\n    p.pop();\n  };\n\n  p.draw_task_overlay = () => {\n    p.textAlign(p.RIGHT, p.CENTER);\n    p.textSize(font_pixels);\n    p.text(task_details[current_task_index].instruction, p.width - w_padding / 2, h_padding);\n    p.fill(0);\n    p.textAlign(p.CENTER, p.CENTER);\n    p.text(`Task ${current_task_index + 1} \\\\ ${task_details.length}`, p.map(2, 0, 3, w_padding, p.width - w_padding), p.height - h_padding);\n  };\n\n  p.draw_survey = () => {\n    p.push();\n    p.textAlign(p.CENTER, p.CENTER);\n    p.textSize(font_pixels);\n    p.rectMode(p.CENTER);\n    p.background(0, 100);\n    let setting = the_mouse.effect.settings[survey_topics[current_survey_topic]];\n    let options = setting[0];\n\n    if (setting[0][0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n    } else if (setting[0][0] == \"k\") {\n      options = keywords;\n    } else if (setting[0][0] == \"c\") {\n      options = creature_types;\n    }\n\n    if (options[0] == \"x/x\") {\n      for (let attack = 1; attack < 11; attack++) {\n        for (let defense = 1; defense < 11; defense++) {\n          let xPos = p.map(attack, 1, 10, grid_w_padding, p.width - grid_w_padding);\n          let yPos = p.map(defense, 1, 10, grid_h_padding, p.height - grid_h_padding);\n          let box_width = (p.width - grid_w_padding * 2) / 10;\n          let box_height = (p.height - grid_h_padding * 2) / 10;\n\n          if (p.mouseX > xPos - box_width / 2 && p.mouseX < xPos + box_width / 2 && p.mouseY > yPos - box_height / 2 && p.mouseY < yPos + box_height / 2) {\n            p.fill(255, 100);\n          } else {\n            p.fill(255, 0);\n          }\n\n          p.rect(xPos, yPos, box_width, box_height);\n          p.fill(255);\n          p.text(attack + \"/\" + defense, xPos, yPos - 10);\n        }\n      }\n    } else {\n      p.textSize(40);\n      p.fill(255);\n      p.text(the_mouse.effect.label_name + \"...\", p.width / 2, p.height * 0.1);\n      p.textSize(font_pixels);\n      p.rectMode(p.CENTER);\n      let option_button_width = p.width / options.length * 0.5;\n      let option_button_height = p.height * 0.10;\n      let option_buttons_padding = p.width * 0.25;\n\n      for (let [index, option] of options.entries()) {\n        let xPos = p.map(index, 0, options.length - 1, option_buttons_padding, p.width - option_buttons_padding);\n\n        if (p.mouseX > xPos - option_button_width / 2 && p.mouseX < xPos + option_button_width / 2) {\n          p.fill(255, 100);\n          hovered_option = index;\n        } else {\n          p.fill(255, 50);\n        }\n\n        p.rect(xPos, p.height * 0.5, option_button_width, option_button_height, 16);\n        p.fill(255);\n        let option_string = option.toString();\n        option_string = option_string[0].toUpperCase() + option_string.substring(1);\n        option_string = option_string.split(\" \").join(\"\\n\");\n        p.text(option_string, xPos, p.height / 2);\n      }\n    }\n\n    p.pop();\n  };\n\n  p.mouse_pressed_while_surveying = () => {\n    if (p.progress_survey_through_issues()) {\n      return;\n    }\n\n    let setting = the_mouse.effect.settings[survey_topics[current_survey_topic]];\n    let options = setting[0];\n\n    if (options[0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n    } else if (options[0] == \"k\") {\n      options = keywords;\n    } else if (options[0] == \"c\") {\n      options = creature_types;\n    }\n\n    if (options[0] == \"x/x\") {\n      setting[1] = `${p.floor(p.map(p.mouseX, 0, p.width, 1, 11))}/${p.floor(p.map(p.mouseY, 0, p.height, 1, 11))}`;\n    } else {\n      setting[1] = options[hovered_option];\n    }\n\n    current_survey_topic++;\n\n    if (p.progress_survey_through_issues()) {\n      return;\n    }\n  };\n\n  p.mouse_pressed_while_not_surveying = () => {\n    let clicked_card = null;\n\n    if (current_task_index < task_details.length) {\n      for (let c of tasks[current_task_index]) {\n        if (c.mouseInImg()) {\n          clicked_card = c;\n        }\n      }\n    }\n\n    if (clicked_card) {\n      if (the_mouse.busy) {\n        //dropping effect onto a card\n        p.drop_effect_on_card(clicked_card);\n      } else {\n        //clicking on a card generally\n        p.click_to_edit_card(clicked_card);\n      }\n    } else {\n      if (the_mouse.busy) {\n        //clicked away to drop label\n        the_mouse.busy = false;\n        the_mouse.setOffset(0, 0);\n        the_mouse.effect = null;\n      } else {\n        //other clicks\n        if (mouse_over_next && current_task_index < task_details.length) {\n          current_task_index++;\n        } else if (mouse_over_prev && current_task_index > 0) {\n          current_task_index--;\n        }\n\n        if (mouse_over_queuer && current_task_index == task_details.length && !sending) {\n          p.submit();\n        }\n\n        p.mouse_click_while_editing();\n\n        for (let b of buttons) {\n          //clicking on a button with an empty hand\n          if (b.mouseInRegion()) {\n            the_mouse.busy = true;\n            the_mouse.setOffset(b.text_x, b.text_y);\n            the_mouse.effect = JSON.parse(JSON.stringify(effects[b.button_name]));\n            break;\n          }\n        }\n      }\n    }\n  }; //returns true if you need to return out of mouse\n\n\n  p.progress_survey_through_issues = () => {\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n    for (let i = 0; i < survey_topics.length; i++) {\n      if (the_mouse.effect.settings[survey_topics[current_survey_topic]][0] == null || !param_format_names.includes(the_mouse.effect.settings[survey_topics[current_survey_topic]][0][0]) && the_mouse.effect.settings[survey_topics[current_survey_topic]][0].length == 1) {\n        current_survey_topic++;\n\n        if (current_survey_topic == survey_topics.length) {\n          p.finished_survey();\n          return true;\n        }\n      }\n    }\n\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n    return false;\n  };\n\n  p.drop_effect_on_card = c => {\n    current_survey_topic = 1;\n    survey_drop_target = c;\n\n    if (p.progress_survey_through_issues()) {\n      return;\n    }\n  };\n\n  p.click_to_edit_card = c => {\n    if (c.mouse_over_mana) {\n      editing = \"mana\";\n      editing_card = c;\n    } else if (c.mouse_over_power) {\n      editing = \"power\";\n      editing_card = c;\n    } else if (c.mouse_over_toughness && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"toughness\";\n      editing_card = c;\n    } else if (c.mouse_over_card_effect && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"effect\";\n      editX = c.hovered_effect.x + blank_spell_img.width * p.min(p.width * 0.0005, 0.75) * 0.75;\n      editY = c.hovered_effect.y + c.hovered_effect.effect_string_height / 2;\n      editing_card = c;\n      effect_to_remove = c.hovered_effect;\n    } else if (editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10) {\n      editing_card.effects.splice(editing_card.effects.indexOf(effect_to_remove), 1);\n      editing = \"none\";\n    } else {\n      editing = \"none\";\n    }\n  };\n\n  p.mouse_click_while_editing = () => {\n    if (editing == \"mana\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY - 50) < 40) {\n        editing_card.mana--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY - 50) < 40) {\n        editing_card.mana++;\n      } else {\n        editing = \"none\";\n      }\n\n      editing_card.mana = p.constrain(editing_card.mana, 0, 10);\n    } else if (editing == \"power\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.power--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.power++;\n      } else {\n        editing = \"none\";\n      }\n\n      editing_card.power = p.constrain(editing_card.power, 0, 10);\n    } else if (editing == \"toughness\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.toughness--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.toughness++;\n      } else {\n        editing = \"none\";\n      }\n\n      editing_card.toughness = p.constrain(editing_card.toughness, 1, 10);\n    } else if (editing == \"effect\") {\n      editing = \"none\";\n    }\n  };\n\n  p.draw_edit_overlay = () => {\n    p.push();\n\n    if (editing != \"none\") {\n      p.translate(editX, editY);\n      p.noStroke();\n\n      if (editing == \"effect\") {\n        p.rotate(p.QUARTER_PI);\n        p.fill(0);\n        p.rect(0, 0, 22, 6);\n        p.rect(0, 0, 6, 22);\n        p.fill(255);\n        p.rect(0, 0, 20, 4);\n        p.rect(0, 0, 4, 20);\n      } else {\n        p.fill(0);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 8, 32);\n        p.fill(255);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 6, 30);\n      }\n    }\n\n    p.pop();\n  };\n\n  p.mousePressed = () => {\n    if (setup_done) {\n      if (survey_topics[current_survey_topic] != \"none\") {\n        p.mouse_pressed_while_surveying();\n      } else {\n        p.mouse_pressed_while_not_surveying();\n      }\n    }\n  };\n\n  p.finished_survey = () => {\n    survey_drop_target.effects.push(JSON.parse(JSON.stringify(the_mouse.effect)));\n    current_survey_topic = 0;\n    the_mouse.effect = null;\n    the_mouse.busy = false;\n  };\n\n  p.keyPressed = () => {};\n\n  p.windowResized = () => {\n    p.resizeCanvas(p.windowWidth, p.windowHeight);\n    p.resize_all();\n  };\n\n  p.ease_out_cubic = x => {\n    return 1 - p.pow(1 - x, 3);\n  };\n\n  p.send_overlay = () => {\n    p.text(\"Thank you for completing the tasks,\\nplease submit your responses to the system.\", p.width / 2, p.height / 2);\n    p.push();\n    let queur_x = p.width - w_padding;\n    let queur_y = p.height - h_padding;\n    mouse_over_queuer = p.mouseX > queur_x - 100 && p.mouseX < queur_x + 100 && p.mouseY > queur_y - 30 && p.mouseY < queur_y + 30;\n    p.translate(queur_x, queur_y);\n\n    if (sending) {\n      let q = p.map(p.millis(), send_start_time, send_start_time + estimated_send_duration, 0, 1, true);\n      q = p.ease_out_cubic(q);\n      p.fill(255, p.map(q, 0, 1, 50, 100));\n      p.rect(p.map(q, 0, 1, -100, 0), 0, p.map(q, 0, 1, 0, 200), 60, 4);\n      p.rect(0, 0, 200, 60, 4);\n    } else {\n      p.fill(255, mouse_over_queuer ? 255 : 100);\n      p.rect(0, 0, 200, 60, 4);\n    }\n\n    p.fill(0, 255);\n    p.textAlign(p.CENTER, p.CENTER);\n    p.text(sending ? sent ? \"Sending again...\" : \"Sending...\" : sent ? mouse_over_queuer ? \"Send again\" : \"Done.\" : \"Send to system\", 0, -4);\n    p.pop();\n  };\n\n  p.submit = () => {\n    if (!sending) {\n      sending = true;\n      send_start_time = p.millis();\n      const submissions = p.generate_submissions();\n      props.send_to_google_sheets(submissions).then(result => {\n        console.log(result);\n        sending = false;\n        sent = true;\n      });\n    }\n  };\n\n  p.load_save = () => {\n    props.load_from_google_sheets(user).then(result => {\n      if (result.data.r) {\n        let loaded_save = result.data.r.data.values[0];\n\n        if (loaded_save[2]) {\n          tasks = JSON.parse(loaded_save[2]);\n\n          for (let t of tasks) {\n            for (let c of t) {\n              c.__proto__ = p.Card.prototype;\n            }\n          }\n\n          p.resize_all();\n        }\n      } else {\n        console.log(result.data.e);\n      }\n    });\n  };\n\n  p.make_save = () => {\n    let asString = JSON.stringify(tasks);\n    props.save_to_google_sheets([user, asString]).then(result => {\n      console.log(result);\n    });\n  };\n\n  p.generate_submissions = () => {\n    const submissions = [];\n    p.make_save();\n\n    for (let t of tasks) {\n      for (let c of t) {\n        let card_submission = {\n          id: c.card_id,\n          task: c.card_task_index,\n          user: user,\n          p: c.power,\n          t: c.toughness,\n          m: c.mana\n        };\n        let repeat_checker = {};\n\n        for (let e of c.effects) {\n          if (repeat_checker[e.effect_short] == undefined) {\n            repeat_checker[e.effect_short] = 0;\n          } else {\n            repeat_checker[e.effect_short]++;\n          }\n\n          if (e.settings.methods[0] != null) card_submission[e.effect_short + \"-method-\" + repeat_checker[e.effect_short]] = e.settings.methods[1];\n          if (e.settings.params[0] != null) card_submission[e.effect_short + \"-param-\" + repeat_checker[e.effect_short]] = e.settings.params[1];\n          if (e.settings.targets[0] != null) card_submission[e.effect_short + \"-target-\" + repeat_checker[e.effect_short]] = e.settings.targets[1];\n          if (e.settings.filters[0] != null) card_submission[e.effect_short + \"-filter-\" + repeat_checker[e.effect_short]] = e.settings.filters[1];\n          if (e.settings.duration[0] != null) card_submission[e.effect_short + \"-duration-\" + repeat_checker[e.effect_short]] = e.settings.duration[1];\n        }\n\n        submissions[c.card_task_index + \"-\" + c.card_id] = card_submission;\n      }\n    }\n\n    return submissions;\n  };\n\n  p.resize_all = () => {\n    h_padding = p.height * 0.1;\n    w_padding = p.width * 0.2;\n    grid_h_padding = p.height * 0.2;\n    grid_w_padding = p.width * 0.1;\n    font_pixels_large = p.min(p.width * 32 * 0.0008, 32);\n    font_pixels = p.min(p.width * 24 * 0.0008, 24);\n    font_pixels_small = p.min(p.width * 20 * 0.0008, 20);\n\n    for (let b of buttons) {\n      b.resized();\n    }\n\n    for (let t of tasks) {\n      for (let c of t) {\n        c.resized();\n      }\n    }\n\n    for (let e of effects) {\n      e.resized();\n    }\n\n    p.generate_masks();\n  };\n\n  p.generate_masks = () => {\n    ellipse_mask = p.createGraphics(250, 250);\n    ellipse_mask.ellipse(ellipse_mask.width / 2, ellipse_mask.height / 2, 200, 200);\n    rect_mask = p.createGraphics(250, 250);\n    rect_mask.rectMode(p.CENTER);\n    rect_mask.rect(rect_mask.width / 2, rect_mask.height / 2, 200, 160);\n  };\n\n  p.register_effect = (effect_text, effect_short, method, param, targets, filters, duration) => {\n    effects[effect_text] = new p.Effect(effect_text, effect_short, method, param, targets, filters, duration);\n    buttons.push(new p.Button(effect_text, button_id++));\n\n    if (button_id == 0 || button_id == 2 || button_id == 11) {\n      button_id++;\n    }\n  };\n\n  p.register_all = () => {\n    p.register_effect(\"Keywords\", \"key\", null, [\"k\"], null, null, null);\n    p.register_effect(\"Creature types\", \"cre\", null, [\"c\"], null, null, null);\n    p.register_effect(\"Deal damage\", \"dam\", [\"randomly\", \"targeted\", \"all\"], [\"x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Destroy minions\", \"des\", [\"randomly\", \"targeted\", \"all\"], null, [\"minions\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Heal\", \"hea\", [\"randomly\", \"targeted\", \"all\"], [\"x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Gain armour\", \"arm\", null, [\"x\"], null, null, null);\n    p.register_effect(\"Return to hand\", \"ret\", [\"randomly\", \"targeted\", \"all\"], null, [\"minions\", \"pirates\", \"beasts\", \"elementals\", \"totems\"], [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Draw cards\", \"dra\", null, [\"x\"], null, [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Gain mana crystals\", \"gai\", null, [\"x\"], null, [\"enemy\", \"friendly\", \"all\"], null);\n    p.register_effect(\"Summon token\", \"sum\", null, [\"x/x\"], null, null, null);\n    p.register_effect(\"Modify stats\", \"cha\", [\"randomly\", \"targeted\", \"all\", \"aura\"], [\"x/x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], [\"turn\", \"permanently\"]);\n    p.register_effect(\"Set stats\", \"set\", [\"randomly\", \"targeted\", \"all\", \"aura\"], [\"x/x\"], [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], [\"turn\", \"permanently\"]);\n    p.register_effect(\"Give keyword\", \"giv\", [\"randomly\", \"targeted\", \"all\", \"aura\"], [\"k\"], [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"], [\"enemy\", \"friendly\", \"all\"], [\"turn\", \"permanently\"]);\n  };\n\n  p.FancyMouse = class {\n    constuctor() {\n      this.busy = false;\n      this.xOffset = 0;\n      this.yOffset = 0;\n      this.effect = null;\n    }\n\n    setOffset(buttonX, buttonY) {\n      this.xOffset = p.mouseX - buttonX;\n      this.yOffset = p.mouseY - buttonY;\n    }\n\n  };\n  p.Effect = class {\n    constructor(label_name, effect_short, methods, param_format, targets, filters, duration) {\n      this.x = 0;\n      this.y = 0;\n      this.effect_string = \"\";\n      this.effect_string_height = 0;\n      this.effect_string_width = blank_spell_img.width * p.min(p.width * 0.0005, 0.75) / 2;\n      this.label_name = label_name;\n      this.effect_short = effect_short;\n      this.settings = {\n        methods: [methods, \"\"],\n        params: [param_format, \"\"],\n        targets: [targets, \"\"],\n        filters: [filters, \"\"],\n        duration: [duration, \"\"]\n      };\n    }\n\n  };\n  p.Card = class {\n    constructor(card_id, card_task_index, card_class) {\n      this.y = 0;\n      this.x = 0;\n      this.w = blank_spell_img.width * 0.75;\n      this.h = blank_spell_img.height * 0.75;\n      this.oversized = false;\n      this.class = card_class;\n      this.type_id = 1; //creature\n\n      this.card_id = card_id;\n      this.card_task_index = card_task_index;\n      this.flav_img_index = p.floor(p.random(gan_imgs.length));\n      this.mana = 5;\n      this.power = 5;\n      this.toughness = 5;\n      this.effects = [];\n      this.hovered_effect = null;\n      this.mouse_over_card_effect = false;\n      this.mouse_over_mana = false;\n      this.mouse_over_power = false;\n      this.mouse_over_toughness = false;\n    }\n\n    resized() {\n      if (tasks[this.card_task_index].length == 1) {\n        this.x = p.map(2, 0, 3, w_padding, p.width - w_padding);\n      } else if (tasks[this.card_task_index].length == 2) {\n        this.x = p.map(this.card_id == 0 ? 1.5 : 2.5, 0, 3, w_padding, p.width - w_padding);\n      } else {\n        this.x = p.map(this.card_id + 1, 0, 3, w_padding, p.width - w_padding);\n      }\n\n      this.y = p.height / 2;\n      this.w = blank_spell_img.width * p.min(p.width * 0.0005, 0.75);\n      this.h = blank_spell_img.height * p.min(p.width * 0.0005, 0.75);\n\n      for (let e of this.effects) {\n        e.effect_string_width = blank_spell_img.width * p.min(p.width * 0.0005, 0.75) * 0.75;\n        p.textSize(font_pixels_small);\n        let num_lines = p.textWidth(e.effect_string) / e.effect_string_width;\n        e.effect_string_height = font_pixels_small * p.ceil(num_lines) + font_pixels_small;\n      }\n    }\n\n    run() {\n      this.generate_effect_text();\n      this.check_mouse_hovers();\n      this.display();\n    }\n\n    generate_effect_text() {\n      for (let e of this.effects) {\n        e.effect_string = \"\";\n\n        if (e.label_name == \"Keyword\" || e.label_name == \"Creature type\") {\n          e.effect_string = e.settings.params[1];\n        } else if (e.effect_short == \"dam\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Battlecry: Randomly deal \" + e.settings.params[1] + \" damage to a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Battlecry: Deal \" + e.settings.params[1] + \" damage to target \";\n          } else {\n            e.effect_string = \"Battlecry: Deal \" + e.settings.params[1] + \" damage to all \";\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \"; //remove \"all all\"\n\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1];\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])];\n          }\n        } else if (e.label_name == \"Destroy\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Randomly destroy a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Destroy a target \";\n          } else {\n            e.effect_string = \"Destroy all \";\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \"; //remove \"all all\"\n\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1];\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])];\n          }\n        } else if (e.label_name == \"Heal\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a random \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a target \";\n          } else {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to all \";\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \"; //remove \"all all\"\n\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1];\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])];\n          }\n        } else {\n          e.effect_string = e.label_name;\n        }\n\n        p.textSize(font_pixels_small);\n        let num_lines = p.textWidth(e.effect_string) / e.effect_string_width;\n        e.effect_string_height = font_pixels_small * p.ceil(num_lines) + font_pixels_small;\n      }\n    }\n\n    display() {\n      p.push();\n      p.fill(0);\n      p.textAlign(p.CENTER, p.CENTER);\n\n      if (this.effects.length > 1) {\n        this.oversized = true;\n      } else {\n        this.oversized = false;\n      }\n\n      let flav = gan_imgs[this.flav_img_index].get();\n      let forg;\n\n      if (card_types[this.type_id] == \"spell\") {\n        flav.mask(rect_mask);\n        forg = blank_spell_img;\n      } else if (card_types[this.type_id] == \"minion\") {\n        flav.mask(ellipse_mask);\n        forg = this.oversized ? full_blank_creature_img : blank_creature_img;\n      } else {\n        flav.mask(rect_mask);\n        forg = blank_weapon_img;\n      }\n\n      if (!this.oversized) {\n        p.image(flav, this.x, this.y - this.h * 0.20, this.w * 0.7, this.h * 0.7);\n      }\n\n      p.image(forg, this.x, this.y, this.w, this.h);\n      p.push();\n      p.textSize(font_pixels_large * 2);\n      p.fill(255);\n      p.strokeWeight(3);\n      p.stroke(0);\n\n      if (card_types[this.type_id] == \"minion\") {\n        p.text(this.power, this.x - this.w / 2.99, this.y + this.h / 2.8);\n        p.text(this.toughness, this.x + this.w / 2.6, this.y + this.h / 2.8);\n      }\n\n      p.text(this.mana, this.x - this.w / 2.99, this.y - this.h / 2.3);\n      p.pop();\n      p.push();\n      p.fill(0);\n      let translation_offset_y;\n\n      if (this.oversized) {\n        translation_offset_y = this.y - this.h * 0.3;\n        p.translate(this.x, this.y - this.h * 0.3);\n      } else {\n        translation_offset_y = this.y + this.h * 0.1;\n        p.translate(this.x, this.y + this.h * 0.1);\n      }\n\n      this.mouse_over_card_effect = false;\n      this.hovered_effect = null;\n\n      for (let e of this.effects) {\n        translation_offset_y += e.effect_string_height / 2;\n        p.translate(0, e.effect_string_height / 2);\n\n        if (p.mouseY > translation_offset_y - e.effect_string_height / 2 && p.mouseY < translation_offset_y + e.effect_string_height / 2 && p.mouseX > this.x - e.effect_string_width / 2 && p.mouseX < this.x + e.effect_string_width / 2) {\n          this.mouse_over_card_effect = true;\n          this.hovered_effect = e;\n          this.hovered_effect.x = this.x - e.effect_string_width / 2;\n          this.hovered_effect.y = translation_offset_y - e.effect_string_height;\n          p.fill(0, 100);\n        } else {\n          p.fill(0, 50);\n        }\n\n        p.rect(0, 0, e.effect_string_width, e.effect_string_height, 4, 4);\n        p.fill(255, 255);\n        p.textSize(font_pixels_small);\n        p.textAlign(p.LEFT, p.TOP);\n        p.text(e.effect_string, 0, 0, e.effect_string_width, e.effect_string_height);\n        translation_offset_y += e.effect_string_height / 2 + 5;\n        p.translate(0, e.effect_string_height / 2 + 5);\n      }\n\n      p.pop();\n      p.push();\n\n      if (editing_card == this) {\n        if (editing == \"mana\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y - this.h / 2.3;\n        } else if (editing == \"power\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y + this.h / 2.8;\n        } else if (editing == \"toughness\") {\n          editX = this.x + this.w / 2.6;\n          editY = this.y + this.h / 2.8;\n        }\n      }\n\n      p.pop();\n      p.pop();\n    }\n\n    mouseInImg() {\n      return p.mouseX > this.x - this.w / 2 - mouse_padding && p.mouseX < this.x + this.w / 2 + mouse_padding && p.mouseY > this.y - this.h / 2 - mouse_padding && p.mouseY < this.y + this.h / 2 + mouse_padding;\n    }\n\n    check_mouse_hovers() {\n      if (card_types[this.type_id] == \"minion\") {\n        this.mouse_over_power = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y + this.h / 2.8) < 50;\n        this.mouse_over_toughness = p.dist(p.mouseX, p.mouseY, this.x + this.w / 2.6, this.y + this.h / 2.8) < 50;\n      }\n\n      this.mouse_over_mana = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y - this.h / 2.3) < 50;\n    }\n\n  };\n  p.Button = class {\n    constructor(button_name, button_id) {\n      this.button_name = button_name;\n      this.button_id = button_id;\n      this.x = 0;\n      this.y = 0;\n      this.w = p.textWidth(button_name) + 14;\n      this.h = font_pixels + 10;\n      this.fillAlpha = 100;\n      this.text_x = 0;\n      this.text_y = 0;\n    }\n\n    mouseInRegion() {\n      return p.mouseX > this.x - this.w / 2 - mouse_padding && p.mouseX < this.x + this.w / 2 + mouse_padding && p.mouseY > this.y - this.h / 2 - mouse_padding && p.mouseY < this.y + this.h / 2 + mouse_padding;\n    }\n\n    resized() {\n      this.w = p.textWidth(this.button_name) + 14;\n      this.h = font_pixels + 10;\n      this.x = w_padding / 2 + this.w / 2 - 7;\n      this.y = p.map(this.button_id, 0, 16, h_padding, p.height - h_padding);\n      this.text_x = this.x - this.w / 2 + 7;\n      this.text_y = this.y - 6;\n    }\n\n    run() {\n      this.update();\n      this.display();\n    }\n\n    update() {\n      if (this.mouseInRegion() && current_survey_topic == 0) {\n        this.fillAlpha = 255;\n      } else {\n        this.fillAlpha = 100;\n      }\n    }\n\n    display() {\n      p.textSize(font_pixels);\n      p.textAlign(p.LEFT, p.CENTER);\n      p.fill(255, this.fillAlpha);\n      p.rect(this.x, this.y, this.w, this.h, 4, 4);\n      p.fill(0, 255);\n      p.text(this.button_name, this.text_x, this.text_y);\n    }\n\n  };\n\n  document.oncontextmenu = function () {\n    return false;\n  };\n}","map":{"version":3,"sources":["/Users/aep/phd/hearth-mici/src/code/sketch.js"],"names":["sketch","p","buttons","button_id","effects","current_task_index","task_details","id","title","instruction","num_cards","class","user","tasks","card_types","method_names","target_names","target_names_singular","filter_names","duration_names","param_format_names","effect_names","keywords","all_creature_types","creature_types","survey_topics","current_survey_topic","survey_drop_target","font_pixels_large","font_pixels","font_pixels_small","hearthstone_font","mouse_padding","w_padding","h_padding","grid_w_padding","grid_h_padding","rect_mask","ellipse_mask","blank_spell_img","blank_creature_img","blank_weapon_img","full_blank_creature_img","bg","gan_imgs","the_mouse","setup_done","hovered_option","editing","editing_card","effect_to_remove","editX","editY","sending","send_start_time","estimated_send_duration","sent","mouse_over_queuer","mouse_over_next","mouse_over_prev","props","myCustomRedrawAccordingToNewPropsHandler","_props","preload","loadImage","bg_img","spell_img","weapon_img","creature_img","loadFont","hs_font","im","push","setup","createCanvas","windowWidth","windowHeight","getURLParams","FancyMouse","height","width","imageMode","CENTER","rectMode","textFont","textSize","fill","noStroke","register_all","task","card_id","Card","load_save","resize_all","draw","background","textAlign","LEFT","image","length","c","run","b","busy","translate","mouseX","xOffset","mouseY","yOffset","text","effect","label_name","pop","draw_edit_overlay","draw_task_controls","send_overlay","draw_task_overlay","draw_survey","next_x","next_y","dist","triangle","prev_x","map","RIGHT","setting","settings","options","attack","defense","xPos","yPos","box_width","box_height","rect","option_button_width","option_button_height","option_buttons_padding","index","option","entries","option_string","toString","toUpperCase","substring","split","join","mouse_pressed_while_surveying","progress_survey_through_issues","floor","mouse_pressed_while_not_surveying","clicked_card","mouseInImg","drop_effect_on_card","click_to_edit_card","setOffset","submit","mouse_click_while_editing","mouseInRegion","text_x","text_y","JSON","parse","stringify","button_name","finished_survey","i","includes","mouse_over_mana","mouse_over_power","mouse_over_toughness","mouse_over_card_effect","hovered_effect","x","min","y","effect_string_height","splice","indexOf","mana","constrain","power","toughness","rotate","QUARTER_PI","mousePressed","keyPressed","windowResized","resizeCanvas","ease_out_cubic","pow","queur_x","queur_y","q","millis","submissions","generate_submissions","send_to_google_sheets","then","result","console","log","load_from_google_sheets","data","r","loaded_save","values","t","__proto__","prototype","e","make_save","asString","save_to_google_sheets","card_submission","card_task_index","m","repeat_checker","effect_short","undefined","methods","params","targets","filters","duration","resized","generate_masks","createGraphics","ellipse","register_effect","effect_text","method","param","Effect","Button","constuctor","buttonX","buttonY","constructor","param_format","effect_string","effect_string_width","card_class","w","h","oversized","type_id","flav_img_index","random","num_lines","textWidth","ceil","generate_effect_text","check_mouse_hovers","display","flav","get","forg","mask","strokeWeight","stroke","translation_offset_y","TOP","fillAlpha","update","document","oncontextmenu"],"mappings":"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","sourcesContent":["/* eslint eqeqeq: \"off\", no-unused-vars: \"off\" */\n\n\n//to fix totalHeight bug, change p5 by changing o-totalHeight to just o\n//todo: fix this on a generic p5 import somehow\n\n\n//todo: language stuff\n//todo: buttons\n//todo: creature types\n//todo: card types\n//todo: effect limit\n//ABC test reports, articulate logic for report design\n\n//make rampiness, variety, controllynes and see when they would be useful\n\nexport default function sketch(p) {\n\n\n  const buttons = [];\n  let button_id = 0;\n\n  const effects = [];\n\n\n  let current_task_index = 0;\n  const task_details = [{\n    id: 0,\n    title: \"3 Hunter Cards\",\n    instruction: \"Design three cards for hunter\",\n    num_cards: 3,\n    class: \"hunter\"\n  },\n  {\n    id: 1,\n    title: \"3 Warrior Cards\",\n    instruction: \"Design three cards for warrior\",\n    num_cards: 3,\n    class: \"warrior\"\n  },\n  {\n    id: 2,\n    title: \"3 Mage Cards\",\n    instruction: \"Design three cards for mage\",\n    num_cards: 3,\n    class: \"mage\"\n  },\n  {\n    id: 3,\n    title: \"3 Neutral Cards\",\n    instruction: \"Design three neutral cards\",\n    num_cards: 3,\n    class: \"all\"\n  }\n  ]\n\n\n\n  let user = \"\"\n\n  let tasks = [];\n  const card_types = [\"spell\", \"minion\", \"weapon\"]\n\n  const method_names = [\"randomly\", \"targeted\", \"all\", \"aura\"];\n  const target_names = [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"];\n  const target_names_singular = [\"minion\", \"hero\", \"minion or hero\", \"pirate\", \"beast\", \"elemental\", \"totem\", \"weapon\"]\n  const filter_names = [\"enemy\", \"friendly\", \"all\"];\n  const duration_names = [\"turn\", \"permanently\"];\n  const param_format_names = [\"x\", \"x/x\", \"k\", \"c\"];\n  const effect_names = [\"Deal damage\", \"Destroy\", \"Heal\", \"Gain armour\", \"Change stats\", \"Set stats\", \"Give keyword\", \"Return to hand\", \"Draw\", \"Gain mana\", \"Summon: \", \"Battlecry: \", \"Deathrattle: \"]\n  const keywords = [\"Taunt\", \"Charge\", \"Lifesteal\", \"Spell damage +1\", \"Divine shield\", \"Poisonous\", \"Windfury\", \"Frozen\"]\n  const all_creature_types = [\"pirate\", \"beast\", \"elemental\", \"totem\", \"dragon\", \"pirate\", \"mech\", \"elemental\"]\n  const creature_types = [\"Pirate\", \"Beast\", \"Elemental\", \"Totem\"]\n\n  const survey_topics = [\"none\", \"methods\", \"filters\", \"targets\", \"duration\", \"params\"];\n  let current_survey_topic = 0;\n\n  let survey_drop_target = null;\n\n  let font_pixels_large = 32;\n  let font_pixels = 24;\n  let font_pixels_small = 20;\n\n  let hearthstone_font;\n  const mouse_padding = 1;\n  let w_padding, h_padding;\n  let grid_w_padding, grid_h_padding;\n\n  let rect_mask, ellipse_mask;\n  let blank_spell_img, blank_creature_img, blank_weapon_img, full_blank_creature_img;\n  let bg;\n  let gan_imgs = [];\n\n\n  let the_mouse;\n  let setup_done = false;\n  let hovered_option = -1;\n\n  let editing = \"none\";\n  let editing_card = null;\n  let effect_to_remove = null;\n  let editX = 0;\n  let editY = 0;\n\n  let sending = false;\n  let send_start_time = -10000;\n  const estimated_send_duration = 3000; //over-estimate\n  let sent = false;\n\n  let mouse_over_queuer;\n  let mouse_over_next;\n  let mouse_over_prev;\n\n\n  let props;\n\n\n  p.myCustomRedrawAccordingToNewPropsHandler = (_props) => {\n    props = _props;\n  }\n\n  p.preload = () => {\n    bg = p.loadImage(props.bg_img)\n    blank_spell_img = p.loadImage(props.spell_img);\n    blank_weapon_img = p.loadImage(props.weapon_img)\n    blank_creature_img = p.loadImage(props.creature_img)\n    full_blank_creature_img = p.loadImage(props.full_blank_creature_img);\n    hearthstone_font = p.loadFont(props.hs_font);\n    for (let im of props.gan_imgs) {\n      gan_imgs.push(p.loadImage(im))\n    }\n  }\n\n\n  p.setup = () => {\n    p.createCanvas(p.windowWidth, p.windowHeight);\n    user = p.getURLParams().user ?? 2;\n\n\n   \n    the_mouse = new p.FancyMouse();\n\n\n    h_padding = p.height * 0.1;\n    w_padding = p.width * 0.2;\n    grid_h_padding = p.height * 0.2;\n    grid_w_padding = p.width * 0.1;\n    p.imageMode(p.CENTER)\n    p.rectMode(p.CENTER);\n    p.textFont(hearthstone_font);\n    p.textSize(font_pixels);\n    p.fill(255);\n    p.noStroke();\n\n    p.register_all();\n\n\n    for (let task of task_details) {\n      tasks[task.id] = [];\n      for (let card_id = 0; card_id < task.num_cards; card_id++) {\n        tasks[task.id].push(new p.Card(card_id, task.id, task.class));\n      }\n    }\n\n    p.load_save(); //loads save file from google sheets if it exists\n\n    p.resize_all();\n\n\n\n    setup_done = true;\n\n  }\n\n\n  p.draw = () => {\n    p.resize_all();\n    p.background(255)\n    p.textAlign(p.LEFT, p.CENTER);\n    p.image(bg, p.width / 2, p.height / 2, p.width, p.height);\n\n\n    if (current_task_index < task_details.length) {\n      for (let c of tasks[current_task_index]) {\n        c.run();\n      }\n    }\n\n    for (let b of buttons) {\n      b.run();\n    }\n\n    if (the_mouse.busy && current_survey_topic == 0) {\n      p.push();\n      p.translate(p.mouseX - the_mouse.xOffset, p.mouseY - the_mouse.yOffset)\n      p.textSize(28)\n      p.text(the_mouse.effect.label_name, 0, 0)\n      p.pop();\n    }\n\n    p.draw_edit_overlay();\n    p.draw_task_controls();\n\n\n    if (current_task_index == task_details.length) {\n      p.send_overlay();\n    } else {\n      p.draw_task_overlay();\n\n    }\n\n\n    if (survey_topics[current_survey_topic] != \"none\") {\n      p.draw_survey();\n    }\n\n  }\n\n  p.draw_task_controls = () => {\n\n\n    let next_x = p.width - w_padding;\n    let next_y = p.height - h_padding;\n    mouse_over_next = p.dist(p.mouseX, p.mouseY, next_x, next_y) < 75;\n\n    p.push();\n    p.translate(next_x, next_y)\n    p.fill(255, current_task_index == task_details.length ? 0 : mouse_over_next ? 255 : 100)\n    p.triangle(0, -25, 0, 25, 75, 0);\n    p.pop();\n\n    let prev_x = p.map(1, 0, 3, w_padding, p.width - w_padding)\n    mouse_over_prev = p.dist(p.mouseX, p.mouseY, prev_x, next_y) < 75;\n\n    p.push();\n    p.translate(prev_x, next_y)\n    p.fill(255, current_task_index == 0 ? 50 : mouse_over_prev ? 255 : 100)\n    p.triangle(0, -25, 0, 25, -75, 0);\n    p.pop();\n\n  }\n\n  p.draw_task_overlay = () => {\n    p.textAlign(p.RIGHT, p.CENTER)\n    p.textSize(font_pixels);\n    p.text(task_details[current_task_index].instruction, p.width - w_padding / 2, h_padding)\n\n\n    p.fill(0);\n    p.textAlign(p.CENTER, p.CENTER);\n    p.text(`Task ${current_task_index + 1} \\\\ ${task_details.length}`, p.map(2, 0, 3, w_padding, p.width - w_padding), p.height - h_padding)\n  }\n\n\n\n  p.draw_survey = () => {\n    p.push();\n    p.textAlign(p.CENTER, p.CENTER)\n    p.textSize(font_pixels)\n\n    p.rectMode(p.CENTER)\n    p.background(0, 100)\n\n    let setting = the_mouse.effect.settings[survey_topics[current_survey_topic]]\n    let options = setting[0]\n\n\n    if (setting[0][0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];\n    } else if (setting[0][0] == \"k\") {\n      options = keywords\n    } else if (setting[0][0] == \"c\") {\n      options = creature_types;\n    }\n\n\n    if (options[0] == \"x/x\") {\n      for (let attack = 1; attack < 11; attack++) {\n        for (let defense = 1; defense < 11; defense++) {\n          let xPos = p.map(attack, 1, 10, grid_w_padding, p.width - grid_w_padding);\n          let yPos = p.map(defense, 1, 10, grid_h_padding, p.height - grid_h_padding);\n          let box_width = (p.width - grid_w_padding * 2) / 10;\n          let box_height = (p.height - grid_h_padding * 2) / 10;\n\n          if (p.mouseX > xPos - box_width / 2 && p.mouseX < xPos + box_width / 2 &&\n            p.mouseY > yPos - box_height / 2 && p.mouseY < yPos + box_height / 2) {\n            p.fill(255, 100);\n          } else {\n            p.fill(255, 0);\n          }\n          p.rect(xPos, yPos, box_width, box_height);\n          p.fill(255);\n          p.text(attack + \"/\" + defense, xPos, yPos - 10)\n        }\n      }\n    } else {\n\n\n      p.textSize(40);\n      p.fill(255)\n      p.text(the_mouse.effect.label_name + \"...\", p.width / 2, p.height * 0.1);\n\n      p.textSize(font_pixels)\n      p.rectMode(p.CENTER)\n\n      let option_button_width = (p.width / options.length) * 0.5;\n      let option_button_height = p.height * 0.10;\n      let option_buttons_padding = p.width * 0.25;\n\n      for (let [index, option] of options.entries()) {\n        let xPos = p.map(index, 0, options.length - 1, option_buttons_padding, p.width - option_buttons_padding);\n        if (p.mouseX > xPos - option_button_width / 2 && p.mouseX < xPos + option_button_width / 2) {\n          p.fill(255, 100)\n          hovered_option = index;\n        } else {\n          p.fill(255, 50)\n        }\n        p.rect(xPos, p.height * 0.5, option_button_width, option_button_height, 16);\n        p.fill(255);\n\n        let option_string = option.toString();\n        option_string = option_string[0].toUpperCase() + option_string.substring(1)\n        option_string = option_string.split(\" \").join(\"\\n\");\n\n        p.text(option_string, xPos, p.height / 2)\n      }\n    }\n\n    p.pop();\n  }\n\n\n  p.mouse_pressed_while_surveying = () => {\n    if (p.progress_survey_through_issues()) {\n      return\n    }\n\n\n    let setting = the_mouse.effect.settings[survey_topics[current_survey_topic]];\n    let options = setting[0]\n    if (options[0] == \"x\") {\n      options = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n    } else if (options[0] == \"k\") {\n      options = keywords;\n    } else if (options[0] == \"c\") {\n      options = creature_types;\n    }\n\n    if (options[0] == \"x/x\") {\n      setting[1] = `${p.floor(p.map(p.mouseX, 0, p.width, 1, 11))}/${p.floor(p.map(p.mouseY, 0, p.height, 1, 11))}`\n    } else {\n      setting[1] = options[hovered_option]\n    }\n\n\n\n    current_survey_topic++;\n\n    if (p.progress_survey_through_issues()) {\n      return\n    }\n\n  }\n\n\n  p.mouse_pressed_while_not_surveying = () => {\n    let clicked_card = null;\n\n    if (current_task_index < task_details.length) {\n      for (let c of tasks[current_task_index]) {\n        if (c.mouseInImg()) {\n          clicked_card = c;\n        }\n      }\n    }\n\n\n    if (clicked_card) {\n      if (the_mouse.busy) { //dropping effect onto a card\n        p.drop_effect_on_card(clicked_card)\n      } else { //clicking on a card generally\n        p.click_to_edit_card(clicked_card)\n      }\n    } else {\n      if (the_mouse.busy) { //clicked away to drop label\n        the_mouse.busy = false;\n        the_mouse.setOffset(0, 0);\n        the_mouse.effect = null;\n      } else { //other clicks\n\n\n        if (mouse_over_next && current_task_index < task_details.length) {\n          current_task_index++;\n        } else if (mouse_over_prev && current_task_index > 0) {\n          current_task_index--;\n        }\n\n        if (mouse_over_queuer && current_task_index == task_details.length && !sending) {\n          p.submit();\n        }\n\n        p.mouse_click_while_editing();\n\n\n        for (let b of buttons) { //clicking on a button with an empty hand\n          if (b.mouseInRegion()) {\n            the_mouse.busy = true;\n            the_mouse.setOffset(b.text_x, b.text_y);\n            the_mouse.effect = JSON.parse(JSON.stringify(effects[b.button_name]));\n\n            break;\n          }\n        }\n      }\n    }\n\n  }\n\n\n\n  //returns true if you need to return out of mouse\n  p.progress_survey_through_issues = () => {\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n    for (let i = 0; i < survey_topics.length; i++) {\n      if (the_mouse.effect.settings[survey_topics[current_survey_topic]][0] == null ||\n        (!param_format_names.includes(the_mouse.effect.settings[survey_topics[current_survey_topic]][0][0]) &&\n          the_mouse.effect.settings[survey_topics[current_survey_topic]][0].length == 1)) {\n        current_survey_topic++;\n        if (current_survey_topic == survey_topics.length) {\n          p.finished_survey();\n          return true;\n        }\n      }\n    }\n\n\n    if (current_survey_topic == survey_topics.length) {\n      p.finished_survey();\n      return true;\n    }\n\n\n    return false;\n  }\n\n  p.drop_effect_on_card = (c) => {\n    current_survey_topic = 1;\n    survey_drop_target = c;\n\n    if (p.progress_survey_through_issues()) {\n\n      return\n    }\n  }\n\n\n  p.click_to_edit_card = (c) => {\n\n    if (c.mouse_over_mana) {\n      editing = \"mana\";\n      editing_card = c;\n    } else if (c.mouse_over_power) {\n      editing = \"power\";\n      editing_card = c;\n    } else if (c.mouse_over_toughness && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"toughness\";\n      editing_card = c;\n    } else if (c.mouse_over_card_effect && !(editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10)) {\n      editing = \"effect\";\n      editX = c.hovered_effect.x + blank_spell_img.width * p.min(p.width*0.0005, 0.75)*0.75;\n      editY = c.hovered_effect.y + c.hovered_effect.effect_string_height / 2;\n      editing_card = c;\n      effect_to_remove = c.hovered_effect;\n    } else if (editing == \"effect\" && p.dist(p.mouseX, p.mouseY, editX, editY) < 10) {\n      editing_card.effects.splice(editing_card.effects.indexOf(effect_to_remove), 1);\n      editing = \"none\";\n    } else {\n      editing = \"none\";\n    }\n  }\n\n\n  p.mouse_click_while_editing = () => {\n    if (editing == \"mana\") {\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY - 50) < 40) {\n        editing_card.mana--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY - 50) < 40) {\n        editing_card.mana++;\n      } else {\n        editing = \"none\"\n      }\n      editing_card.mana = p.constrain(editing_card.mana, 0, 10)\n    } else if (editing == \"power\") {\n\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.power--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.power++;\n      } else {\n        editing = \"none\"\n      }\n      editing_card.power = p.constrain(editing_card.power, 0, 10)\n    } else if (editing == \"toughness\") {\n\n      if (p.dist(p.mouseX, p.mouseY, editX - 60, editY + 50) < 40) {\n        editing_card.toughness--;\n      } else if (p.dist(p.mouseX, p.mouseY, editX + 60, editY + 50) < 40) {\n        editing_card.toughness++;\n      } else {\n        editing = \"none\"\n      }\n      editing_card.toughness = p.constrain(editing_card.toughness, 1, 10)\n    } else if (editing == \"effect\") {\n      editing = \"none\";\n    }\n  }\n\n\n  p.draw_edit_overlay = () => {\n    p.push();\n    if (editing != \"none\") {\n      p.translate(editX, editY)\n      p.noStroke();\n      if (editing == \"effect\") {\n        p.rotate(p.QUARTER_PI);\n        p.fill(0);\n        p.rect(0, 0, 22, 6);\n        p.rect(0, 0, 6, 22);\n        p.fill(255);\n        p.rect(0, 0, 20, 4);\n        p.rect(0, 0, 4, 20);\n\n      } else {\n        p.fill(0);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 32, 8);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 8, 32);\n        p.fill(255);\n        p.rect(-60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 30, 6);\n        p.rect(60, editing == \"mana\" ? -50 : 75, 6, 30);\n      }\n    }\n    p.pop();\n  }\n\n  p.mousePressed = () => {\n    if (setup_done) {\n      if (survey_topics[current_survey_topic] != \"none\") {\n        p.mouse_pressed_while_surveying();\n      } else {\n        p.mouse_pressed_while_not_surveying();\n      }\n    }\n  }\n\n  p.finished_survey = () => {\n\n    survey_drop_target.effects.push(JSON.parse(JSON.stringify(the_mouse.effect)))\n    current_survey_topic = 0;\n    the_mouse.effect = null;\n    the_mouse.busy = false;\n  }\n\n  p.keyPressed = () => {\n\n\n  }\n\n  p.windowResized = () => {\n    p.resizeCanvas(p.windowWidth, p.windowHeight);\n    p.resize_all();\n  }\n\n  p.ease_out_cubic = (x) => {\n    return 1 - p.pow(1 - x, 3);\n  }\n\n\n  p.send_overlay = () => {\n\n    p.text(\"Thank you for completing the tasks,\\nplease submit your responses to the system.\", p.width/2, p.height/2)\n    p.push();\n    let queur_x = p.width - w_padding;\n    let queur_y = p.height - h_padding;\n    mouse_over_queuer = (p.mouseX > queur_x - 100 && p.mouseX < queur_x + 100 && p.mouseY > queur_y - 30 && p.mouseY < queur_y + 30)\n\n    p.translate(queur_x, queur_y);\n\n    if (sending) {\n      let q = p.map(p.millis(), send_start_time, send_start_time + estimated_send_duration, 0, 1, true)\n      q = p.ease_out_cubic(q);\n\n      p.fill(255, p.map(q, 0, 1, 50, 100));\n      p.rect(p.map(q, 0, 1, -100, 0), 0, p.map(q, 0, 1, 0, 200), 60, 4);\n      p.rect(0, 0, 200, 60, 4);\n    } else {\n      p.fill(255, mouse_over_queuer ? 255 : 100);\n      p.rect(0, 0, 200, 60, 4)\n    }\n\n\n\n    p.fill(0, 255);\n    p.textAlign(p.CENTER, p.CENTER)\n    p.text(sending ? sent ? \"Sending again...\" : \"Sending...\" : sent ? mouse_over_queuer ? \"Send again\" : \"Done.\" : \"Send to system\", 0, -4)\n    p.pop();\n\n  }\n\n  p.submit = () => {\n    if (!sending) {\n      sending = true;\n      send_start_time = p.millis();\n\n      const submissions = p.generate_submissions();\n\n      props.send_to_google_sheets(submissions).then((result) => {\n        console.log(result);\n        sending = false;\n        sent = true;\n\n      })\n    }\n  }\n\n  p.load_save = () => {\n    props.load_from_google_sheets(user).then((result) => {\n      if(result.data.r){\n        let loaded_save = result.data.r.data.values[0];\n        if(loaded_save[2]){\n          tasks = JSON.parse(loaded_save[2]);\n          for(let t of tasks){\n            for(let c of t){\n              c.__proto__ = p.Card.prototype;\n            }\n          }\n          p.resize_all();\n        }\n      } else {\n        console.log(result.data.e)\n      }\n    });\n  }\n\n  p.make_save = () => {\n    let asString = JSON.stringify(tasks)\n\n    props.save_to_google_sheets([user, asString]).then((result) => {\n      console.log(result);\n    })\n  }\n\n  p.generate_submissions = () => {\n    const submissions = [];\n    p.make_save();\n\n    for (let t of tasks) {\n      for (let c of t) {\n        let card_submission = {\n          id: c.card_id,\n          task: c.card_task_index,\n          user: user,\n          p: c.power,\n          t: c.toughness,\n          m: c.mana,\n        }\n\n\n        let repeat_checker = {};\n\n        for (let e of c.effects) {\n          if (repeat_checker[e.effect_short] == undefined) {\n            repeat_checker[e.effect_short] = 0;\n          } else {\n            repeat_checker[e.effect_short]++;\n          }\n\n          if (e.settings.methods[0] != null) card_submission[e.effect_short + \"-method-\" + repeat_checker[e.effect_short]] = e.settings.methods[1];\n          if (e.settings.params[0] != null) card_submission[e.effect_short + \"-param-\" + repeat_checker[e.effect_short]] = e.settings.params[1];\n          if (e.settings.targets[0] != null) card_submission[e.effect_short + \"-target-\" + repeat_checker[e.effect_short]] = e.settings.targets[1];\n          if (e.settings.filters[0] != null) card_submission[e.effect_short + \"-filter-\" + repeat_checker[e.effect_short]] = e.settings.filters[1];\n          if (e.settings.duration[0] != null) card_submission[e.effect_short + \"-duration-\" + repeat_checker[e.effect_short]] = e.settings.duration[1];\n\n        }\n        submissions[c.card_task_index + \"-\" + c.card_id] = card_submission;\n      }\n    }\n\n    return submissions;\n  }\n\n  p.resize_all = () => {\n    \n    h_padding = p.height * 0.1;\n    w_padding = p.width * 0.2;\n    grid_h_padding = p.height * 0.2;\n    grid_w_padding = p.width * 0.1;\n\n    font_pixels_large = p.min(p.width*32*0.0008, 32);\n    font_pixels = p.min(p.width*24*0.0008, 24);\n    font_pixels_small = p.min(p.width*20*0.0008, 20);\n\n    for (let b of buttons) {\n      b.resized();\n    }\n\n    for (let t of tasks) {\n      for (let c of t) {\n        c.resized();\n        \n      }\n    }\n\n    for(let e of effects){\n      e.resized();\n    }\n\n    p.generate_masks();\n\n  }\n\n  p.generate_masks = () => {\n    ellipse_mask = p.createGraphics(250, 250);\n    ellipse_mask.ellipse(ellipse_mask.width / 2, ellipse_mask.height / 2, 200, 200)\n\n    rect_mask = p.createGraphics(250, 250);\n    rect_mask.rectMode(p.CENTER);\n    rect_mask.rect(rect_mask.width / 2, rect_mask.height / 2, 200, 160)\n  }\n\n  p.register_effect = (effect_text, effect_short, method, param, targets, filters, duration) => {\n\n    effects[effect_text] = new p.Effect(effect_text, effect_short, method, param, targets, filters, duration);\n    buttons.push(new p.Button(effect_text, button_id++));\n    if(button_id == 0 || button_id == 2 || button_id == 11){\n      button_id++;\n    }\n  }\n\n  p.register_all = () => {\n\n   \n\n    p.register_effect(\"Keywords\", \"key\",\n      null,\n      [\"k\"],\n      null,\n      null,\n      null);\n\n    p.register_effect(\"Creature types\", \"cre\",\n      null,\n      [\"c\"],\n      null,\n      null,\n      null);\n\n    p.register_effect(\"Deal damage\", \"dam\",\n      [\"randomly\", \"targeted\", \"all\"],\n      [\"x\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n    p.register_effect(\"Destroy minions\", \"des\",\n      [\"randomly\", \"targeted\", \"all\"],\n      null,\n      [\"minions\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n    p.register_effect(\"Heal\", \"hea\",\n      [\"randomly\", \"targeted\", \"all\"],\n      [\"x\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n    p.register_effect(\"Gain armour\", \"arm\",\n      null,\n      [\"x\"],\n      null,\n      null,\n      null);\n\n    p.register_effect(\"Return to hand\", \"ret\",\n      [\"randomly\", \"targeted\", \"all\"],\n      null,\n      [\"minions\", \"pirates\", \"beasts\", \"elementals\", \"totems\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      null);\n\n\n    p.register_effect(\"Draw cards\", \"dra\",\n    null,\n    [\"x\"],\n    null,\n    [\"enemy\", \"friendly\", \"all\"],\n    null);\n\n\n  p.register_effect(\"Gain mana crystals\", \"gai\",\n    null,\n    [\"x\"],\n    null,\n    [\"enemy\", \"friendly\", \"all\"],\n    null);\n\n  p.register_effect(\"Summon token\", \"sum\",\n    null,\n    [\"x/x\"],\n    null,\n    null,\n    null);\n\n    p.register_effect(\"Modify stats\", \"cha\",\n      [\"randomly\", \"targeted\", \"all\", \"aura\"],\n      [\"x/x\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      [\"turn\", \"permanently\"]);\n\n    p.register_effect(\"Set stats\", \"set\",\n      [\"randomly\", \"targeted\", \"all\", \"aura\"],\n      [\"x/x\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      [\"turn\", \"permanently\"]);\n\n\n    p.register_effect(\"Give keyword\", \"giv\",\n      [\"randomly\", \"targeted\", \"all\", \"aura\"],\n      [\"k\"],\n      [\"minions\", \"heroes\", \"minions or heroes\", \"pirates\", \"beasts\", \"elementals\", \"totems\", \"weapons\"],\n      [\"enemy\", \"friendly\", \"all\"],\n      [\"turn\", \"permanently\"]);\n\n\n\n  }\n\n\n  p.FancyMouse = class {\n    constuctor() {\n      this.busy = false;\n      this.xOffset = 0;\n      this.yOffset = 0;\n      this.effect = null;\n    }\n    setOffset(buttonX, buttonY) {\n      this.xOffset = p.mouseX - buttonX;\n      this.yOffset = p.mouseY - buttonY;\n    }\n  }\n\n\n\n\n\n  p.Effect = class {\n    constructor(label_name, effect_short, methods, param_format, targets, filters, duration) {\n      this.x = 0;\n      this.y = 0;\n\n      this.effect_string = \"\";\n      this.effect_string_height = 0;\n      this.effect_string_width = blank_spell_img.width * p.min(p.width*0.0005, 0.75)/2;\n      this.label_name = label_name;\n      this.effect_short = effect_short;\n\n      this.settings = {\n        methods: [methods, \"\"],\n        params: [param_format, \"\"],\n        targets: [targets, \"\"],\n        filters: [filters, \"\"],\n        duration: [duration, \"\"]\n      };\n    }\n    \n  }\n\n\n  p.Card = class {\n    constructor(card_id, card_task_index, card_class) {\n      this.y = 0;\n      this.x = 0;\n      this.w = blank_spell_img.width * 0.75;\n      this.h = blank_spell_img.height * 0.75;\n      this.oversized = false;\n\n\n      this.class = card_class;\n      this.type_id = 1; //creature\n      this.card_id = card_id;\n      this.card_task_index = card_task_index;\n\n\n      this.flav_img_index = p.floor(p.random(gan_imgs.length));\n      this.mana = 5;\n      this.power = 5;\n      this.toughness = 5;\n      this.effects = [];\n\n      this.hovered_effect = null;\n      this.mouse_over_card_effect = false;\n      this.mouse_over_mana = false;\n      this.mouse_over_power = false;\n      this.mouse_over_toughness = false;\n\n\n    }\n\n    resized() {\n      if (tasks[this.card_task_index].length == 1) {\n        this.x = p.map(2, 0, 3, w_padding, p.width - w_padding)\n      } else if (tasks[this.card_task_index].length == 2) {\n        this.x = p.map(this.card_id == 0 ? 1.5 : 2.5, 0, 3, w_padding, p.width - w_padding)\n      } else {\n        this.x = p.map(this.card_id + 1, 0, 3, w_padding, p.width - w_padding)\n      }\n      \n      this.y = p.height / 2;\n      this.w = blank_spell_img.width * p.min(p.width*0.0005, 0.75);\n      this.h = blank_spell_img.height * p.min(p.width*0.0005, 0.75);\n\n      for(let e of this.effects){\n        e.effect_string_width = blank_spell_img.width * p.min(p.width*0.0005, 0.75)*0.75;\n        p.textSize(font_pixels_small)\n        let num_lines = p.textWidth(e.effect_string)/e.effect_string_width;\n        e.effect_string_height = font_pixels_small * p.ceil(num_lines) + font_pixels_small;\n      }\n    }\n\n    run() {\n      this.generate_effect_text();\n      this.check_mouse_hovers();\n      this.display();\n    }\n\n    generate_effect_text() {\n      for (let e of this.effects) {\n        e.effect_string = \"\";\n        if (e.label_name == \"Keyword\" || e.label_name == \"Creature type\") {\n          e.effect_string = e.settings.params[1];\n        } else if (e.effect_short == \"dam\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Battlecry: Randomly deal \" + e.settings.params[1] + \" damage to a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Battlecry: Deal \" + e.settings.params[1] + \" damage to target \";\n          } else {\n            e.effect_string = \"Battlecry: Deal \" + e.settings.params[1] + \" damage to all \"\n          }\n\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \" //remove \"all all\"\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1]\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])]\n          }\n        } else if (e.label_name == \"Destroy\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Randomly destroy a \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Destroy a target \";\n          } else {\n            e.effect_string = \"Destroy all \"\n          }\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \" //remove \"all all\"\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1]\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])]\n          }\n        } else if (e.label_name == \"Heal\") {\n          if (e.settings.methods[1] == \"randomly\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a random \";\n          } else if (e.settings.methods[1] == \"targeted\") {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to a target \";\n          } else {\n            e.effect_string = \"Restore \" + e.settings.params[1] + \" health to all \";\n          }\n          e.effect_string += e.settings.filters[1] == \"all\" ? \"\" : e.settings.filters[1] + \" \" //remove \"all all\"\n          if (e.settings.methods[1] == \"all\") {\n            e.effect_string += e.settings.targets[1]\n          } else {\n            e.effect_string += target_names_singular[target_names.indexOf(e.settings.targets[1])]\n          }\n        } else {\n          e.effect_string = e.label_name\n        }\n\n\n        p.textSize(font_pixels_small)\n        let num_lines = p.textWidth(e.effect_string)/e.effect_string_width;\n        e.effect_string_height = font_pixels_small * p.ceil(num_lines) + font_pixels_small;\n\n      }\n\n    }\n\n    display() {\n\n      p.push();\n      p.fill(0);\n      p.textAlign(p.CENTER, p.CENTER)\n      if (this.effects.length > 1) {\n        this.oversized = true;\n      } else {\n        this.oversized = false;\n      }\n\n\n      let flav = gan_imgs[this.flav_img_index].get();\n      let forg;\n\n      if (card_types[this.type_id] == \"spell\") {\n        flav.mask(rect_mask)\n        forg = blank_spell_img;\n      } else if (card_types[this.type_id] == \"minion\") {\n        flav.mask(ellipse_mask)\n        forg = this.oversized ? full_blank_creature_img : blank_creature_img;\n      } else {\n        flav.mask(rect_mask)\n        forg = blank_weapon_img;\n      }\n\n      if (!this.oversized) {\n        p.image(flav, this.x, this.y - this.h*0.20, this.w*0.7, this.h*0.7)\n      }\n      \n      p.image(forg, this.x, this.y, this.w, this.h);\n\n      p.push();\n      p.textSize(font_pixels_large*2);\n      p.fill(255);\n      p.strokeWeight(3);\n      p.stroke(0);\n\n      if (card_types[this.type_id] == \"minion\") {\n        p.text(this.power, this.x - this.w / 2.99, this.y + this.h / 2.8)\n        p.text(this.toughness, this.x + this.w / 2.6, this.y + this.h / 2.8)\n      }\n\n\n      p.text(this.mana, this.x - this.w / 2.99, this.y - this.h / 2.3)\n\n      p.pop();\n\n\n      p.push();\n      p.fill(0);\n      let translation_offset_y;\n      if (this.oversized) {\n        translation_offset_y = this.y - this.h *0.3;\n        p.translate(this.x, this.y - this.h * 0.3);\n      } else {\n        translation_offset_y = this.y + this.h*0.1;\n        p.translate(this.x, this.y + this.h*0.1);\n      }\n\n      this.mouse_over_card_effect = false;\n      this.hovered_effect = null;\n\n      for (let e of this.effects) {\n\n        translation_offset_y += e.effect_string_height / 2;\n        p.translate(0, e.effect_string_height / 2)\n\n        if (p.mouseY > translation_offset_y - e.effect_string_height / 2 &&\n          p.mouseY < translation_offset_y + e.effect_string_height / 2 &&\n          p.mouseX > this.x - e.effect_string_width / 2 &&\n          p.mouseX < this.x + e.effect_string_width / 2) {\n\n          this.mouse_over_card_effect = true;\n\n          this.hovered_effect = e;\n          this.hovered_effect.x = this.x - e.effect_string_width / 2;\n          this.hovered_effect.y = translation_offset_y - e.effect_string_height;\n          p.fill(0, 100);\n        } else {\n          p.fill(0, 50)\n        }\n        p.rect(0, 0, e.effect_string_width, e.effect_string_height, 4, 4)\n        p.fill(255, 255)\n        p.textSize(font_pixels_small)\n\n        p.textAlign(p.LEFT, p.TOP)\n        p.text(e.effect_string, 0, 0, e.effect_string_width, e.effect_string_height)\n        translation_offset_y += e.effect_string_height / 2 + 5;\n        p.translate(0, e.effect_string_height / 2 + 5)\n\n      }\n      p.pop();\n\n\n      p.push();\n\n      if (editing_card == this) {\n        if (editing == \"mana\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y - this.h / 2.3;\n        } else if (editing == \"power\") {\n          editX = this.x - this.w / 2.99;\n          editY = this.y + this.h / 2.8;\n        } else if (editing == \"toughness\") {\n          editX = this.x + this.w / 2.6;\n          editY = this.y + this.h / 2.8;\n        }\n      }\n\n      p.pop();\n      p.pop();\n    }\n\n\n    mouseInImg() {\n      return (p.mouseX > this.x - this.w / 2 - mouse_padding &&\n        p.mouseX < this.x + this.w / 2 + mouse_padding &&\n        p.mouseY > this.y - this.h / 2 - mouse_padding &&\n        p.mouseY < this.y + this.h / 2 + mouse_padding);\n\n    }\n    check_mouse_hovers() {\n      if (card_types[this.type_id] == \"minion\") {\n        this.mouse_over_power = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y + this.h / 2.8) < 50\n        this.mouse_over_toughness = p.dist(p.mouseX, p.mouseY, this.x + this.w / 2.6, this.y + this.h / 2.8) < 50\n      }\n      this.mouse_over_mana = p.dist(p.mouseX, p.mouseY, this.x - this.w / 2.99, this.y - this.h / 2.3) < 50\n    }\n  }\n\n\n\n\n\n  p.Button = class {\n\n    constructor(button_name, button_id) {\n      this.button_name = button_name;\n      this.button_id = button_id;\n\n      this.x = 0;\n      this.y = 0;\n      this.w = p.textWidth(button_name) + 14;\n      this.h = font_pixels + 10;\n      this.fillAlpha = 100;\n\n      this.text_x = 0;\n      this.text_y = 0;\n    }\n    mouseInRegion() {\n      return (p.mouseX > this.x - this.w / 2 - mouse_padding &&\n        p.mouseX < this.x + this.w / 2 + mouse_padding &&\n        p.mouseY > this.y - this.h / 2 - mouse_padding &&\n        p.mouseY < this.y + this.h / 2 + mouse_padding);\n    }\n\n    resized() {\n      this.w = p.textWidth(this.button_name) + 14;\n      this.h = font_pixels + 10;\n\n      this.x = w_padding/2 + this.w / 2 - 7;\n      this.y = p.map(this.button_id, 0, 16, h_padding, p.height - h_padding);\n      this.text_x = this.x - this.w / 2 + 7;\n      this.text_y = this.y - 6;\n\n    }\n\n    run() {\n      this.update();\n      this.display();\n    }\n\n    update() {\n\n      if (this.mouseInRegion() && current_survey_topic == 0) {\n        this.fillAlpha = 255;\n      } else {\n        this.fillAlpha = 100;\n      }\n\n    }\n\n    display() {\n\n\n      p.textSize(font_pixels)\n      p.textAlign(p.LEFT, p.CENTER)\n      p.fill(255, this.fillAlpha);\n      p.rect(this.x, this.y, this.w, this.h, 4, 4);\n      p.fill(0, 255);\n      p.text(this.button_name, this.text_x, this.text_y);\n    }\n\n\n  }\n\n\n  document.oncontextmenu = function () {\n    return false;\n  }\n\n\n}"]},"metadata":{},"sourceType":"module"}